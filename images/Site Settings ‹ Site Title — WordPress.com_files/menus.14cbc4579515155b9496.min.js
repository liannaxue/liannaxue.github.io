webpackJsonp([16],{1432:function(module,exports,__webpack_require__){"use strict";var page=__webpack_require__(40);var config=__webpack_require__(10),controller=__webpack_require__(655),menusController=__webpack_require__(2568);module.exports=function(){if(config.isEnabled("manage/menus")){page("/menus/:site_id",controller.siteSelection,controller.navigation,menusController.menus);page("/menus",controller.siteSelection,controller.sites)}}},1453:function(module,exports,__webpack_require__){"use strict";var _keys=__webpack_require__(44);var _keys2=_interopRequireDefault(_keys);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=__webpack_require__(4)("calypso:posts"),defer=__webpack_require__(341),store=__webpack_require__(42),clone=__webpack_require__(251),fromPairs=__webpack_require__(366),assign=__webpack_require__(29);var wpcom=__webpack_require__(22),PostsStore=__webpack_require__(1534),PostEditStore=__webpack_require__(1490),postListStoreFactory=__webpack_require__(1533),PreferencesStore=__webpack_require__(260),sites=__webpack_require__(55)(),utils=__webpack_require__(1457),versionCompare=__webpack_require__(358),Dispatcher=__webpack_require__(38),stats=__webpack_require__(1461);var PostActions;function handleMetadataOperation(key,value,operation){var post=PostEditStore.get(),metadata;if("string"===typeof key||Array.isArray(key)){key=fromPairs([].concat(key).map(function(meta){return[meta,value]}))}metadata=(post.metadata||[]).filter(function(meta){return!key.hasOwnProperty(meta.key)});(0,_keys2.default)(key).forEach(function(objectKey){var meta={key:objectKey,operation:operation};if("delete"!==operation){meta.value=key[objectKey]}metadata.push(meta)});Dispatcher.handleViewAction({type:"EDIT_POST",post:{metadata:metadata}})}function normalizeApiAttributes(attributes){attributes=clone(attributes);if(attributes.author){attributes.author=attributes.author.ID}return attributes}PostActions={startEditingNew:function startEditingNew(siteId,options){var args;options=options||{};args={type:"DRAFT_NEW_POST",siteId:siteId,postType:options.type||"post",title:options.title,content:options.content};Dispatcher.handleViewAction(args)},startEditingExisting:function startEditingExisting(siteId,postId){var currentPost=PostEditStore.get(),postHandle;if(!siteId){return}if(currentPost&&currentPost.site_ID===siteId&&currentPost.ID===postId){return}Dispatcher.handleViewAction({type:"START_EDITING_POST",siteId:siteId,postId:postId});postHandle=wpcom.site(siteId).post(postId);postHandle.get({context:"edit",meta:"autosave"},function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_TO_EDIT",error:error,post:data})})},stopEditing:function stopEditing(){Dispatcher.handleViewAction({type:"STOP_EDITING_POST"})},autosave:function autosave(callback){var post=PostEditStore.get(),savedPost=PostEditStore.getSavedPost(),siteHandle=wpcom.undocumented().site(post.site_ID),site;callback=callback||function(){};if(!PostEditStore.isDirty()){return callback(new Error("NOT_DIRTY"))}store.set("wpcom-autosave:"+post.site_ID+":"+post.ID,post);if(utils.isPublished(savedPost)||utils.isPublished(post)){site=sites.getSite(post.site_ID);if(!post.ID||!site||site.jetpack&&versionCompare(site.options.jetpack_version,"3.7.0-dev","<")){return callback(new Error("NO_AUTOSAVE"))}Dispatcher.handleViewAction({type:"POST_AUTOSAVE",post:post});siteHandle.postAutosave(post.ID,{content:post.content,title:post.title,excerpt:post.excerpt},function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_AUTOSAVE",error:error,autosave:data});callback(error,data)})}else{PostActions.saveEdited(null,callback,{recordSaveEvent:false})}},blockSave:function blockSave(key){Dispatcher.handleViewAction({type:"BLOCK_EDIT_POST_SAVE",key:key})},unblockSave:function unblockSave(key){Dispatcher.handleViewAction({type:"UNBLOCK_EDIT_POST_SAVE",key:key})},edit:function edit(attributes){Dispatcher.handleViewAction({type:"EDIT_POST",post:attributes})},editRawContent:function editRawContent(content){Dispatcher.handleViewAction({type:"EDIT_POST_RAW_CONTENT",content:content})},resetRawContent:function resetRawContent(){Dispatcher.handleViewAction({type:"RESET_POST_RAW_CONTENT"})},updateMetadata:function updateMetadata(key,value){handleMetadataOperation(key,value,"update")},deleteMetadata:function deleteMetadata(key){handleMetadataOperation(key,null,"delete")},saveEdited:function saveEdited(attributes,callback,options){var post,postHandle,query,changedAttributes,rawContent,mode,isNew;Dispatcher.handleViewAction({type:"EDIT_POST",post:attributes});post=PostEditStore.get();if(!PostEditStore.hasContent()){defer(callback,new Error("NO_CONTENT"),post);return}if(PostEditStore.isSaveBlocked()){defer(callback,new Error("SAVE_BLOCKED"),post);return}changedAttributes=PostEditStore.getChangedAttributes();if(!(0,_keys2.default)(changedAttributes).length){defer(callback,new Error("NO_CHANGE"),post);return}changedAttributes=normalizeApiAttributes(changedAttributes);rawContent=PostEditStore.getRawContent();mode=PreferencesStore.get("editor-mode");isNew=!post.ID;Dispatcher.handleViewAction({type:"EDIT_POST_SAVE"});postHandle=wpcom.site(post.site_ID).post(post.ID);query={context:"edit",apiVersion:"1.2"};if(!options||options.recordSaveEvent!==false){stats.recordSaveEvent()}if(changedAttributes&&changedAttributes.status==="future"&&utils.isFutureDated(post)||changedAttributes&&changedAttributes.status==="publish"&&utils.isBackDated(post)){changedAttributes=assign({},changedAttributes,{status:"publish",date:post.date})}postHandle[isNew?"add":"update"](query,changedAttributes,function(error,data){var original,currentMode;currentMode=PreferencesStore.get("editor-mode");if(!error){original=PostsStore.get(data.global_ID)}Dispatcher.handleServerAction({type:"RECEIVE_POST_BEING_EDITED",error:error,rawContent:mode===currentMode?rawContent:null,isNew:isNew,original:original,post:data});callback(error,data)})},update:function update(post,attributes,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.update(attributes,PostActions.receiveUpdate.bind(null,callback))},trash:function trash(post,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.delete(PostActions.receiveUpdate.bind(null,callback))},restore:function restore(post,callback){var postHandle=wpcom.site(post.site_ID).post(post.ID);postHandle.restore(PostActions.receiveUpdate.bind(null,callback))},queryPosts:function queryPosts(options){var postListStoreId=arguments.length<=1||arguments[1]===undefined?"default":arguments[1];Dispatcher.handleViewAction({type:"QUERY_POSTS",options:options,postListStoreId:postListStoreId})},fetchNextPage:function fetchNextPage(){var postListStoreId=arguments.length<=0||arguments[0]===undefined?"default":arguments[0];var params,id,siteID,postListStore;postListStore=postListStoreFactory(postListStoreId);if(postListStore.isLastPage()||postListStore.isFetchingNextPage()){return}Dispatcher.handleViewAction({type:"FETCH_NEXT_POSTS_PAGE",postListStoreId:postListStoreId});id=postListStore.getID();params=postListStore.getNextPageParams();siteID=postListStore.getSiteID();if(siteID){wpcom.site(siteID).postsList(params,PostActions.receivePage.bind(null,id,postListStoreId))}else{wpcom.me().postsList(params,PostActions.receivePage.bind(null,id,postListStoreId))}},receivePage:function receivePage(id,postListStoreId,error,data){Dispatcher.handleServerAction({type:"RECEIVE_POSTS_PAGE",id:id,postListStoreId:postListStoreId,error:error,data:data})},fetchUpdated:function fetchUpdated(){var postListStoreId=arguments.length<=0||arguments[0]===undefined?"default":arguments[0];var id,params,siteID,postListStore;postListStore=postListStoreFactory(postListStoreId);if(postListStore.isFetchingNextPage()){return}Dispatcher.handleViewAction({type:"FETCH_UPDATED_POSTS",postListStoreId:postListStoreId});id=postListStore.getID();params=postListStore.getUpdatesParams();siteID=postListStore.getSiteID();if(siteID){debug("Fetching posts that have been updated for %s since %s %o",siteID,params.modified_after,params);wpcom.site(siteID).postsList(params,PostActions.receiveUpdated.bind(null,id,postListStoreId))}else{debug("Fetching posts that have been updated since %s %o",params.modified_after,params);wpcom.me().postsList(params,PostActions.receiveUpdated.bind(null,id,postListStoreId))}},receiveUpdated:function receiveUpdated(id,postListStoreId,error,data){Dispatcher.handleServerAction({type:"RECEIVE_UPDATED_POSTS",id:id,postListStoreId:postListStoreId,error:error,data:data})},receiveUpdate:function receiveUpdate(callback,error,data){var original;if(!error){original=PostsStore.get(data.global_ID)}Dispatcher.handleServerAction({type:"RECEIVE_UPDATED_POST",error:error,original:original,post:data});callback(error,data)},fetchCounts:function fetchCounts(siteId,options){Dispatcher.handleViewAction({type:"FETCH_POST_COUNTS",siteId:siteId});wpcom.undocumented().site(siteId).postCounts(options,function(error,data){Dispatcher.handleServerAction({type:"RECEIVE_POST_COUNTS",error:error,data:data,siteId:siteId})})}};module.exports=PostActions},1461:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.recordStat=recordStat;exports.recordEvent=recordEvent;exports.recordSaveEvent=recordSaveEvent;exports.recordTinyMCEButtonClick=recordTinyMCEButtonClick;exports.recordTinyMCEHTMLButtonClick=recordTinyMCEHTMLButtonClick;var _debug=__webpack_require__(4);var _debug2=_interopRequireDefault(_debug);var _noop=__webpack_require__(36);var _noop2=_interopRequireDefault(_noop);var _config=__webpack_require__(10);var _config2=_interopRequireDefault(_config);var _analytics=__webpack_require__(16);var _analytics2=_interopRequireDefault(_analytics);var _postEditStore=__webpack_require__(1490);var _postEditStore2=_interopRequireDefault(_postEditStore);var _utils=__webpack_require__(1457);var _utils2=_interopRequireDefault(_utils);var _sitesList=__webpack_require__(55);var _sitesList2=_interopRequireDefault(_sitesList);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:posts:stats");var sites=new _sitesList2.default;function recordUsageStats(action,postType){var source=void 0;var site=sites.getSelectedSite();_analytics2.default.mc.bumpStat("editor_usage",action);if(site){source=site.jetpack?"jetpack":"wpcom";_analytics2.default.mc.bumpStat("editor_usage_"+source,action);if(postType){_analytics2.default.mc.bumpStat("editor_cpt_usage_"+source,postType+"_"+action)}}}function recordStat(action){_analytics2.default.mc.bumpStat("editor_actions",action)}function recordEvent(action,label,value){_analytics2.default.ga.recordEvent("Editor",action,label,value)}function recordSaveEvent(){var post=_postEditStore2.default.get();var savedPost=_postEditStore2.default.getSavedPost();if(!post||!savedPost){return}var currentStatus=savedPost.status;var nextStatus=post.status;var tracksEventName="calypso_editor_"+post.type+"_";var statName=false;var statEvent=false;var usageAction=false;if(!post.ID&&!_utils2.default.isPublished(post)){tracksEventName+="savedraft"}else if("draft"===nextStatus){tracksEventName+="savedraft"}else if(currentStatus===nextStatus){usageAction="edit";tracksEventName+="update"}else if("publish"===nextStatus||"private"===nextStatus){tracksEventName+="publish";usageAction="new"}else if("pending"===nextStatus){tracksEventName+="pending"}else if("future"===nextStatus){tracksEventName+="schedule";statName="status-schedule";statEvent="Scheduled Post"}if(usageAction){recordUsageStats(usageAction,post.type)}if(statName){recordStat(statName)}if(statEvent){recordEvent(statEvent)}debug("recordSaveEvent %s currentStatus=%s nextStatus=%s",tracksEventName,currentStatus,nextStatus);_analytics2.default.tracks.recordEvent(tracksEventName,{post_id:post.ID,post_type:post.type,visibility:_utils2.default.getVisibility(post),current_status:currentStatus,next_status:nextStatus})}var shouldBumpStat=Math.random()<=.01||(0,_config2.default)("env")==="development";var maybeBumpStat=shouldBumpStat?_analytics2.default.mc.bumpStat:_noop2.default;function recordTinyMCEButtonClick(buttonName){maybeBumpStat("editor-button","calypso_"+buttonName);_analytics2.default.ga.recordEvent("Editor","Clicked TinyMCE Button",buttonName);debug("TinyMCE button click",buttonName,"mc=",shouldBumpStat)}function recordTinyMCEHTMLButtonClick(buttonName){maybeBumpStat("html-editor-button","calypso_"+buttonName);_analytics2.default.ga.recordEvent("Editor","Clicked TinyMCE HTML Button",buttonName);debug("TinyMCE HTML button click",buttonName,"mc=",shouldBumpStat)}},1490:function(module,exports,__webpack_require__){"use strict";var _freeze=__webpack_require__(247);var _freeze2=_interopRequireDefault(_freeze);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var assign=__webpack_require__(29),debug=__webpack_require__(4)("calypso:posts:post-edit-store"),emitter=__webpack_require__(32),isEqual=__webpack_require__(92),filter=__webpack_require__(69),without=__webpack_require__(190),pickBy=__webpack_require__(347);var Dispatcher=__webpack_require__(38),decodeEntities=__webpack_require__(83).decodeEntities,utils=__webpack_require__(1457);var REGEXP_EMPTY_CONTENT=/^<p>(<br[^>]*>|&nbsp;|\s)*<\/p>$/,CONTENT_LENGTH_ASSUME_SET=50;var _initialRawContent=null,_isAutosaving=false,_isLoading=false,_saveBlockers=[],_isNew=false,_loadingError=null,_post=null,_previewUrl=null,_queue=[],_queueChanges=false,_rawContent=null,_savedPost=null,_suggestedSlug=null,PostEditStore;function resetState(){debug("Reset state");_initialRawContent=null;_isAutosaving=false;_isLoading=false;_saveBlockers=[];_isNew=false;_loadingError=null;_post=null;_previewUrl=null;_queue=[];_queueChanges=false;_rawContent=null;_suggestedSlug=null;_savedPost=null}function getSlug(post){var suggestedSlug=utils.getSuggestedSlug(post);if(!post){return null}if(utils.isPublished(post)){return post.slug}if(_savedPost&&_savedPost.slug===_suggestedSlug&&suggestedSlug){return suggestedSlug}if(!_savedPost&&!post.slug&&suggestedSlug){return suggestedSlug}return post.slug||null}function getParentId(post){if(!post||!post.parent){return null}if(post.parent.ID){return post.parent.ID}return post.parent}function getPageTemplate(post){if(!post||!post.page_template||post.page_template==="default"){return""}return post.page_template}function startEditing(post){resetState();post=normalize(post);post.slug=getSlug(post);if(post.title){post.title=decodeEntities(post.title)}_previewUrl=utils.getPreviewURL(post);_suggestedSlug=utils.getSuggestedSlug(post);_savedPost=(0,_freeze2.default)(post);_post=_savedPost;_isLoading=false}function updatePost(post){post=normalize(post);post.slug=getSlug(post);if(post.title){post.title=decodeEntities(post.title)}_previewUrl=utils.getPreviewURL(post);_suggestedSlug=utils.getSuggestedSlug(post);_savedPost=(0,_freeze2.default)(post);_post=_savedPost;_isNew=false;_loadingError=null;_queue.forEach(function(change){set(change)})}function initializeNewPost(siteId,options){var args;options=options||{};args={site_ID:siteId,status:"draft",type:options.postType||"post",content:options.content||"",title:options.title||""};startEditing(args);_isNew=true}function setLoadingError(error){resetState();_loadingError=error;_isLoading=false}function set(attributes){var updatedPost;if(!_post){return false}if(_queueChanges){_queue.push(attributes)}updatedPost=assign({},_post,attributes);updatedPost=normalize(updatedPost);if(!isEqual(updatedPost,_post)){if(isEqual(updatedPost,_savedPost)){_post=_savedPost}else{_post=(0,_freeze2.default)(updatedPost)}return true}return false}function normalize(post){post.parent_id=getParentId(post);if(post.type==="page"){post.page_template=getPageTemplate(post)}return post}function setRawContent(content){var isDirty,hasContent;if(null===_initialRawContent){debug("Set initial raw content to: %s",content);_initialRawContent=content}if(content!==_rawContent){isDirty=PostEditStore.isDirty();hasContent=PostEditStore.hasContent();debug("Set raw content to: %s",content);_rawContent=content;if(PostEditStore.isDirty()!==isDirty||PostEditStore.hasContent()!==hasContent){PostEditStore.emit("change")}PostEditStore.emit("rawContentChange")}}function isContentEmpty(content){return!content||content.length<CONTENT_LENGTH_ASSUME_SET&&REGEXP_EMPTY_CONTENT.test(content)}function dispatcherCallback(payload){var action=payload.action,changed;switch(action.type){case"EDIT_POST":changed=set(action.post);if(changed){PostEditStore.emit("change")}break;case"RESET_POST_RAW_CONTENT":_initialRawContent=null;setRawContent(null);break;case"EDIT_POST_RAW_CONTENT":setRawContent(action.content);break;case"DRAFT_NEW_POST":initializeNewPost(action.siteId,{postType:action.postType,title:action.title,content:action.content});PostEditStore.emit("change");break;case"START_EDITING_POST":resetState();_isLoading=true;PostEditStore.emit("change");break;case"STOP_EDITING_POST":resetState();PostEditStore.emit("change");break;case"RECEIVE_POST_TO_EDIT":_isLoading=false;if(action.error){setLoadingError(action.error)}else{startEditing(action.post)}PostEditStore.emit("change");break;case"BLOCK_EDIT_POST_SAVE":if(-1===_saveBlockers.indexOf(action.key)){_saveBlockers.push(action.key);PostEditStore.emit("change")}break;case"UNBLOCK_EDIT_POST_SAVE":_saveBlockers=without(_saveBlockers,action.key);PostEditStore.emit("change");break;case"EDIT_POST_SAVE":_queueChanges=true;break;case"RECEIVE_UPDATED_POST":if(!action.error){if(_post&&action.post.ID===_post.ID){updatePost(action.post);PostEditStore.emit("change")}}_queueChanges=false;_queue=[];break;case"RECEIVE_POST_BEING_EDITED":if(!action.error){updatePost(action.post);if(typeof action.rawContent==="string"){_initialRawContent=action.rawContent}PostEditStore.emit("change")}_queueChanges=false;_queue=[];break;case"POST_AUTOSAVE":_isAutosaving=true;PostEditStore.emit("change");break;case"RECEIVE_POST_AUTOSAVE":_isAutosaving=false;if(!action.error){_previewUrl=utils.getPreviewURL(assign({preview_URL:action.autosave.preview_URL},_savedPost))}PostEditStore.emit("change");break}}PostEditStore={get:function get(){return _post},getSavedPost:function getSavedPost(){return _savedPost},getRawContent:function getRawContent(){return _rawContent},getChangedAttributes:function getChangedAttributes(){var changedAttributes,metadata;if(this.isNew()){return _post}if(!this.isDirty()){return(0,_freeze2.default)({})}changedAttributes=pickBy(_post,function(value,key){return value!==_savedPost[key]&&"metadata"!==key});if(_post.metadata){metadata=filter(_post.metadata,"operation");if(metadata.length){assign(changedAttributes,{metadata:metadata})}}if(!changedAttributes.content&&_rawContent!==_initialRawContent){changedAttributes.content=_post.content}return(0,_freeze2.default)(changedAttributes)},getLoadingError:function getLoadingError(){return _loadingError},isDirty:function isDirty(){return _post!==_savedPost||_rawContent!==_initialRawContent},isNew:function isNew(){return _isNew},isLoading:function isLoading(){return _isLoading},isAutosaving:function isAutosaving(){return _isAutosaving},isSaveBlocked:function isSaveBlocked(key){if(!key){return!!_saveBlockers.length}return-1!==_saveBlockers.indexOf(key)},getPreviewUrl:function getPreviewUrl(){return _previewUrl},hasContent:function hasContent(){if(!_post){return false}if(_post.title&&_post.title.trim()||_post.excerpt){return true}if(_rawContent){return!isContentEmpty(_rawContent)}return!isContentEmpty(_post.content)}};emitter(PostEditStore);PostEditStore.dispatchToken=Dispatcher.register(dispatcherCallback);module.exports=PostEditStore},1533:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=getStore;var _postListStore=__webpack_require__(1721);var _postListStore2=_interopRequireDefault(_postListStore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _postListStores={};function getStore(storeId){var postStoreId=storeId||"default";if(!_postListStores[postStoreId]){_postListStores[postStoreId]=new _postListStore2.default(postStoreId)}return _postListStores[postStoreId]}getStore._reset=function(){_postListStores={}};module.exports=exports["default"]},1534:function(module,exports,__webpack_require__){"use strict";var isEqual=__webpack_require__(92),debug=__webpack_require__(4)("calypso:posts");var utils=__webpack_require__(1457),Dispatcher=__webpack_require__(38);var _posts={},PostsStore;function setPost(post){var cachedPost=PostsStore.get(post.global_ID);if(cachedPost&&isEqual(post,cachedPost)){return}_posts[post.global_ID]=post}function normalizePost(responseSource,attributes){var _ref=attributes||{};var global_ID=_ref.global_ID;if(!global_ID){debug("global_ID is required for a post",attributes);return}var cachedPost=PostsStore.get(global_ID);if(cachedPost&&responseSource==="local"){debug("existing record (%o), do not overwrite with local response",cachedPost);return}utils.normalizeSync(attributes,function(error,post){setPost(post)})}function setAll(posts,responseSource){var boundNormalizePost=normalizePost.bind(null,responseSource);posts.forEach(boundNormalizePost)}PostsStore={get:function get(globalID){return _posts[globalID]}};PostsStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;switch(action.type){case"RECEIVE_POSTS_PAGE":case"RECEIVE_UPDATED_POSTS":if(!action.error&&action.data.posts){var responseSource=action.data.__sync&&action.data.__sync.responseSource;setAll(action.data.posts,responseSource)}break;case"RECEIVE_UPDATED_POST":if(!action.error){normalizePost("server",action.post)}break}});module.exports=PostsStore},1551:function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(){"use strict";var hasOwn={}.hasOwnProperty;function classNames(){var classes=[];for(var i=0;i<arguments.length;i++){var arg=arguments[i];if(!arg)continue;var argType=typeof arg;if(argType==="string"||argType==="number"){classes.push(arg)}else if(Array.isArray(arg)){classes.push(classNames.apply(null,arg))}else if(argType==="object"){for(var key in arg){if(hasOwn.call(arg,key)&&arg[key]){classes.push(key)}}}}return classes.join(" ")}if(typeof module!=="undefined"&&module.exports){module.exports=classNames}else if(true){!(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),__WEBPACK_AMD_DEFINE_RESULT__!==undefined&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}else{window.classNames=classNames}})()},1599:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getTermsForQueryIgnoringPage=exports.getTermsForQuery=undefined;var _extends2=__webpack_require__(19);var _extends3=_interopRequireDefault(_extends2);exports.isRequestingTermsForQuery=isRequestingTermsForQuery;exports.isRequestingTermsForQueryIgnoringPage=isRequestingTermsForQueryIgnoringPage;exports.getTermsLastPageForQuery=getTermsLastPageForQuery;exports.getTerms=getTerms;exports.getTerm=getTerm;var _get=__webpack_require__(30);var _get2=_interopRequireDefault(_get);var _range=__webpack_require__(678);var _range2=_interopRequireDefault(_range);var _createSelector=__webpack_require__(154);var _createSelector2=_interopRequireDefault(_createSelector);var _utils=__webpack_require__(731);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function isRequestingTermsForQuery(state,siteId,taxonomy,query){var serializedQuery=(0,_utils.getSerializedTermsQuery)(query);return!!(0,_get2.default)(state.terms.queryRequests,[siteId,taxonomy,serializedQuery])}function isRequestingTermsForQueryIgnoringPage(state,siteId,taxonomy,query){var lastPage=getTermsLastPageForQuery(state,siteId,taxonomy,query);if(null===lastPage){return false}return(0,_range2.default)(1,lastPage+1).some(function(page){var termsQuery=(0,_extends3.default)({},query,{page:page});return isRequestingTermsForQuery(state,siteId,taxonomy,termsQuery)})}var getTermsForQuery=exports.getTermsForQuery=(0,_createSelector2.default)(function(state,siteId,taxonomy,query){var manager=(0,_get2.default)(state.terms.queries,[siteId,taxonomy]);if(!manager){return null}return manager.getItems(query)},function(state,siteId,taxonomy){return(0,_get2.default)(state.terms.queries,[siteId,taxonomy])},function(state,siteId,taxonomy,query){var serializedQuery=(0,_utils.getSerializedTermsQuery)(query);return[siteId,taxonomy,serializedQuery].join()});var getTermsForQueryIgnoringPage=exports.getTermsForQueryIgnoringPage=(0,_createSelector2.default)(function(state,siteId,taxonomy,query){var manager=(0,_get2.default)(state.terms.queries,[siteId,taxonomy]);if(!manager){return null}return manager.getItemsIgnoringPage(query)},function(state,siteId,taxonomy){return(0,_get2.default)(state.terms.queries,[siteId,taxonomy])},function(state,siteId,taxonomy,query){var serializedQuery=(0,_utils.getSerializedTermsQueryWithoutPage)(query);return[siteId,taxonomy,serializedQuery].join()});function getTermsLastPageForQuery(state,siteId,taxonomy,query){var manager=(0,_get2.default)(state.terms.queries,[siteId,taxonomy]);if(!manager){return null}var pages=manager.getNumberOfPages(query);if(null===pages){return null}return Math.max(pages,1)}function getTerms(state,siteId,taxonomy){var manager=(0,_get2.default)(state.terms.queries,[siteId,taxonomy]);if(!manager){return null}return manager.getItems()}function getTerm(state,siteId,taxonomy,termId){var manager=(0,_get2.default)(state.terms.queries,[siteId,taxonomy]);if(!manager){return null}var term=manager.getItem(termId);if(!term){return null}return term}},1605:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};exports.default=defaultCellRangeRenderer;var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(1551);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function defaultCellRangeRenderer(_ref){var cellCache=_ref.cellCache;var cellClassName=_ref.cellClassName;var cellRenderer=_ref.cellRenderer;var cellStyle=_ref.cellStyle;var columnSizeAndPositionManager=_ref.columnSizeAndPositionManager;var columnStartIndex=_ref.columnStartIndex;var columnStopIndex=_ref.columnStopIndex;var horizontalOffsetAdjustment=_ref.horizontalOffsetAdjustment;var isScrolling=_ref.isScrolling;var rowSizeAndPositionManager=_ref.rowSizeAndPositionManager;var rowStartIndex=_ref.rowStartIndex;var rowStopIndex=_ref.rowStopIndex;var scrollLeft=_ref.scrollLeft;var scrollTop=_ref.scrollTop;var verticalOffsetAdjustment=_ref.verticalOffsetAdjustment;var renderedCells=[];for(var rowIndex=rowStartIndex;rowIndex<=rowStopIndex;rowIndex++){var rowDatum=rowSizeAndPositionManager.getSizeAndPositionOfCell(rowIndex);for(var columnIndex=columnStartIndex;columnIndex<=columnStopIndex;columnIndex++){var columnDatum=columnSizeAndPositionManager.getSizeAndPositionOfCell(columnIndex);var key=rowIndex+"-"+columnIndex;var cellStyleObject=cellStyle({rowIndex:rowIndex,columnIndex:columnIndex});var renderedCell=void 0;if(isScrolling){if(!cellCache[key]){cellCache[key]=cellRenderer({columnIndex:columnIndex,isScrolling:isScrolling,rowIndex:rowIndex})}renderedCell=cellCache[key]}else{renderedCell=cellRenderer({columnIndex:columnIndex,isScrolling:isScrolling,rowIndex:rowIndex})}if(renderedCell==null||renderedCell===false){continue}var className=cellClassName({columnIndex:columnIndex,rowIndex:rowIndex});var child=_react2.default.createElement("div",{key:key,className:(0,_classnames2.default)("Grid__cell",className),style:_extends({},cellStyleObject,{height:rowDatum.size,left:columnDatum.offset+horizontalOffsetAdjustment,top:rowDatum.offset+verticalOffsetAdjustment,width:columnDatum.size})},renderedCell);renderedCells.push(child)}}return renderedCells}},1609:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var postListStoreFactory=__webpack_require__(1533),PostContentImagesStore=__webpack_require__(1719),Dispatcher=__webpack_require__(38),actions=__webpack_require__(1453),pollers=__webpack_require__(191);var PostListFetcher;function dispatchQueryActions(postListStoreId,query){var postListStore=postListStoreFactory(postListStoreId);actions.queryPosts(query,postListStoreId);if(postListStore.getPage()===0){actions.fetchNextPage(postListStoreId)}}function queryPosts(props){var query={type:props.type||"post",siteID:props.siteID,status:props.status,author:props.author,search:props.search,exclude_tree:props.excludeTree,orderBy:props.orderBy,order:props.order,number:props.number,before:props.before,after:props.after};if(props.withCounts){query.meta="counts"}if(Dispatcher.isDispatching()){setTimeout(function(){dispatchQueryActions(props.postListStoreId,query)},0)}else{dispatchQueryActions(props.postListStoreId,query)}}function getPostsState(postListStoreId){var postListStore=postListStoreFactory(postListStoreId);return{listId:postListStore.getID(),posts:postListStore.getAll(),postImages:PostContentImagesStore.getAll(),page:postListStore.getPage(),lastPage:postListStore.isLastPage(),loading:postListStore.isFetchingNextPage(),hasRecentError:postListStore.hasRecentError()}}function shouldQueryPosts(props,nextProps){return props.type!==nextProps.type||props.status!==nextProps.status||props.author!==nextProps.author||props.search!==nextProps.search||props.excludeTree!==nextProps.excludeTree||props.withCounts!==nextProps.withCounts||props.orderBy!==nextProps.orderBy||props.order!==nextProps.order||props.number!==nextProps.number||props.before!==nextProps.before||props.after!==nextProps.after||props.siteID!==nextProps.siteID||props.postListStoreId!==nextProps.postListStoreId}PostListFetcher=React.createClass({displayName:"PostListFetcher",propTypes:{children:React.PropTypes.element.isRequired,type:React.PropTypes.string,status:React.PropTypes.string,author:React.PropTypes.number,search:React.PropTypes.string,siteID:React.PropTypes.any,withImages:React.PropTypes.bool,withCounts:React.PropTypes.bool,excludeTree:React.PropTypes.number,orderBy:React.PropTypes.oneOf(["title","date","modified","comment_count","ID"]),order:React.PropTypes.oneOf(["ASC","DESC"]),number:React.PropTypes.number,before:React.PropTypes.string,after:React.PropTypes.string,postListStoreId:React.PropTypes.string},getDefaultProps:function getDefaultProps(){return{orderBy:"date",order:"DESC",postListStoreId:"default"}},componentWillMount:function componentWillMount(){var postListStore=postListStoreFactory(this.props.postListStoreId);postListStore.on("change",this.onPostsChange);if(this.props.withImages){PostContentImagesStore.on("change",this.onPostsChange)}queryPosts(this.props)},componentDidMount:function componentDidMount(){var postListStore=postListStoreFactory(this.props.postListStoreId);this._poller=pollers.add(postListStore,actions.fetchUpdated,{interval:6e4})},componentWillUnmount:function componentWillUnmount(){var postListStore=postListStoreFactory(this.props.postListStoreId);pollers.remove(this._poller);postListStore.off("change",this.onPostsChange);if(this.props.withImages){PostContentImagesStore.off("change",this.onPostsChange)}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var listenerChange;if(shouldQueryPosts(this.props,nextProps)){queryPosts(nextProps)}if(nextProps.withImages!==this.props.withImages){listenerChange=nextProps.withImages?"on":"off";PostContentImagesStore[listenerChange]("change",this.onPostsChange);
}},onPostsChange:function onPostsChange(){this.setState(getPostsState(this.props.postListStoreId))},render:function render(){return React.cloneElement(this.props.children,this.state)}});module.exports=PostListFetcher},1619:function(module,exports,__webpack_require__){"use strict";var Traverser=__webpack_require__(1620);function TreeConvert(key){if(!(this instanceof TreeConvert)){return new TreeConvert(key)}this.key=key||"id"}TreeConvert.prototype.treeify=function(items){var tree=[],indexedNodes={};items.forEach(function(item,i){indexedNodes[items[i][this.key]]=item},this);items.forEach(function(item){var parentNode;if(item.parent>0&&indexedNodes[item.parent]){parentNode=indexedNodes[item.parent];parentNode.items=parentNode.items||[];parentNode.items.push(item)}else{item.parent=0;tree.push(item)}});this.sortItems(tree);this.removeOrderProperty(tree);return tree};TreeConvert.prototype.untreeify=function(tree,list){list=list||[];tree.forEach(function(item,index){if(item.items){TreeConvert.prototype.untreeify(item.items,list)}item.order=index+1;list.push(item)});return list};TreeConvert.prototype.sortItems=function(itemTrees){var root={};root.items=itemTrees;Traverser.traverse(root,[function(node){node.items&&node.items.sort(function(a,b){return a.order-b.order});return node}])};TreeConvert.prototype.removeOrderProperty=function(itemTrees){var root={};root.items=itemTrees;Traverser.traverse(root,[function(node){node.items&&node.items.forEach(function(item){delete item.order});return node}])};module.exports=TreeConvert},1620:function(module,exports,__webpack_require__){"use strict";var findIndex=__webpack_require__(351),some=__webpack_require__(82);function parent(node,tree){return find(tree,function(it){return some(it.items,{id:node.id})})||tree}function _traverse(node,filters,root){filters.forEach(function(filter){node=filter(node,root)},this);if(node.items){node.items=node.items.map(function(item){return _traverse(item,filters,root)})}return node}function find(node,predicate){if(predicate(node)){return node}if(node.items){return mapFindAny(node.items,function(node){return find(node,predicate)})}}function replaceItem(node,newNode,predicate){var i;if(!node.items){return}for(i=0;i<node.items.length;i++){if(predicate(node.items[i])){node.items[i]=newNode;return}replaceItem(node.items[i],newNode,predicate)}}function mapFindAny(array,fn){var i,result,length=array.length;for(i=0;i<length;i++){if(result=fn(array[i])){return result}}}function childInserter(srcNode,dstId){return function(node){if(node.id===dstId){node.items=node.items||[];node.items.push(srcNode)}return node}}function siblingInserter(srcNode,dstId,position){return function(node){var index,offset=position==="before"?0:1;if(~(index=findIndex(node.items,{id:dstId}))){node.items.splice(index+offset,0,srcNode)}return node}}module.exports={traverse:function traverse(root,filters){return _traverse(root,filters,root)},parent:parent,find:find,replaceItem:replaceItem,remover:function remover(id){return function(node){var index;if(~(index=findIndex(node.items,{id:id}))){node.items.splice(index,1)}return node}},inserter:function inserter(srcItem,dstId,position){var func="child"===position?childInserter:siblingInserter;return func(srcItem,dstId,position)}}},1656:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _menuData=__webpack_require__(1891);var _menuData2=_interopRequireDefault(_menuData);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var instance=new _menuData2.default;exports.default=instance;module.exports=exports["default"]},1677:function(module,exports,__webpack_require__){"use strict";var canUseDOM=__webpack_require__(1753);var size;module.exports=function(recalc){if(!size||recalc){if(canUseDOM){var scrollDiv=document.createElement("div");scrollDiv.style.position="absolute";scrollDiv.style.top="-9999px";scrollDiv.style.width="50px";scrollDiv.style.height="50px";scrollDiv.style.overflow="scroll";document.body.appendChild(scrollDiv);size=scrollDiv.offsetWidth-scrollDiv.clientWidth;document.body.removeChild(scrollDiv)}}return size}},1681:function(module,exports,__webpack_require__){(function(global){var now=__webpack_require__(1763),root=typeof window==="undefined"?global:window,vendors=["moz","webkit"],suffix="AnimationFrame",raf=root["request"+suffix],caf=root["cancel"+suffix]||root["cancelRequest"+suffix];for(var i=0;!raf&&i<vendors.length;i++){raf=root[vendors[i]+"Request"+suffix];caf=root[vendors[i]+"Cancel"+suffix]||root[vendors[i]+"CancelRequest"+suffix]}if(!raf||!caf){var last=0,id=0,queue=[],frameDuration=1e3/60;raf=function(callback){if(queue.length===0){var _now=now(),next=Math.max(0,frameDuration-(_now-last));last=next+_now;setTimeout(function(){var cp=queue.slice(0);queue.length=0;for(var i=0;i<cp.length;i++){if(!cp[i].cancelled){try{cp[i].callback(last)}catch(e){setTimeout(function(){throw e},0)}}}},Math.round(next))}queue.push({handle:++id,callback:callback,cancelled:false});return id};caf=function(handle){for(var i=0;i<queue.length;i++){if(queue[i].handle===handle){queue[i].cancelled=true}}}}module.exports=function(fn){return raf.call(root,fn)};module.exports.cancel=function(){caf.apply(root,arguments)};module.exports.polyfill=function(){root.requestAnimationFrame=raf;root.cancelAnimationFrame=caf}}).call(exports,function(){return this}())},1682:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VirtualScroll=exports.default=undefined;var _VirtualScroll2=__webpack_require__(1788);var _VirtualScroll3=_interopRequireDefault(_VirtualScroll2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_VirtualScroll3.default;exports.VirtualScroll=_VirtualScroll3.default},1697:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(23);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(26);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(25);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var React=_interopRequireWildcard(_react);var _page=__webpack_require__(40);var _page2=_interopRequireDefault(_page);var _utils=__webpack_require__(150);var _utils2=_interopRequireDefault(_utils);var _notice=__webpack_require__(79);var _notice2=_interopRequireDefault(_notice);var _noticeAction=__webpack_require__(151);var _noticeAction2=_interopRequireDefault(_noticeAction);var _spinner=__webpack_require__(350);var _spinner2=_interopRequireDefault(_spinner);var _i18nCalypso=__webpack_require__(13);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _sitesList=__webpack_require__(55);var _sitesList2=_interopRequireDefault(_sitesList);var _user=__webpack_require__(37);var _user2=_interopRequireDefault(_user);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var sites=(0,_sitesList2.default)();var user=(0,_user2.default)();var EmailUnverifiedNotice=function(_React$Component){(0,_inherits3.default)(EmailUnverifiedNotice,_React$Component);function EmailUnverifiedNotice(props){(0,_classCallCheck3.default)(this,EmailUnverifiedNotice);var _this=(0,_possibleConstructorReturn3.default)(this,(0,_getPrototypeOf2.default)(EmailUnverifiedNotice).call(this,props));_this.updateVerificationState=_this.updateVerificationState.bind(_this);_this.handleDismiss=_this.handleDismiss.bind(_this);_this.handleSendVerificationEmail=_this.handleSendVerificationEmail.bind(_this);_this.handleChangeEmail=_this.handleChangeEmail.bind(_this);_this.state={needsVerification:_utils2.default.needsVerificationForSite(sites.getSelectedSite()),pendingRequest:false,emailSent:false,error:null};return _this}(0,_createClass3.default)(EmailUnverifiedNotice,[{key:"componentWillMount",value:function componentWillMount(){user.on("change",this.updateVerificationState);user.on("verify",this.updateVerificationState);sites.on("change",this.updateVerificationState)}},{key:"componentWillUnmount",value:function componentWillUnmount(){user.off("change",this.updateVerificationState);user.off("verify",this.updateVerificationState);sites.off("change",this.updateVerificationState)}},{key:"updateVerificationState",value:function updateVerificationState(){this.setState({needsVerification:_utils2.default.needsVerificationForSite(sites.getSelectedSite())})}},{key:"handleDismiss",value:function handleDismiss(){this.setState({error:null,emailSent:false})}},{key:"handleChangeEmail",value:function handleChangeEmail(e){e.preventDefault();(0,_page2.default)("/me/account")}},{key:"handleSendVerificationEmail",value:function handleSendVerificationEmail(e){var _this2=this;e.preventDefault();if(this.state.pendingRequest){return}this.setState({pendingRequest:true});user.sendVerificationEmail(function(error,response){_this2.setState({emailSent:response&&response.success,error:error,pendingRequest:false})})}},{key:"renderEmailSendPending",value:function renderEmailSendPending(){return React.createElement(_notice2.default,{icon:"mail",showDismiss:false,text:_i18nCalypso2.default.translate("Sending...")},React.createElement(_noticeAction2.default,null,React.createElement(_spinner2.default,null)))}},{key:"renderEmailSendSuccess",value:function renderEmailSendSuccess(){var noticeText=_i18nCalypso2.default.translate("We sent another confirmation email to %(email)s.",{args:{email:user.get().email}});return React.createElement(_notice2.default,{text:noticeText,status:"is-success",onDismissClick:this.handleDismiss,className:"email-verification-notice"})}},{key:"renderEmailSendError",value:function renderEmailSendError(){var noticeText=[React.createElement("strong",null,_i18nCalypso2.default.translate("The email could not be sent."))," ",this.state.error.message];return React.createElement(_notice2.default,{text:noticeText,icon:"notice",onDismissClick:this.handleDismiss,status:"is-warning",className:"email-verification-notice"},React.createElement(_noticeAction2.default,{onClick:this.handleSendVerificationEmail},_i18nCalypso2.default.translate("Try Again")))}},{key:"render",value:function render(){if(this.state.pendingRequest){return this.renderEmailSendPending()}if(this.state.error){return this.renderEmailSendError()}if(this.state.emailSent){return this.renderEmailSendSuccess()}var noticeText=React.createElement("div",null,React.createElement("p",null,React.createElement("strong",null,_i18nCalypso2.default.getLocaleSlug()==="en"?_i18nCalypso2.default.translate("To continue, please confirm your email address"):_i18nCalypso2.default.translate("Please confirm your email address"))),React.createElement("p",null,_i18nCalypso2.default.getLocaleSlug()==="en"?_i18nCalypso2.default.translate("Click the link in the email we sent to %(email)s.",{args:{email:user.get().email}}):_i18nCalypso2.default.translate("To post and keep using WordPress.com you need to confirm your email address. "+"Please click the link in the email we sent at %(email)s.",{args:{email:user.get().email}})),React.createElement("p",null,_i18nCalypso2.default.getLocaleSlug()==="en"?_i18nCalypso2.default.translate("Didn't get it? {{requestButton}}Resend Confirmation Email{{/requestButton}} "+"or {{changeButton}}Change Account Email Address{{/changeButton}}",{components:{requestButton:React.createElement("a",{href:"#",tabIndex:"0",onClick:this.handleSendVerificationEmail}),changeButton:React.createElement("a",{href:"#",tabIndex:"0",onClick:this.handleChangeEmail})}}):_i18nCalypso2.default.translate("{{requestButton}}Re-send your confirmation email{{/requestButton}} "+"or {{changeButton}}change the email address on your account{{/changeButton}}.",{components:{requestButton:React.createElement("a",{href:"#",tabIndex:"0",onClick:this.handleSendVerificationEmail}),changeButton:React.createElement("a",{href:"#",tabIndex:"0",onClick:this.handleChangeEmail})}})));return React.createElement(_notice2.default,{text:noticeText,icon:"info",showDismiss:false,className:"email-unverified-notice"})}}]);return EmailUnverifiedNotice}(React.Component);exports.default=EmailUnverifiedNotice;module.exports=exports["default"]},1698:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(23);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(26);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(25);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var React=_interopRequireWildcard(_react);var _emailUnverifiedNotice=__webpack_require__(1697);var _emailUnverifiedNotice2=_interopRequireDefault(_emailUnverifiedNotice);var _utils=__webpack_require__(150);var _utils2=_interopRequireDefault(_utils);var _sitesList=__webpack_require__(55);var _sitesList2=_interopRequireDefault(_sitesList);var _user=__webpack_require__(37);var _user2=_interopRequireDefault(_user);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key]}}newObj.default=obj;return newObj}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var sites=(0,_sitesList2.default)();var user=(0,_user2.default)();var EmailVerificationGate=function(_React$Component){(0,_inherits3.default)(EmailVerificationGate,_React$Component);function EmailVerificationGate(props){(0,_classCallCheck3.default)(this,EmailVerificationGate);var _this=(0,_possibleConstructorReturn3.default)(this,(0,_getPrototypeOf2.default)(EmailVerificationGate).call(this,props));_this.updateVerificationState=_this.updateVerificationState.bind(_this);_this.handleFocus=_this.handleFocus.bind(_this);_this.state={needsVerification:_utils2.default.needsVerificationForSite(sites.getSelectedSite())};return _this}(0,_createClass3.default)(EmailVerificationGate,[{key:"componentWillMount",value:function componentWillMount(){user.on("change",this.updateVerificationState);user.on("verify",this.updateVerificationState);sites.on("change",this.updateVerificationState)}},{key:"componentWillUnmount",value:function componentWillUnmount(){user.off("change",this.updateVerificationState);user.off("verify",this.updateVerificationState);sites.off("change",this.updateVerificationState)}},{key:"updateVerificationState",value:function updateVerificationState(){this.setState({needsVerification:_utils2.default.needsVerificationForSite(sites.getSelectedSite())})}},{key:"handleFocus",value:function handleFocus(e){e.target.blur()}},{key:"render",value:function render(){if(this.state.needsVerification){return React.createElement("div",{tabIndex:"-1",className:"email-verification-gate",onFocus:this.handleFocus},React.createElement(_emailUnverifiedNotice2.default,null),React.createElement("div",{className:"email-verification-gate__content"},this.props.children))}return React.createElement("div",null,this.props.children)}}]);return EmailVerificationGate}(React.Component);exports.default=EmailVerificationGate;module.exports=exports["default"]},1719:function(module,exports,__webpack_require__){"use strict";var isEqual=__webpack_require__(92),pick=__webpack_require__(72);var Emitter=__webpack_require__(32),Dispatcher=__webpack_require__(38),utils=__webpack_require__(1457),PostsStore=__webpack_require__(1534);var _contentImages={},PostContentImagesStore;function scrapeAll(posts){posts.forEach(scrapePost)}function scrapePost(post){var imagesFromPost=pick(PostsStore.get(post.global_ID),"content_images","canonical_image","featured_image","images","global_ID");utils.normalizeAsync(imagesFromPost,function(error,normalizedPostImages){var cachedImages=PostContentImagesStore.get(normalizedPostImages.global_ID);if(isEqual(normalizedPostImages,cachedImages)){return}_contentImages[normalizedPostImages.global_ID]=normalizedPostImages;PostContentImagesStore.emit("change")})}PostContentImagesStore={get:function get(postGlobalID){return _contentImages[postGlobalID]},getAll:function getAll(){return _contentImages}};Emitter(PostContentImagesStore);PostContentImagesStore.dispatchToken=Dispatcher.register(function(payload){var action=payload.action;Dispatcher.waitFor([PostsStore.dispatchToken]);switch(action.type){case"RECEIVE_POSTS_PAGE":case"RECEIVE_UPDATED_POSTS":if(!action.error&&action.data.posts){scrapeAll(action.data.posts)}break;case"RECEIVE_UPDATED_POST":if(!action.error){scrapePost(action.post)}break}});module.exports=PostContentImagesStore},1720:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof2=__webpack_require__(31);var _typeof3=_interopRequireDefault(_typeof2);var _keys=__webpack_require__(44);var _keys2=_interopRequireDefault(_keys);var _toConsumableArray2=__webpack_require__(46);var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);exports.getCacheKey=getCacheKey;exports.setCanonicalList=setCanonicalList;exports.getCanonicalList=getCanonicalList;exports.deleteCanonicalList=deleteCanonicalList;var _intersection=__webpack_require__(705);var _intersection2=_interopRequireDefault(_intersection);var _debug=__webpack_require__(4);var _debug2=_interopRequireDefault(_debug);var _sitesList=__webpack_require__(55);var _sitesList2=_interopRequireDefault(_sitesList);var _dispatcher=__webpack_require__(38);var _dispatcher2=_interopRequireDefault(_dispatcher);var _cacheIndex=__webpack_require__(709);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var cache={};var _canonicalCache={};var TTL_IN_MS=5*60*1e3;var sites=(0,_sitesList2.default)();var PostsListCache={get:get,_reset:function _reset(){cache={}}};var debug=(0,_debug2.default)("calypso:posts-list:cache");function isStale(list){var now=(new Date).getTime();var timeSaved=list.timeSaved;return now-timeSaved>TTL_IN_MS}function get(listKey){if(isListKeyFresh(listKey)){return cache[listKey].list}if(cache[listKey]&&cache[listKey].dirty){debug("delete cached list %o",listKey);delete cache[listKey];delete _canonicalCache[listKey]}}function set(list){var listKey=getCacheKey(list.query);if(!cache[listKey]||!cache[listKey].dirty){cache[listKey]={timeStored:(new Date).getTime(),dirty:false,list:list,listKey:listKey}}}function markDirty(post,oldStatus){var site=sites.getSite(post.site_ID);var affectedSites=[site.slug,site.ID,false];var affectedStatuses=[post.status,oldStatus];var listStatuses=void 0,key=void 0,entry=void 0,list=void 0;for(key in cache){if(!cache.hasOwnProperty(key)){continue}entry=cache[key];list=entry.list;if(list.query.type!==post.type){continue}if(-1===affectedSites.indexOf(list.query.siteID)){continue}listStatuses=list.query.status.split(",");if((0,_intersection2.default)(listStatuses,affectedStatuses).length===0){continue}entry.dirty=true}_cacheIndex.cacheIndex.clearRecordsByParamFilter(function(reqParams){var siteIdentifiers=affectedSites.slice(0,-1);var affectedPaths=["/me/posts"].concat((0,_toConsumableArray3.default)(siteIdentifiers.map(function(status){return"/sites/"+status+"/posts"})));var recordStatuses=reqParams.query&&reqParams.query.status?reqParams.query.status.split(","):[];var intersectingStatuses=(0,_intersection2.default)(recordStatuses,affectedStatuses);if(affectedPaths.indexOf(reqParams.path)===-1){return false}if(!intersectingStatuses.length){return false}return true})}function isListKeyFresh(listKey){return cache[listKey]&&!isStale(cache[listKey])&&!cache[listKey].dirty}PostsListCache.dispatchToken=_dispatcher2.default.register(function(payload){var action=payload.action,PostListStore=__webpack_require__(1533)();_dispatcher2.default.waitFor([PostListStore.dispatchToken]);switch(action.type){case"FETCH_NEXT_POSTS_PAGE":set(PostListStore.get());break;case"RECEIVE_POSTS_PAGE":set(PostListStore.get());break;case"RECEIVE_UPDATED_POSTS":set(PostListStore.get());break;case"RECEIVE_UPDATED_POST":case"RECEIVE_POST_BEING_EDITED":if(action.post){markDirty(action.post,action.original?action.original.status:null);set(PostListStore.get())}break}});function getCacheKey(options){var cacheKey=[];var keys=(0,_keys2.default)(options).sort();keys.forEach(function(key){cacheKey.push(key+"-"+options[key])});return cacheKey.join(":")}function setCanonicalList(listKey,requestKey,list){debug("setCanonicalList %o %o (%o)",listKey,requestKey,list);_canonicalCache[listKey]=_canonicalCache[listKey]||{};_canonicalCache[listKey][requestKey]=list}function getCanonicalList(listKey,requestKey){debug("getCanonicalList %o %o",listKey,requestKey);var stream=_canonicalCache[listKey];if(!stream||(typeof stream==="undefined"?"undefined":(0,_typeof3.default)(stream))!=="object"){return false}var keys=(0,_keys2.default)(stream);if(keys[0]!==requestKey){delete cache[listKey];delete _canonicalCache[listKey];return false}return stream[requestKey]}function deleteCanonicalList(listKey,requestKey){debug("deleteCanonicalList %o %o",listKey,requestKey);var stream=_canonicalCache[listKey];if(stream&&stream[requestKey]){delete stream[requestKey]}}exports.default=PostsListCache},1721:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(23);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(26);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(25);var _inherits3=_interopRequireDefault(_inherits2);var _typeof2=__webpack_require__(31);var _typeof3=_interopRequireDefault(_typeof2);exports.getRemovedPosts=getRemovedPosts;exports.default=function(id){if(!id){throw new Error("must supply a post-list-store id")}var _activeList={postIds:[],errors:[],query:(0,_clone2.default)(_defaultQuery),page:0,nextPageHandle:false,isLastPage:false,isFetchingNextPage:false,isFetchingUpdated:false};function queryPosts(options){var query=(0,_assign2.default)({},_defaultQuery,options);if(query.siteID&&typeof query.siteID==="string"){query.siteID=query.siteID.replace(/::/g,"/")}if(query.status==="draft,pending"){query.orderBy="modified"}var listKey=(0,_postListCacheStore.getCacheKey)(query);var list=_postListCacheStore2.default.get(listKey);if(list){_activeList=list}else{_activeList={id:_nextId,postIds:[],errors:[],page:0,isLastPage:false,isFetchingNextPage:false,isFetchingUpdated:false,query:query,listKey:listKey};_nextId++}}function cleanParams(params){return(0,_transform2.default)(params,function(result,value,key){if(value!=null){result[key]=value}},{})}function sort(){var key=_activeList.query.orderBy;_activeList.postIds.sort(function(a,b){var postA=_postsStore2.default.get(a),postB=_postsStore2.default.get(b),timeA=postA[key],timeB=postB[key];if(timeA===timeB){if(postA.title===postB.title){return 0}return postA.title>postB.title?1:-1}return timeA>timeB?-1:1})}function receivePage(listId,error,data){if(error||!data||(typeof data==="undefined"?"undefined":(0,_typeof3.default)(data))!=="object"){error=error||{message:"Error fetching PostsList: empty data response"};debug("Error fetching PostsList from api:",error);error.timestamp=Date.now();_activeList.errors.push(error);return}var found=data.found;var meta=data.meta;var posts=data.posts;var __sync=data.__sync;var _ref=__sync||{};var responseSource=_ref.responseSource;var requestKey=_ref.requestKey;if(listId!==_activeList.id){return}_activeList.isFetchingNextPage=false;_activeList.nextPageHandle=meta&&meta.next_page;if(!_activeList.nextPageHandle||!found){_activeList.isLastPage=true}var responsePostIDs=posts.map(function(post){return post.global_ID});var priorList=_activeList.postIds.slice(0);if(responseSource==="local"&&requestKey){(0,_postListCacheStore.setCanonicalList)(_activeList.listKey,requestKey,priorList)}else{var canonicalList=(0,_postListCacheStore.getCanonicalList)(_activeList.listKey,requestKey);if(canonicalList){debug("canonicalList found (%o)",canonicalList);priorList=canonicalList;(0,_postListCacheStore.deleteCanonicalList)(_activeList.listKey,requestKey)}}var removedPosts=getRemovedPosts(priorList,responsePostIDs);if(removedPosts.length){debug("removePosts (%o)",removedPosts);priorList=(0,_difference2.default)(priorList,removedPosts)}var newPosts=(0,_difference2.default)(responsePostIDs,priorList);if(newPosts.length){debug("newPosts (%o)",newPosts);priorList=priorList.concat(newPosts);_activeList.page++}_activeList.postIds=priorList;sort()}function receiveUpdates(listId,error,data){var posts=void 0;var postIds=void 0;var newPostIds=void 0;if(error){debug("An error occurred while fetching updated posts %o",error);return}if(listId!==_activeList.id){return}if(!data.posts.length){return}posts=data.posts;debug("Fetched updated posts:",posts);postIds=posts.map(function(post){return post.global_ID});newPostIds=(0,_difference2.default)(postIds,_activeList.postIds);if(newPostIds.length){_activeList.postIds=_activeList.postIds.concat(newPostIds);sort()}}return new(function(_EventEmitter){(0,_inherits3.default)(_class,_EventEmitter);function _class(){(0,_classCallCheck3.default)(this,_class);var _this=(0,_possibleConstructorReturn3.default)(this,(0,_getPrototypeOf2.default)(_class).call(this));_this.id=id;_this.dispatchToken=_dispatcher2.default.register(_this.handlePayload.bind(_this));return _this}(0,_createClass3.default)(_class,[{key:"get",value:function get(){return _activeList}},{key:"getID",value:function getID(){return _activeList.id}},{key:"getSiteID",value:function getSiteID(){return _activeList.query.siteID}},{key:"getAll",value:function getAll(){return _activeList.postIds.map(function(globalID){return _postsStore2.default.get(globalID)})}},{key:"getTree",value:function getTree(){var sortedPosts=[];_activeList.postIds.forEach(function(globalID){var post=(0,_clone2.default)(_postsStore2.default.get(globalID));post.parent=post.parent?post.parent.ID:0;sortedPosts.push(post)});return(0,_treeConvert2.default)("ID").treeify(sortedPosts)}},{key:"getPost",value:function getPost(globalID){if(_activeList.postIds.indexOf(globalID)>-1){return _postsStore2.default.get(globalID)}}},{key:"getPage",value:function getPage(){return _activeList.page}},{key:"off",value:function off(event,method){this.removeListener(event,method)}},{key:"isLastPage",value:function isLastPage(){return _activeList.isLastPage}},{key:"isFetchingNextPage",value:function isFetchingNextPage(){return _activeList.isFetchingNextPage}},{key:"hasRecentError",value:function hasRecentError(){var recentTimeIntervalSeconds=30;var dateNow=Date.now();return(0,_some2.default)(_activeList.errors,function(error){return dateNow-error.timestamp<recentTimeIntervalSeconds*1e3})}},{key:"getNextPageParams",value:function getNextPageParams(){var params={};var query=_activeList.query;params.status=query.status;params.order_by=query.orderBy;params.order=query.order;params.author=query.author;params.number=query.perPage;params.type=query.type;params.page_handle=_activeList.nextPageHandle;params.exclude_tree=query.exclude_tree;params.number=query.number;params.before=query.before;params.after=query.after;if(query.search){params.search=query.search}if(!params.siteID){params.site_visibility="visible"}if(query.meta){params.meta=query.meta}return cleanParams(params)}},{key:"getUpdatesParams",value:function getUpdatesParams(){var params={};var query=_activeList.query;params.status=query.status;params.author=query.author;params.type=query.type;if(query.search){params.search=query.search}if(!params.siteID){params.site_visibility="visible"}if(query.meta){params.meta=query.meta}if(_activeList.postIds.length){params.modified_after=(0,_maxBy2.default)(this.getAll(),function(post){return new Date(post.modified).getTime()}).modified;if(query.orderBy!=="modified"&&!_activeList.isLastPage){params.after=this.getPost((0,_last2.default)(_activeList.postIds)).date}}return cleanParams(params)}},{key:"handlePayload",value:function handlePayload(payload){var action=payload.action;if(action.postListStoreId&&action.postListStoreId!==this.id&&"RECEIVE_UPDATED_POST"!==action.type){return}_dispatcher2.default.waitFor([_postsStore2.default.dispatchToken]);switch(action.type){case"QUERY_POSTS":debug("QUERY_POSTS",action);queryPosts(action.options);this.emit("change");break;case"FETCH_NEXT_POSTS_PAGE":debug("FETCH_NEXT_POSTS_PAGE",action);_activeList.isFetchingNextPage=true;this.emit("change");break;case"RECEIVE_POSTS_PAGE":debug("receivePage",action);receivePage(action.id,action.error,action.data);this.emit("change");break;case"RECEIVE_UPDATED_POSTS":receiveUpdates(action.id,action.error,action.data);this.emit("change");break;case"RECEIVE_UPDATED_POST":if(action.post){if(_activeList.postIds.indexOf(action.post.global_ID)>-1){this.emit("change")}}break}}}]);return _class}(_events.EventEmitter))};var _debug=__webpack_require__(4);var _debug2=_interopRequireDefault(_debug);var _clone=__webpack_require__(251);var _clone2=_interopRequireDefault(_clone);var _assign=__webpack_require__(29);var _assign2=_interopRequireDefault(_assign);var _transform=__webpack_require__(682);var _transform2=_interopRequireDefault(_transform);var _difference=__webpack_require__(112);var _difference2=_interopRequireDefault(_difference);var _last=__webpack_require__(252);var _last2=_interopRequireDefault(_last);var _maxBy=__webpack_require__(1846);var _maxBy2=_interopRequireDefault(_maxBy);var _events=__webpack_require__(159);var _some=__webpack_require__(82);var _some2=_interopRequireDefault(_some);var _dispatcher=__webpack_require__(38);var _dispatcher2=_interopRequireDefault(_dispatcher);var _treeConvert=__webpack_require__(1619);var _treeConvert2=_interopRequireDefault(_treeConvert);var _postsStore=__webpack_require__(1534);var _postsStore2=_interopRequireDefault(_postsStore);var _postListCacheStore=__webpack_require__(1720);var _postListCacheStore2=_interopRequireDefault(_postListCacheStore);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _defaultQuery={siteID:false,type:"post",status:"publish",orderBy:"date",order:"DESC",author:false,search:false,perPage:20};var debug=(0,_debug2.default)("calypso:posts-list");var _nextId=0;function getRemovedPosts(currentList,newPosts){if(currentList.length<3||newPosts.length<2){return[]}var overlapBegin=currentList.indexOf(newPosts[0]);if(overlapBegin===-1){return getRemovedPosts(currentList,newPosts.slice(1))}var overlapEnd=currentList.indexOf(newPosts.slice(-1)[0]);if(overlapEnd===-1){return getRemovedPosts(currentList,newPosts.slice(0,-1))}var overlapList=currentList.slice(overlapBegin,overlapEnd+1);return(0,_difference2.default)(overlapList,newPosts)}},1753:function(module,exports){"use strict";module.exports=!!(typeof window!=="undefined"&&window.document&&window.document.createElement)},1763:function(module,exports,__webpack_require__){
(function(process){(function(){var getNanoSeconds,hrtime,loadTime;if(typeof performance!=="undefined"&&performance!==null&&performance.now){module.exports=function(){return performance.now()}}else if(typeof process!=="undefined"&&process!==null&&process.hrtime){module.exports=function(){return(getNanoSeconds()-loadTime)/1e6};hrtime=process.hrtime;getNanoSeconds=function(){var hr;hr=hrtime();return hr[0]*1e9+hr[1]};loadTime=getNanoSeconds()}else if(Date.now){module.exports=function(){return Date.now()-loadTime};loadTime=Date.now()}else{module.exports=function(){return(new Date).getTime()-loadTime};loadTime=(new Date).getTime()}}).call(this)}).call(exports,__webpack_require__(52))},1781:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(1551);var _classnames2=_interopRequireDefault(_classnames);var _calculateSizeAndPositionDataAndUpdateScrollOffset=__webpack_require__(1785);var _calculateSizeAndPositionDataAndUpdateScrollOffset2=_interopRequireDefault(_calculateSizeAndPositionDataAndUpdateScrollOffset);var _ScalingCellSizeAndPositionManager=__webpack_require__(1784);var _ScalingCellSizeAndPositionManager2=_interopRequireDefault(_ScalingCellSizeAndPositionManager);var _createCallbackMemoizer=__webpack_require__(1789);var _createCallbackMemoizer2=_interopRequireDefault(_createCallbackMemoizer);var _getOverscanIndices=__webpack_require__(1786);var _getOverscanIndices2=_interopRequireDefault(_getOverscanIndices);var _scrollbarSize=__webpack_require__(1677);var _scrollbarSize2=_interopRequireDefault(_scrollbarSize);var _raf=__webpack_require__(1681);var _raf2=_interopRequireDefault(_raf);var _reactAddonsShallowCompare=__webpack_require__(679);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);var _updateScrollIndexHelper=__webpack_require__(1787);var _updateScrollIndexHelper2=_interopRequireDefault(_updateScrollIndexHelper);var _defaultCellRangeRenderer=__webpack_require__(1605);var _defaultCellRangeRenderer2=_interopRequireDefault(_defaultCellRangeRenderer);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var IS_SCROLLING_TIMEOUT=150;var SCROLL_POSITION_CHANGE_REASONS={OBSERVED:"observed",REQUESTED:"requested"};var Grid=function(_Component){_inherits(Grid,_Component);function Grid(props,context){_classCallCheck(this,Grid);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(Grid).call(this,props,context));_this.state={isScrolling:false,scrollLeft:0,scrollTop:0};_this._onGridRenderedMemoizer=(0,_createCallbackMemoizer2.default)();_this._onScrollMemoizer=(0,_createCallbackMemoizer2.default)(false);_this._enablePointerEventsAfterDelayCallback=_this._enablePointerEventsAfterDelayCallback.bind(_this);_this._invokeOnGridRenderedHelper=_this._invokeOnGridRenderedHelper.bind(_this);_this._onScroll=_this._onScroll.bind(_this);_this._setNextStateCallback=_this._setNextStateCallback.bind(_this);_this._updateScrollLeftForScrollToColumn=_this._updateScrollLeftForScrollToColumn.bind(_this);_this._updateScrollTopForScrollToRow=_this._updateScrollTopForScrollToRow.bind(_this);_this._columnWidthGetter=_this._wrapSizeGetter(props.columnWidth);_this._rowHeightGetter=_this._wrapSizeGetter(props.rowHeight);_this._columnSizeAndPositionManager=new _ScalingCellSizeAndPositionManager2.default({cellCount:props.columnCount,cellSizeGetter:function cellSizeGetter(index){return _this._columnWidthGetter(index)},estimatedCellSize:_this._getEstimatedColumnSize(props)});_this._rowSizeAndPositionManager=new _ScalingCellSizeAndPositionManager2.default({cellCount:props.rowCount,cellSizeGetter:function cellSizeGetter(index){return _this._rowHeightGetter(index)},estimatedCellSize:_this._getEstimatedRowSize(props)});_this._cellCache={};return _this}_createClass(Grid,[{key:"measureAllCells",value:function measureAllCells(){var _props=this.props;var columnCount=_props.columnCount;var rowCount=_props.rowCount;this._columnSizeAndPositionManager.getSizeAndPositionOfCell(columnCount-1);this._rowSizeAndPositionManager.getSizeAndPositionOfCell(rowCount-1)}},{key:"recomputeGridSize",value:function recomputeGridSize(){this._columnSizeAndPositionManager.resetCell(0);this._rowSizeAndPositionManager.resetCell(0);this.forceUpdate()}},{key:"componentDidMount",value:function componentDidMount(){var _props2=this.props;var scrollLeft=_props2.scrollLeft;var scrollToColumn=_props2.scrollToColumn;var scrollTop=_props2.scrollTop;var scrollToRow=_props2.scrollToRow;if(!this._scrollbarSizeMeasured){this._scrollbarSize=(0,_scrollbarSize2.default)();this._scrollbarSizeMeasured=true;this.setState({})}if(scrollLeft>=0||scrollTop>=0){this._setScrollPosition({scrollLeft:scrollLeft,scrollTop:scrollTop})}if(scrollToColumn>=0||scrollToRow>=0){this._updateScrollLeftForScrollToColumn();this._updateScrollTopForScrollToRow()}this._invokeOnGridRenderedHelper();this._invokeOnScrollMemoizer({scrollLeft:scrollLeft||0,scrollTop:scrollTop||0,totalColumnsWidth:this._columnSizeAndPositionManager.getTotalSize(),totalRowsHeight:this._rowSizeAndPositionManager.getTotalSize()})}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){var _this2=this;var _props3=this.props;var autoHeight=_props3.autoHeight;var height=_props3.height;var scrollToAlignment=_props3.scrollToAlignment;var scrollToColumn=_props3.scrollToColumn;var scrollToRow=_props3.scrollToRow;var width=_props3.width;var _state=this.state;var scrollLeft=_state.scrollLeft;var scrollPositionChangeReason=_state.scrollPositionChangeReason;var scrollTop=_state.scrollTop;if(scrollPositionChangeReason===SCROLL_POSITION_CHANGE_REASONS.REQUESTED){if(scrollLeft>=0&&scrollLeft!==prevState.scrollLeft&&scrollLeft!==this.refs.scrollingContainer.scrollLeft){this.refs.scrollingContainer.scrollLeft=scrollLeft}if(!autoHeight&&scrollTop>=0&&scrollTop!==prevState.scrollTop&&scrollTop!==this.refs.scrollingContainer.scrollTop){this.refs.scrollingContainer.scrollTop=scrollTop}}(0,_updateScrollIndexHelper2.default)({cellSizeAndPositionManager:this._columnSizeAndPositionManager,previousCellsCount:prevProps.columnCount,previousCellSize:prevProps.columnWidth,previousScrollToAlignment:prevProps.scrollToAlignment,previousScrollToIndex:prevProps.scrollToColumn,previousSize:prevProps.width,scrollOffset:scrollLeft,scrollToAlignment:scrollToAlignment,scrollToIndex:scrollToColumn,size:width,updateScrollIndexCallback:function updateScrollIndexCallback(scrollToColumn){return _this2._updateScrollLeftForScrollToColumn(_extends({},_this2.props,{scrollToColumn:scrollToColumn}))}});(0,_updateScrollIndexHelper2.default)({cellSizeAndPositionManager:this._rowSizeAndPositionManager,previousCellsCount:prevProps.rowCount,previousCellSize:prevProps.rowHeight,previousScrollToAlignment:prevProps.scrollToAlignment,previousScrollToIndex:prevProps.scrollToRow,previousSize:prevProps.height,scrollOffset:scrollTop,scrollToAlignment:scrollToAlignment,scrollToIndex:scrollToRow,size:height,updateScrollIndexCallback:function updateScrollIndexCallback(scrollToRow){return _this2._updateScrollTopForScrollToRow(_extends({},_this2.props,{scrollToRow:scrollToRow}))}});this._invokeOnGridRenderedHelper()}},{key:"componentWillMount",value:function componentWillMount(){this._scrollbarSize=(0,_scrollbarSize2.default)();if(this._scrollbarSize===undefined){this._scrollbarSizeMeasured=false;this._scrollbarSize=0}else{this._scrollbarSizeMeasured=true}}},{key:"componentWillUnmount",value:function componentWillUnmount(){if(this._disablePointerEventsTimeoutId){clearTimeout(this._disablePointerEventsTimeoutId)}if(this._setNextStateAnimationFrameId){_raf2.default.cancel(this._setNextStateAnimationFrameId)}}},{key:"componentWillUpdate",value:function componentWillUpdate(nextProps,nextState){var _this3=this;if(nextProps.columnCount===0&&nextState.scrollLeft!==0||nextProps.rowCount===0&&nextState.scrollTop!==0){this._setScrollPosition({scrollLeft:0,scrollTop:0})}else if(nextProps.scrollLeft!==this.props.scrollLeft||nextProps.scrollTop!==this.props.scrollTop){this._setScrollPosition({scrollLeft:nextProps.scrollLeft,scrollTop:nextProps.scrollTop})}this._columnWidthGetter=this._wrapSizeGetter(nextProps.columnWidth);this._rowHeightGetter=this._wrapSizeGetter(nextProps.rowHeight);this._columnSizeAndPositionManager.configure({cellCount:nextProps.columnCount,estimatedCellSize:this._getEstimatedColumnSize(nextProps)});this._rowSizeAndPositionManager.configure({cellCount:nextProps.rowCount,estimatedCellSize:this._getEstimatedRowSize(nextProps)});(0,_calculateSizeAndPositionDataAndUpdateScrollOffset2.default)({cellCount:this.props.columnCount,cellSize:this.props.columnWidth,computeMetadataCallback:function computeMetadataCallback(){return _this3._columnSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:nextProps,nextCellsCount:nextProps.columnCount,nextCellSize:nextProps.columnWidth,nextScrollToIndex:nextProps.scrollToColumn,scrollToIndex:this.props.scrollToColumn,updateScrollOffsetForScrollToIndex:function updateScrollOffsetForScrollToIndex(){return _this3._updateScrollLeftForScrollToColumn(nextProps,nextState)}});(0,_calculateSizeAndPositionDataAndUpdateScrollOffset2.default)({cellCount:this.props.rowCount,cellSize:this.props.rowHeight,computeMetadataCallback:function computeMetadataCallback(){return _this3._rowSizeAndPositionManager.resetCell(0)},computeMetadataCallbackProps:nextProps,nextCellsCount:nextProps.rowCount,nextCellSize:nextProps.rowHeight,nextScrollToIndex:nextProps.scrollToRow,scrollToIndex:this.props.scrollToRow,updateScrollOffsetForScrollToIndex:function updateScrollOffsetForScrollToIndex(){return _this3._updateScrollTopForScrollToRow(nextProps,nextState)}})}},{key:"render",value:function render(){var _props4=this.props;var cellClassName=_props4.cellClassName;var cellRenderer=_props4.cellRenderer;var cellRangeRenderer=_props4.cellRangeRenderer;var cellStyle=_props4.cellStyle;var className=_props4.className;var columnCount=_props4.columnCount;var height=_props4.height;var noContentRenderer=_props4.noContentRenderer;var overscanColumnCount=_props4.overscanColumnCount;var overscanRowCount=_props4.overscanRowCount;var autoHeight=_props4.autoHeight;var rowCount=_props4.rowCount;var style=_props4.style;var tabIndex=_props4.tabIndex;var width=_props4.width;var _state2=this.state;var isScrolling=_state2.isScrolling;var scrollLeft=_state2.scrollLeft;var scrollTop=_state2.scrollTop;var childrenToDisplay=[];if(height>0&&width>0){var visibleColumnIndices=this._columnSizeAndPositionManager.getVisibleCellRange({containerSize:width,offset:scrollLeft});var visibleRowIndices=this._rowSizeAndPositionManager.getVisibleCellRange({containerSize:height,offset:scrollTop});var horizontalOffsetAdjustment=this._columnSizeAndPositionManager.getOffsetAdjustment({containerSize:width,offset:scrollLeft});var verticalOffsetAdjustment=this._rowSizeAndPositionManager.getOffsetAdjustment({containerSize:height,offset:scrollTop});this._renderedColumnStartIndex=visibleColumnIndices.start;this._renderedColumnStopIndex=visibleColumnIndices.stop;this._renderedRowStartIndex=visibleRowIndices.start;this._renderedRowStopIndex=visibleRowIndices.stop;var overscanColumnIndices=(0,_getOverscanIndices2.default)({cellCount:columnCount,overscanCellsCount:overscanColumnCount,startIndex:this._renderedColumnStartIndex,stopIndex:this._renderedColumnStopIndex});var overscanRowIndices=(0,_getOverscanIndices2.default)({cellCount:rowCount,overscanCellsCount:overscanRowCount,startIndex:this._renderedRowStartIndex,stopIndex:this._renderedRowStopIndex});this._columnStartIndex=overscanColumnIndices.overscanStartIndex;this._columnStopIndex=overscanColumnIndices.overscanStopIndex;this._rowStartIndex=overscanRowIndices.overscanStartIndex;this._rowStopIndex=overscanRowIndices.overscanStopIndex;childrenToDisplay=cellRangeRenderer({cellCache:this._cellCache,cellClassName:this._wrapCellClassNameGetter(cellClassName),cellRenderer:cellRenderer,cellStyle:this._wrapCellStyleGetter(cellStyle),columnSizeAndPositionManager:this._columnSizeAndPositionManager,columnStartIndex:this._columnStartIndex,columnStopIndex:this._columnStopIndex,horizontalOffsetAdjustment:horizontalOffsetAdjustment,isScrolling:isScrolling,rowSizeAndPositionManager:this._rowSizeAndPositionManager,rowStartIndex:this._rowStartIndex,rowStopIndex:this._rowStopIndex,scrollLeft:scrollLeft,scrollTop:scrollTop,verticalOffsetAdjustment:verticalOffsetAdjustment})}var gridStyle=_extends({},style,{height:autoHeight?"auto":height,width:width});var totalColumnsWidth=this._columnSizeAndPositionManager.getTotalSize();var totalRowsHeight=this._rowSizeAndPositionManager.getTotalSize();var verticalScrollBarSize=totalRowsHeight>height?this._scrollbarSize:0;var horizontalScrollBarSize=totalColumnsWidth>width?this._scrollbarSize:0;if(totalColumnsWidth+verticalScrollBarSize<=width){gridStyle.overflowX="hidden"}if(totalRowsHeight+horizontalScrollBarSize<=height){gridStyle.overflowY="hidden"}var showNoContentRenderer=childrenToDisplay.length===0&&height>0&&width>0;return _react2.default.createElement("div",{ref:"scrollingContainer","aria-label":this.props["aria-label"],className:(0,_classnames2.default)("Grid",className),onScroll:this._onScroll,role:"grid",style:gridStyle,tabIndex:tabIndex},childrenToDisplay.length>0&&_react2.default.createElement("div",{className:"Grid__innerScrollContainer",style:{width:totalColumnsWidth,height:totalRowsHeight,maxWidth:totalColumnsWidth,maxHeight:totalRowsHeight,pointerEvents:isScrolling?"none":"auto"}},childrenToDisplay),showNoContentRenderer&&noContentRenderer())}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps,nextState){return(0,_reactAddonsShallowCompare2.default)(this,nextProps,nextState)}},{key:"_enablePointerEventsAfterDelay",value:function _enablePointerEventsAfterDelay(){if(this._disablePointerEventsTimeoutId){clearTimeout(this._disablePointerEventsTimeoutId)}this._disablePointerEventsTimeoutId=setTimeout(this._enablePointerEventsAfterDelayCallback,IS_SCROLLING_TIMEOUT)}},{key:"_enablePointerEventsAfterDelayCallback",value:function _enablePointerEventsAfterDelayCallback(){this._disablePointerEventsTimeoutId=null;this._cellCache={};this.setState({isScrolling:false})}},{key:"_getEstimatedColumnSize",value:function _getEstimatedColumnSize(props){return typeof props.columnWidth==="number"?props.columnWidth:props.estimatedColumnSize}},{key:"_getEstimatedRowSize",value:function _getEstimatedRowSize(props){return typeof props.rowHeight==="number"?props.rowHeight:props.estimatedRowSize}},{key:"_invokeOnGridRenderedHelper",value:function _invokeOnGridRenderedHelper(){var onSectionRendered=this.props.onSectionRendered;this._onGridRenderedMemoizer({callback:onSectionRendered,indices:{columnOverscanStartIndex:this._columnStartIndex,columnOverscanStopIndex:this._columnStopIndex,columnStartIndex:this._renderedColumnStartIndex,columnStopIndex:this._renderedColumnStopIndex,rowOverscanStartIndex:this._rowStartIndex,rowOverscanStopIndex:this._rowStopIndex,rowStartIndex:this._renderedRowStartIndex,rowStopIndex:this._renderedRowStopIndex}})}},{key:"_invokeOnScrollMemoizer",value:function _invokeOnScrollMemoizer(_ref){var _this4=this;var scrollLeft=_ref.scrollLeft;var scrollTop=_ref.scrollTop;var totalColumnsWidth=_ref.totalColumnsWidth;var totalRowsHeight=_ref.totalRowsHeight;this._onScrollMemoizer({callback:function callback(_ref2){var scrollLeft=_ref2.scrollLeft;var scrollTop=_ref2.scrollTop;var _props5=_this4.props;var height=_props5.height;var onScroll=_props5.onScroll;var width=_props5.width;onScroll({clientHeight:height,clientWidth:width,scrollHeight:totalRowsHeight,scrollLeft:scrollLeft,scrollTop:scrollTop,scrollWidth:totalColumnsWidth})},indices:{scrollLeft:scrollLeft,scrollTop:scrollTop}})}},{key:"_setNextState",value:function _setNextState(state){this._nextState=state;if(!this._setNextStateAnimationFrameId){this._setNextStateAnimationFrameId=(0,_raf2.default)(this._setNextStateCallback)}}},{key:"_setNextStateCallback",value:function _setNextStateCallback(){var state=this._nextState;this._setNextStateAnimationFrameId=null;this._nextState=null;this.setState(state)}},{key:"_setScrollPosition",value:function _setScrollPosition(_ref3){var scrollLeft=_ref3.scrollLeft;var scrollTop=_ref3.scrollTop;var newState={scrollPositionChangeReason:SCROLL_POSITION_CHANGE_REASONS.REQUESTED};if(scrollLeft>=0){newState.scrollLeft=scrollLeft}if(scrollTop>=0){newState.scrollTop=scrollTop}if(scrollLeft>=0&&scrollLeft!==this.state.scrollLeft||scrollTop>=0&&scrollTop!==this.state.scrollTop){this.setState(newState)}}},{key:"_wrapCellClassNameGetter",value:function _wrapCellClassNameGetter(className){return this._wrapPropertyGetter(className)}},{key:"_wrapCellStyleGetter",value:function _wrapCellStyleGetter(style){return this._wrapPropertyGetter(style)}},{key:"_wrapPropertyGetter",value:function _wrapPropertyGetter(value){return value instanceof Function?value:function(){return value}}},{key:"_wrapSizeGetter",value:function _wrapSizeGetter(size){return this._wrapPropertyGetter(size)}},{key:"_updateScrollLeftForScrollToColumn",value:function _updateScrollLeftForScrollToColumn(){var props=arguments.length<=0||arguments[0]===undefined?this.props:arguments[0];var state=arguments.length<=1||arguments[1]===undefined?this.state:arguments[1];var columnCount=props.columnCount;var scrollToAlignment=props.scrollToAlignment;var scrollToColumn=props.scrollToColumn;var width=props.width;var scrollLeft=state.scrollLeft;if(scrollToColumn>=0&&columnCount>0){var targetIndex=Math.max(0,Math.min(columnCount-1,scrollToColumn));var calculatedScrollLeft=this._columnSizeAndPositionManager.getUpdatedOffsetForIndex({align:scrollToAlignment,containerSize:width,currentOffset:scrollLeft,targetIndex:targetIndex});if(scrollLeft!==calculatedScrollLeft){this._setScrollPosition({scrollLeft:calculatedScrollLeft})}}}},{key:"_updateScrollTopForScrollToRow",value:function _updateScrollTopForScrollToRow(){var props=arguments.length<=0||arguments[0]===undefined?this.props:arguments[0];var state=arguments.length<=1||arguments[1]===undefined?this.state:arguments[1];var height=props.height;var rowCount=props.rowCount;var scrollToAlignment=props.scrollToAlignment;var scrollToRow=props.scrollToRow;var scrollTop=state.scrollTop;if(scrollToRow>=0&&rowCount>0){var targetIndex=Math.max(0,Math.min(rowCount-1,scrollToRow));var calculatedScrollTop=this._rowSizeAndPositionManager.getUpdatedOffsetForIndex({align:scrollToAlignment,containerSize:height,currentOffset:scrollTop,targetIndex:targetIndex});if(scrollTop!==calculatedScrollTop){this._setScrollPosition({scrollTop:calculatedScrollTop})}}}},{key:"_onScroll",value:function _onScroll(event){if(event.target!==this.refs.scrollingContainer){return}this._enablePointerEventsAfterDelay();var _props6=this.props;var height=_props6.height;var width=_props6.width;var scrollbarSize=this._scrollbarSize;var totalRowsHeight=this._rowSizeAndPositionManager.getTotalSize();var totalColumnsWidth=this._columnSizeAndPositionManager.getTotalSize();var scrollLeft=Math.min(Math.max(0,totalColumnsWidth-width+scrollbarSize),event.target.scrollLeft);var scrollTop=Math.min(Math.max(0,totalRowsHeight-height+scrollbarSize),event.target.scrollTop);if(this.state.scrollLeft!==scrollLeft||this.state.scrollTop!==scrollTop){var scrollPositionChangeReason=event.cancelable?SCROLL_POSITION_CHANGE_REASONS.OBSERVED:SCROLL_POSITION_CHANGE_REASONS.REQUESTED;if(!this.state.isScrolling){this.setState({isScrolling:true})}this._setNextState({isScrolling:true,scrollLeft:scrollLeft,scrollPositionChangeReason:scrollPositionChangeReason,scrollTop:scrollTop})}this._invokeOnScrollMemoizer({scrollLeft:scrollLeft,scrollTop:scrollTop,totalColumnsWidth:totalColumnsWidth,totalRowsHeight:totalRowsHeight})}}]);return Grid}(_react.Component);Grid.propTypes={"aria-label":_react.PropTypes.string,autoHeight:_react.PropTypes.bool,cellClassName:_react.PropTypes.oneOfType([_react.PropTypes.string,_react.PropTypes.func]),cellStyle:_react.PropTypes.oneOfType([_react.PropTypes.object,_react.PropTypes.func]),cellRenderer:_react.PropTypes.func.isRequired,cellRangeRenderer:_react.PropTypes.func.isRequired,className:_react.PropTypes.string,columnCount:_react.PropTypes.number.isRequired,columnWidth:_react.PropTypes.oneOfType([_react.PropTypes.number,_react.PropTypes.func]).isRequired,estimatedColumnSize:_react.PropTypes.number.isRequired,estimatedRowSize:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,noContentRenderer:_react.PropTypes.func.isRequired,onScroll:_react.PropTypes.func.isRequired,onSectionRendered:_react.PropTypes.func.isRequired,overscanColumnCount:_react.PropTypes.number.isRequired,overscanRowCount:_react.PropTypes.number.isRequired,rowHeight:_react.PropTypes.oneOfType([_react.PropTypes.number,_react.PropTypes.func]).isRequired,rowCount:_react.PropTypes.number.isRequired,scrollLeft:_react.PropTypes.number,scrollToAlignment:_react.PropTypes.oneOf(["auto","end","start","center"]).isRequired,scrollToColumn:_react.PropTypes.number,scrollTop:_react.PropTypes.number,scrollToRow:_react.PropTypes.number,style:_react.PropTypes.object,tabIndex:_react.PropTypes.number,width:_react.PropTypes.number.isRequired};Grid.defaultProps={"aria-label":"grid",cellStyle:{},cellRangeRenderer:_defaultCellRangeRenderer2.default,estimatedColumnSize:100,estimatedRowSize:30,noContentRenderer:function noContentRenderer(){return null},onScroll:function onScroll(){return null},onSectionRendered:function onSectionRendered(){return null},overscanColumnCount:0,overscanRowCount:10,scrollToAlignment:"auto",style:{},tabIndex:0};exports.default=Grid},1782:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.defaultCellRangeRenderer=exports.Grid=exports.default=undefined;var _Grid2=__webpack_require__(1781);var _Grid3=_interopRequireDefault(_Grid2);var _defaultCellRangeRenderer2=__webpack_require__(1605);var _defaultCellRangeRenderer3=_interopRequireDefault(_defaultCellRangeRenderer2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_Grid3.default;exports.Grid=_Grid3.default;exports.defaultCellRangeRenderer=_defaultCellRangeRenderer3.default},1783:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var CellSizeAndPositionManager=function(){function CellSizeAndPositionManager(_ref){var cellCount=_ref.cellCount;var cellSizeGetter=_ref.cellSizeGetter;var estimatedCellSize=_ref.estimatedCellSize;_classCallCheck(this,CellSizeAndPositionManager);this._cellSizeGetter=cellSizeGetter;this._cellCount=cellCount;this._estimatedCellSize=estimatedCellSize;this._cellSizeAndPositionData={};this._lastMeasuredIndex=-1}_createClass(CellSizeAndPositionManager,[{key:"configure",value:function configure(_ref2){var cellCount=_ref2.cellCount;var estimatedCellSize=_ref2.estimatedCellSize;this._cellCount=cellCount;this._estimatedCellSize=estimatedCellSize}},{key:"getCellCount",value:function getCellCount(){return this._cellCount}},{key:"getEstimatedCellSize",value:function getEstimatedCellSize(){return this._estimatedCellSize}},{key:"getLastMeasuredIndex",value:function getLastMeasuredIndex(){return this._lastMeasuredIndex}},{key:"getSizeAndPositionOfCell",value:function getSizeAndPositionOfCell(index){if(index<0||index>=this._cellCount){throw Error("Requested index "+index+" is outside of range 0.."+this._cellCount)}if(index>this._lastMeasuredIndex){var lastMeasuredCellSizeAndPosition=this.getSizeAndPositionOfLastMeasuredCell();var _offset=lastMeasuredCellSizeAndPosition.offset+lastMeasuredCellSizeAndPosition.size;for(var i=this._lastMeasuredIndex+1;i<=index;i++){var _size=this._cellSizeGetter({index:i});if(_size==null||isNaN(_size)){throw Error("Invalid size returned for cell "+i+" of value "+_size)}this._cellSizeAndPositionData[i]={offset:_offset,size:_size};_offset+=_size}this._lastMeasuredIndex=index}return this._cellSizeAndPositionData[index]}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function getSizeAndPositionOfLastMeasuredCell(){return this._lastMeasuredIndex>=0?this._cellSizeAndPositionData[this._lastMeasuredIndex]:{offset:0,size:0}}},{key:"getTotalSize",value:function getTotalSize(){var lastMeasuredCellSizeAndPosition=this.getSizeAndPositionOfLastMeasuredCell();return lastMeasuredCellSizeAndPosition.offset+lastMeasuredCellSizeAndPosition.size+(this._cellCount-this._lastMeasuredIndex-1)*this._estimatedCellSize}},{key:"getUpdatedOffsetForIndex",value:function getUpdatedOffsetForIndex(_ref3){var _ref3$align=_ref3.align;var align=_ref3$align===undefined?"auto":_ref3$align;var containerSize=_ref3.containerSize;var currentOffset=_ref3.currentOffset;var targetIndex=_ref3.targetIndex;var datum=this.getSizeAndPositionOfCell(targetIndex);var maxOffset=datum.offset;var minOffset=maxOffset-containerSize+datum.size;switch(align){case"start":return maxOffset;case"end":return minOffset;case"center":return maxOffset-(containerSize+datum.size)/2;default:return Math.max(minOffset,Math.min(maxOffset,currentOffset))}}},{key:"getVisibleCellRange",value:function getVisibleCellRange(_ref4){var containerSize=_ref4.containerSize;var offset=_ref4.offset;var totalSize=this.getTotalSize();if(totalSize===0){return{}}var maxOffset=offset+containerSize;var start=this._findNearestCell(offset);var datum=this.getSizeAndPositionOfCell(start);offset=datum.offset+datum.size;var stop=start;while(offset<maxOffset&&stop<this._cellCount-1){stop++;offset+=this.getSizeAndPositionOfCell(stop).size}return{start:start,stop:stop}}},{key:"resetCell",value:function resetCell(index){this._lastMeasuredIndex=index-1}},{key:"_binarySearch",value:function _binarySearch(_ref5){var high=_ref5.high;var low=_ref5.low;var offset=_ref5.offset;var middle=void 0;var currentOffset=void 0;while(low<=high){middle=low+Math.floor((high-low)/2);currentOffset=this.getSizeAndPositionOfCell(middle).offset;if(currentOffset===offset){return middle}else if(currentOffset<offset){low=middle+1}else if(currentOffset>offset){high=middle-1}}if(low>0){return low-1}}},{key:"_exponentialSearch",value:function _exponentialSearch(_ref6){var index=_ref6.index;var offset=_ref6.offset;var interval=1;while(index<this._cellCount&&this.getSizeAndPositionOfCell(index).offset<offset){index+=interval;interval*=2}return this._binarySearch({high:Math.min(index,this._cellCount-1),low:Math.floor(index/2),offset:offset})}},{key:"_findNearestCell",value:function _findNearestCell(offset){if(isNaN(offset)){throw Error("Invalid offset "+offset+" specified")}offset=Math.max(0,offset);var lastMeasuredCellSizeAndPosition=this.getSizeAndPositionOfLastMeasuredCell();var lastMeasuredIndex=Math.max(0,this._lastMeasuredIndex);if(lastMeasuredCellSizeAndPosition.offset>=offset){return this._binarySearch({high:lastMeasuredIndex,low:0,offset:offset})}else{return this._exponentialSearch({index:lastMeasuredIndex,offset:offset})}}}]);return CellSizeAndPositionManager}();exports.default=CellSizeAndPositionManager},1784:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DEFAULT_MAX_SCROLL_SIZE=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _CellSizeAndPositionManager=__webpack_require__(1783);var _CellSizeAndPositionManager2=_interopRequireDefault(_CellSizeAndPositionManager);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DEFAULT_MAX_SCROLL_SIZE=exports.DEFAULT_MAX_SCROLL_SIZE=1e7;var ScalingCellSizeAndPositionManager=function(){function ScalingCellSizeAndPositionManager(_ref){var _ref$maxScrollSize=_ref.maxScrollSize;var maxScrollSize=_ref$maxScrollSize===undefined?DEFAULT_MAX_SCROLL_SIZE:_ref$maxScrollSize;var params=_objectWithoutProperties(_ref,["maxScrollSize"]);_classCallCheck(this,ScalingCellSizeAndPositionManager);this._cellSizeAndPositionManager=new _CellSizeAndPositionManager2.default(params);this._maxScrollSize=maxScrollSize}_createClass(ScalingCellSizeAndPositionManager,[{key:"configure",value:function configure(params){this._cellSizeAndPositionManager.configure(params)}},{key:"getCellCount",value:function getCellCount(){return this._cellSizeAndPositionManager.getCellCount()}},{key:"getEstimatedCellSize",value:function getEstimatedCellSize(){return this._cellSizeAndPositionManager.getEstimatedCellSize()}},{key:"getLastMeasuredIndex",value:function getLastMeasuredIndex(){return this._cellSizeAndPositionManager.getLastMeasuredIndex()}},{key:"getOffsetAdjustment",value:function getOffsetAdjustment(_ref2){var containerSize=_ref2.containerSize;var offset=_ref2.offset;var totalSize=this._cellSizeAndPositionManager.getTotalSize();var safeTotalSize=this.getTotalSize();var offsetPercentage=this._getOffsetPercentage({containerSize:containerSize,offset:offset,totalSize:safeTotalSize
});return Math.round(offsetPercentage*(safeTotalSize-totalSize))}},{key:"getSizeAndPositionOfCell",value:function getSizeAndPositionOfCell(index){return this._cellSizeAndPositionManager.getSizeAndPositionOfCell(index)}},{key:"getSizeAndPositionOfLastMeasuredCell",value:function getSizeAndPositionOfLastMeasuredCell(){return this._cellSizeAndPositionManager.getSizeAndPositionOfLastMeasuredCell()}},{key:"getTotalSize",value:function getTotalSize(){return Math.min(this._maxScrollSize,this._cellSizeAndPositionManager.getTotalSize())}},{key:"getUpdatedOffsetForIndex",value:function getUpdatedOffsetForIndex(_ref3){var _ref3$align=_ref3.align;var align=_ref3$align===undefined?"auto":_ref3$align;var containerSize=_ref3.containerSize;var currentOffset=_ref3.currentOffset;var targetIndex=_ref3.targetIndex;currentOffset=this._safeOffsetToOffset({containerSize:containerSize,offset:currentOffset});var offset=this._cellSizeAndPositionManager.getUpdatedOffsetForIndex({align:align,containerSize:containerSize,currentOffset:currentOffset,targetIndex:targetIndex});return this._offsetToSafeOffset({containerSize:containerSize,offset:offset})}},{key:"getVisibleCellRange",value:function getVisibleCellRange(_ref4){var containerSize=_ref4.containerSize;var offset=_ref4.offset;offset=this._safeOffsetToOffset({containerSize:containerSize,offset:offset});return this._cellSizeAndPositionManager.getVisibleCellRange({containerSize:containerSize,offset:offset})}},{key:"resetCell",value:function resetCell(index){this._cellSizeAndPositionManager.resetCell(index)}},{key:"_getOffsetPercentage",value:function _getOffsetPercentage(_ref5){var containerSize=_ref5.containerSize;var offset=_ref5.offset;var totalSize=_ref5.totalSize;return totalSize<=containerSize?0:offset/(totalSize-containerSize)}},{key:"_offsetToSafeOffset",value:function _offsetToSafeOffset(_ref6){var containerSize=_ref6.containerSize;var offset=_ref6.offset;var totalSize=this._cellSizeAndPositionManager.getTotalSize();var safeTotalSize=this.getTotalSize();if(totalSize===safeTotalSize){return offset}else{var offsetPercentage=this._getOffsetPercentage({containerSize:containerSize,offset:offset,totalSize:totalSize});return Math.round(offsetPercentage*(safeTotalSize-containerSize))}}},{key:"_safeOffsetToOffset",value:function _safeOffsetToOffset(_ref7){var containerSize=_ref7.containerSize;var offset=_ref7.offset;var totalSize=this._cellSizeAndPositionManager.getTotalSize();var safeTotalSize=this.getTotalSize();if(totalSize===safeTotalSize){return offset}else{var offsetPercentage=this._getOffsetPercentage({containerSize:containerSize,offset:offset,totalSize:safeTotalSize});return Math.round(offsetPercentage*(totalSize-containerSize))}}}]);return ScalingCellSizeAndPositionManager}();exports.default=ScalingCellSizeAndPositionManager},1785:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=calculateSizeAndPositionDataAndUpdateScrollOffset;function calculateSizeAndPositionDataAndUpdateScrollOffset(_ref){var cellCount=_ref.cellCount;var cellSize=_ref.cellSize;var computeMetadataCallback=_ref.computeMetadataCallback;var computeMetadataCallbackProps=_ref.computeMetadataCallbackProps;var nextCellsCount=_ref.nextCellsCount;var nextCellSize=_ref.nextCellSize;var nextScrollToIndex=_ref.nextScrollToIndex;var scrollToIndex=_ref.scrollToIndex;var updateScrollOffsetForScrollToIndex=_ref.updateScrollOffsetForScrollToIndex;if(cellCount!==nextCellsCount||(typeof cellSize==="number"||typeof nextCellSize==="number")&&cellSize!==nextCellSize){computeMetadataCallback(computeMetadataCallbackProps);if(scrollToIndex>=0&&scrollToIndex===nextScrollToIndex){updateScrollOffsetForScrollToIndex()}}}},1786:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=getOverscanIndices;function getOverscanIndices(_ref){var cellCount=_ref.cellCount;var overscanCellsCount=_ref.overscanCellsCount;var startIndex=_ref.startIndex;var stopIndex=_ref.stopIndex;return{overscanStartIndex:Math.max(0,startIndex-overscanCellsCount),overscanStopIndex:Math.min(cellCount-1,stopIndex+overscanCellsCount)}}},1787:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=updateScrollIndexHelper;var _getUpdatedOffsetForIndex=__webpack_require__(1790);var _getUpdatedOffsetForIndex2=_interopRequireDefault(_getUpdatedOffsetForIndex);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function updateScrollIndexHelper(_ref){var cellSize=_ref.cellSize;var cellSizeAndPositionManager=_ref.cellSizeAndPositionManager;var previousCellsCount=_ref.previousCellsCount;var previousCellSize=_ref.previousCellSize;var previousScrollToAlignment=_ref.previousScrollToAlignment;var previousScrollToIndex=_ref.previousScrollToIndex;var previousSize=_ref.previousSize;var scrollOffset=_ref.scrollOffset;var scrollToAlignment=_ref.scrollToAlignment;var scrollToIndex=_ref.scrollToIndex;var size=_ref.size;var updateScrollIndexCallback=_ref.updateScrollIndexCallback;var cellCount=cellSizeAndPositionManager.getCellCount();var hasScrollToIndex=scrollToIndex>=0&&scrollToIndex<cellCount;var sizeHasChanged=size!==previousSize||!previousCellSize||typeof cellSize==="number"&&cellSize!==previousCellSize;if(hasScrollToIndex&&(sizeHasChanged||scrollToAlignment!==previousScrollToAlignment||scrollToIndex!==previousScrollToIndex)){updateScrollIndexCallback(scrollToIndex)}else if(!hasScrollToIndex&&cellCount>0&&(size<previousSize||cellCount<previousCellsCount)){scrollToIndex=cellCount-1;var cellMetadatum=cellSizeAndPositionManager.getSizeAndPositionOfCell(scrollToIndex);var calculatedScrollOffset=(0,_getUpdatedOffsetForIndex2.default)({cellOffset:cellMetadatum.offset,cellSize:cellMetadatum.size,containerSize:size,currentOffset:scrollOffset});if(calculatedScrollOffset<scrollOffset){updateScrollIndexCallback(cellCount-1)}}}},1788:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Grid=__webpack_require__(1782);var _Grid2=_interopRequireDefault(_Grid);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(1551);var _classnames2=_interopRequireDefault(_classnames);var _reactAddonsShallowCompare=__webpack_require__(679);var _reactAddonsShallowCompare2=_interopRequireDefault(_reactAddonsShallowCompare);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VirtualScroll=function(_Component){_inherits(VirtualScroll,_Component);function VirtualScroll(props,context){_classCallCheck(this,VirtualScroll);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(VirtualScroll).call(this,props,context));_this._cellRenderer=_this._cellRenderer.bind(_this);_this._onScroll=_this._onScroll.bind(_this);_this._onSectionRendered=_this._onSectionRendered.bind(_this);_this._wrapIndexGetter=_this._wrapIndexGetter.bind(_this);return _this}_createClass(VirtualScroll,[{key:"forceUpdateGrid",value:function forceUpdateGrid(){this.refs.Grid.forceUpdate()}},{key:"measureAllRows",value:function measureAllRows(){this.refs.Grid.measureAllCells()}},{key:"recomputeRowHeights",value:function recomputeRowHeights(){this.refs.Grid.recomputeGridSize();this.forceUpdateGrid()}},{key:"render",value:function render(){var _props=this.props;var className=_props.className;var estimatedRowSize=_props.estimatedRowSize;var height=_props.height;var noRowsRenderer=_props.noRowsRenderer;var rowHeight=_props.rowHeight;var overscanRowCount=_props.overscanRowCount;var autoHeight=_props.autoHeight;var rowClassName=_props.rowClassName;var rowCount=_props.rowCount;var rowStyle=_props.rowStyle;var scrollToAlignment=_props.scrollToAlignment;var scrollToIndex=_props.scrollToIndex;var scrollTop=_props.scrollTop;var style=_props.style;var tabIndex=_props.tabIndex;var width=_props.width;var classNames=(0,_classnames2.default)("VirtualScroll",className);var cellClassName=this._wrapIndexGetter(rowClassName);var cellStyle=this._wrapIndexGetter(rowStyle);return _react2.default.createElement(_Grid2.default,{ref:"Grid","aria-label":this.props["aria-label"],className:classNames,cellRenderer:this._cellRenderer,cellClassName:cellClassName,cellStyle:cellStyle,columnWidth:width,columnCount:1,estimatedRowSize:estimatedRowSize,height:height,noContentRenderer:noRowsRenderer,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,overscanRowCount:overscanRowCount,autoHeight:autoHeight,rowHeight:rowHeight,rowCount:rowCount,scrollToAlignment:scrollToAlignment,scrollToRow:scrollToIndex,scrollTop:scrollTop,style:style,tabIndex:tabIndex,width:width})}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(nextProps,nextState){return(0,_reactAddonsShallowCompare2.default)(this,nextProps,nextState)}},{key:"_cellRenderer",value:function _cellRenderer(_ref){var columnIndex=_ref.columnIndex;var isScrolling=_ref.isScrolling;var rowIndex=_ref.rowIndex;var rowRenderer=this.props.rowRenderer;return rowRenderer({index:rowIndex,isScrolling:isScrolling})}},{key:"_onScroll",value:function _onScroll(_ref2){var clientHeight=_ref2.clientHeight;var scrollHeight=_ref2.scrollHeight;var scrollTop=_ref2.scrollTop;var onScroll=this.props.onScroll;onScroll({clientHeight:clientHeight,scrollHeight:scrollHeight,scrollTop:scrollTop})}},{key:"_onSectionRendered",value:function _onSectionRendered(_ref3){var rowOverscanStartIndex=_ref3.rowOverscanStartIndex;var rowOverscanStopIndex=_ref3.rowOverscanStopIndex;var rowStartIndex=_ref3.rowStartIndex;var rowStopIndex=_ref3.rowStopIndex;var onRowsRendered=this.props.onRowsRendered;onRowsRendered({overscanStartIndex:rowOverscanStartIndex,overscanStopIndex:rowOverscanStopIndex,startIndex:rowStartIndex,stopIndex:rowStopIndex})}},{key:"_wrapIndexGetter",value:function _wrapIndexGetter(value){return value instanceof Function?function(_ref4){var rowIndex=_ref4.rowIndex;return value({index:rowIndex})}:function(){return value}}}]);return VirtualScroll}(_react.Component);VirtualScroll.propTypes={"aria-label":_react.PropTypes.string,autoHeight:_react.PropTypes.bool,className:_react.PropTypes.string,estimatedRowSize:_react.PropTypes.number.isRequired,height:_react.PropTypes.number.isRequired,noRowsRenderer:_react.PropTypes.func.isRequired,onRowsRendered:_react.PropTypes.func.isRequired,overscanRowCount:_react.PropTypes.number.isRequired,onScroll:_react.PropTypes.func.isRequired,rowHeight:_react.PropTypes.oneOfType([_react.PropTypes.number,_react.PropTypes.func]).isRequired,rowRenderer:_react.PropTypes.func.isRequired,rowClassName:_react.PropTypes.oneOfType([_react.PropTypes.string,_react.PropTypes.func]),rowCount:_react.PropTypes.number.isRequired,rowStyle:_react.PropTypes.oneOfType([_react.PropTypes.object,_react.PropTypes.func]),scrollToAlignment:_react.PropTypes.oneOf(["auto","end","start","center"]).isRequired,scrollToIndex:_react.PropTypes.number,scrollTop:_react.PropTypes.number,style:_react.PropTypes.object,tabIndex:_react.PropTypes.number,width:_react.PropTypes.number.isRequired};VirtualScroll.defaultProps={estimatedRowSize:30,noRowsRenderer:function noRowsRenderer(){return null},onRowsRendered:function onRowsRendered(){return null},onScroll:function onScroll(){return null},overscanRowCount:10,scrollToAlignment:"auto",style:{}};exports.default=VirtualScroll},1789:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=createCallbackMemoizer;function createCallbackMemoizer(){var requireAllKeys=arguments.length<=0||arguments[0]===undefined?true:arguments[0];var cachedIndices={};return function(_ref){var callback=_ref.callback;var indices=_ref.indices;var keys=Object.keys(indices);var allInitialized=!requireAllKeys||keys.every(function(key){var value=indices[key];return Array.isArray(value)?value.length>0:value>=0});var indexChanged=keys.length!==Object.keys(cachedIndices).length||keys.some(function(key){var cachedValue=cachedIndices[key];var value=indices[key];return Array.isArray(value)?cachedValue.join(",")!==value.join(","):cachedValue!==value});cachedIndices=indices;if(allInitialized&&indexChanged){callback(indices)}}}},1790:function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=getUpdatedOffsetForIndex;function getUpdatedOffsetForIndex(_ref){var _ref$align=_ref.align;var align=_ref$align===undefined?"auto":_ref$align;var cellOffset=_ref.cellOffset;var cellSize=_ref.cellSize;var containerSize=_ref.containerSize;var currentOffset=_ref.currentOffset;var maxOffset=cellOffset;var minOffset=maxOffset-containerSize+cellSize;switch(align){case"start":return maxOffset;case"end":return minOffset;case"center":return maxOffset-(containerSize+cellSize)/2;default:return Math.max(minOffset,Math.min(maxOffset,currentOffset))}}},1794:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _getPrototypeOf=__webpack_require__(23);var _getPrototypeOf2=_interopRequireDefault(_getPrototypeOf);var _classCallCheck2=__webpack_require__(8);var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=__webpack_require__(9);var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=__webpack_require__(26);var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=__webpack_require__(25);var _inherits3=_interopRequireDefault(_inherits2);var _react=__webpack_require__(1);var _reactRedux=__webpack_require__(21);var _shallowEqual=__webpack_require__(265);var _shallowEqual2=_interopRequireDefault(_shallowEqual);var _actions=__webpack_require__(730);var _selectors=__webpack_require__(1599);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var QueryTerms=function(_Component){(0,_inherits3.default)(QueryTerms,_Component);function QueryTerms(){(0,_classCallCheck3.default)(this,QueryTerms);return(0,_possibleConstructorReturn3.default)(this,(0,_getPrototypeOf2.default)(QueryTerms).apply(this,arguments))}(0,_createClass3.default)(QueryTerms,[{key:"componentWillMount",value:function componentWillMount(){this.request(this.props)}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){if(this.props.siteId===nextProps.siteId&&this.props.taxonomy===nextProps.taxonomy&&(0,_shallowEqual2.default)(this.props.query,nextProps.query)){return}this.request(nextProps)}},{key:"request",value:function request(props){if(props.requesting||!props.siteId){return}props.requestSiteTerms(props.siteId,props.taxonomy,props.query)}},{key:"shouldComponentUpdate",value:function shouldComponentUpdate(){return false}},{key:"render",value:function render(){return null}}]);return QueryTerms}(_react.Component);QueryTerms.propTypes={siteId:_react.PropTypes.number.isRequired,taxonomy:_react.PropTypes.string.isRequired,query:_react.PropTypes.object,requesting:_react.PropTypes.bool.isRequired,requestSiteTerms:_react.PropTypes.func.isRequired};QueryTerms.defaultProps={query:{}};exports.default=(0,_reactRedux.connect)(function(state,ownProps){return{requesting:(0,_selectors.isRequestingTermsForQuery)(state,ownProps.siteId,ownProps.taxonomy,ownProps.query)}},{requestSiteTerms:_actions.requestSiteTerms})(QueryTerms);module.exports=exports["default"]},1815:function(module,exports){"use strict";module.exports={editLinkForPage:function editLinkForPage(page,site){if(!(page&&page.ID)||!(site&&site.ID)){return null}return"/page/"+site.slug+"/"+page.ID},isFrontPage:function isFrontPage(page,site){if(!page||!page.ID||!site||!site.options){return false}return site.options.page_on_front===page.ID}}},1820:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends2=__webpack_require__(19);var _extends3=_interopRequireDefault(_extends2);var _reduce2=__webpack_require__(125);var _reduce3=_interopRequireDefault(_reduce2);var _range2=__webpack_require__(678);var _range3=_interopRequireDefault(_range2);var _memoize2=__webpack_require__(693);var _memoize3=_interopRequireDefault(_memoize2);var _map2=__webpack_require__(50);var _map3=_interopRequireDefault(_map2);var _filter2=__webpack_require__(69);var _filter3=_interopRequireDefault(_filter2);var _isEqual2=__webpack_require__(92);var _isEqual3=_interopRequireDefault(_isEqual2);var _includes2=__webpack_require__(34);var _includes3=_interopRequireDefault(_includes2);var _difference2=__webpack_require__(112);var _difference3=_interopRequireDefault(_difference2);var _debounce2=__webpack_require__(343);var _debounce3=_interopRequireDefault(_debounce2);var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _reactRedux=__webpack_require__(21);var _classnames=__webpack_require__(11);var _classnames2=_interopRequireDefault(_classnames);var _i18nCalypso=__webpack_require__(13);var _VirtualScroll=__webpack_require__(1682);var _VirtualScroll2=_interopRequireDefault(_VirtualScroll);var _analytics=__webpack_require__(16);var _analytics2=_interopRequireDefault(_analytics);var _noResults=__webpack_require__(1952);var _noResults2=_interopRequireDefault(_noResults);var _search=__webpack_require__(1953);var _search2=_interopRequireDefault(_search);var _formatting=__webpack_require__(83);var _queryTerms=__webpack_require__(1794);var _queryTerms2=_interopRequireDefault(_queryTerms);var _selectors=__webpack_require__(70);var _selectors2=__webpack_require__(1599);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var SEARCH_DEBOUNCE_TIME_MS=500;var DEFAULT_TERMS_PER_PAGE=100;var LOAD_OFFSET=10;var ITEM_HEIGHT=25;var TermTreeSelectorList=_react2.default.createClass({displayName:"TermTreeSelectorList",propTypes:{terms:_react.PropTypes.array,taxonomy:_react.PropTypes.string,multiple:_react.PropTypes.bool,selected:_react.PropTypes.array,search:_react.PropTypes.string,siteId:_react.PropTypes.number,translate:_react.PropTypes.func,defaultTermId:_react.PropTypes.number,lastPage:_react.PropTypes.number,onSearch:_react.PropTypes.func,onChange:_react.PropTypes.func},getInitialState:function getInitialState(){return{searchTerm:"",requestedPages:[1]}},getDefaultProps:function getDefaultProps(){return{analyticsPrefix:"Category Selector",searchThreshold:8,loading:true,terms:[],onSearch:function onSearch(){},onChange:function onChange(){},onNextPage:function onNextPage(){}}},componentWillMount:function componentWillMount(){var _this=this;this.itemHeights={};this.hasPerformedSearch=false;this.virtualScroll=null;this.termIds=(0,_map3.default)(this.props.terms,"ID");this.getTermChildren=(0,_memoize3.default)(this.getTermChildren);this.queueRecomputeRowHeights=(0,_debounce3.default)(this.recomputeRowHeights);this.debouncedSearch=(0,_debounce3.default)(function(){_this.props.onSearch(_this.state.searchTerm)},SEARCH_DEBOUNCE_TIME_MS)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.taxonomy!==this.props.taxonomy){this.setState(this.getInitialState())}if(this.props.terms!==nextProps.terms){this.getTermChildren.cache.clear();this.termIds=(0,_map3.default)(nextProps.terms,"ID")}},componentDidUpdate:function componentDidUpdate(prevProps){var forceUpdate=!(0,_isEqual3.default)(prevProps.selected,this.props.selected)||prevProps.loading&&!this.props.loading||!prevProps.terms&&this.props.terms;if(forceUpdate){this.virtualScroll.forceUpdate()}if(this.props.terms!==prevProps.terms){this.recomputeRowHeights()}},recomputeRowHeights:function recomputeRowHeights(){if(!this.virtualScroll){return}this.virtualScroll.recomputeRowHeights();this.virtualScroll.forceUpdate();if(this.isCompact()){this.forceUpdate()}},setSelectorRef:function setSelectorRef(selectorRef){if(!selectorRef){return}this.setState({selectorRef:selectorRef})},getPageForIndex:function getPageForIndex(index){var _props=this.props;var query=_props.query;var lastPage=_props.lastPage;var perPage=query.number||DEFAULT_TERMS_PER_PAGE;var page=Math.ceil(index/perPage);return Math.max(Math.min(page,lastPage||Infinity),1)},setRequestedPages:function setRequestedPages(_ref){var startIndex=_ref.startIndex;var stopIndex=_ref.stopIndex;var requestedPages=this.state.requestedPages;var pagesToRequest=(0,_difference3.default)((0,_range3.default)(this.getPageForIndex(startIndex-LOAD_OFFSET),this.getPageForIndex(stopIndex+LOAD_OFFSET)+1),requestedPages);if(!pagesToRequest.length){return}this.setState({requestedPages:requestedPages.concat(pagesToRequest)})},setItemRef:function setItemRef(item,itemRef){if(!itemRef||!item){return}var height=this.itemHeights[item.ID]||ITEM_HEIGHT;var nextHeight=itemRef.clientHeight;this.itemHeights[item.ID]=nextHeight;if(height!==nextHeight){this.queueRecomputeRowHeights()}},hasNoSearchResults:function hasNoSearchResults(){return!this.props.loading&&this.props.terms&&!this.props.terms.length&&!!this.state.searchTerm.length},hasNoTerms:function hasNoTerms(){return!this.props.loading&&this.props.terms&&!this.props.terms.length},getItem:function getItem(index){if(this.props.terms){return this.props.terms[index]}},isCompact:function isCompact(){if(!this.props.terms||this.state.searchTerm){return false}return this.props.terms.length<this.props.searchThreshold},isRowLoaded:function isRowLoaded(_ref2){var index=_ref2.index;return this.props.lastPage||!!this.getItem(index)},getTermChildren:function getTermChildren(termId){var terms=this.props.terms;return(0,_filter3.default)(terms,function(_ref3){var parent=_ref3.parent;return parent===termId})},getItemHeight:function getItemHeight(item){var _this2=this;var _recurse=arguments.length<=1||arguments[1]===undefined?false:arguments[1];if(!item){return ITEM_HEIGHT}if(item.parent&&!_recurse&&(0,_includes3.default)(this.termIds,item.parent)){return 0}if(this.itemHeights[item.ID]){return this.itemHeights[item.ID]}return(0,_reduce3.default)(this.getTermChildren(item.ID),function(memo,childItem){return memo+_this2.getItemHeight(childItem,true)},ITEM_HEIGHT)},getRowHeight:function getRowHeight(_ref4){var index=_ref4.index;return this.getItemHeight(this.getItem(index))},getCompactContainerHeight:function getCompactContainerHeight(){var _this3=this;return(0,_range3.default)(0,this.getRowCount()).reduce(function(memo,index){return memo+_this3.getRowHeight({index:index})},0)},getResultsWidth:function getResultsWidth(){var selectorRef=this.state.selectorRef;if(selectorRef){return selectorRef.clientWidth}return 0},getRowCount:function getRowCount(){var count=0;if(this.props.terms){count+=this.props.terms.length}if(this.props.loading||!this.props.terms){count+=1}return count},onSearch:function onSearch(event){var searchTerm=event.target.value;if(this.state.searchTerm&&!searchTerm){this.props.onSearch("")}if(searchTerm===this.state.searchTerm){return}if(!this.hasPerformedSearch){this.hasPerformedSearch=true;_analytics2.default.ga.recordEvent(this.props.analyticsPrefix,"Performed Term Search")}this.setState({searchTerm:searchTerm});this.debouncedSearch()},setVirtualScrollRef:function setVirtualScrollRef(ref){this.virtualScroll=ref},renderItem:function renderItem(item){var _this4=this;var _recurse=arguments.length<=1||arguments[1]===undefined?false:arguments[1];if(item.parent&&!_recurse&&(0,_includes3.default)(this.termIds,item.parent)){return}var onChange=function onChange(){var _props2;for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return(_props2=_this4.props).onChange.apply(_props2,[item].concat(args))};var setItemRef=function setItemRef(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2]}return _this4.setItemRef.apply(_this4,[item].concat(args))};var children=this.getTermChildren(item.ID);var _props3=this.props;var multiple=_props3.multiple;var defaultTermId=_props3.defaultTermId;var translate=_props3.translate;var selected=_props3.selected;var itemId=item.ID;var name=(0,_formatting.decodeEntities)(item.name)||translate("Untitled");var checked=(0,_includes3.default)(selected,itemId);var inputType=multiple?"checkbox":"radio";var disabled=multiple&&checked&&defaultTermId&&1===selected.length&&defaultTermId===itemId;var input=_react2.default.createElement("input",{type:inputType,value:itemId,onChange:onChange,disabled:disabled,checked:checked});return _react2.default.createElement("div",{key:itemId,ref:setItemRef,className:"term-tree-selector__list-item"},_react2.default.createElement("label",null,input,_react2.default.createElement("span",{className:"term-tree-selector__label"},name)),children.length>0&&_react2.default.createElement("div",{className:"term-tree-selector__nested-list"},children.map(function(child){return _this4.renderItem(child,true)})))},renderNoResults:function renderNoResults(){if(this.hasNoSearchResults()||this.hasNoTerms()){return _react2.default.createElement("div",{key:"no-results",className:"term-tree-selector__list-item is-empty"},(this.hasNoSearchResults()||!this.props.emptyMessage)&&_react2.default.createElement(_noResults2.default,{createLink:this.props.createLink}),this.hasNoTerms()&&this.props.emptyMessage)}},renderRow:function renderRow(_ref5){var index=_ref5.index;var item=this.getItem(index);if(item){return this.renderItem(item)}return _react2.default.createElement("div",{key:"placeholder",className:"term-tree-selector__list-item is-placeholder"},_react2.default.createElement("label",null,_react2.default.createElement("input",{type:this.props.multiple?"checkbox":"radio",disabled:true,className:"term-tree-selector__input"}),_react2.default.createElement("span",{className:"term-tree-selector__label"},this.props.translate("Loading"))))},render:function render(){var rowCount=this.getRowCount();var isCompact=this.isCompact();var searchLength=this.state.searchTerm.length;var showSearch=(searchLength>0||!isCompact)&&(this.props.terms||!this.props.terms&&searchLength>0);var _props4=this.props;var className=_props4.className;var loading=_props4.loading;var siteId=_props4.siteId;var taxonomy=_props4.taxonomy;var query=_props4.query;var classes=(0,_classnames2.default)("term-tree-selector",className,{"is-loading":loading,"is-compact":isCompact});return _react2.default.createElement("div",{ref:this.setSelectorRef,className:classes},this.state.requestedPages.map(function(page){return _react2.default.createElement(_queryTerms2.default,{key:"query-"+page,siteId:siteId,taxonomy:taxonomy,query:(0,_extends3.default)({},query,{page:page})})}),showSearch&&_react2.default.createElement(_search2.default,{searchTerm:this.state.searchTerm,onSearch:this.onSearch}),_react2.default.createElement(_VirtualScroll2.default,{ref:this.setVirtualScrollRef,width:this.getResultsWidth(),height:isCompact?this.getCompactContainerHeight():300,onRowsRendered:this.setRequestedPages,rowCount:rowCount,estimatedRowSize:ITEM_HEIGHT,rowHeight:this.getRowHeight,rowRenderer:this.renderRow,noRowsRenderer:this.renderNoResults,className:"term-tree-selector__results"}))}});exports.default=(0,_reactRedux.connect)(function(state,ownProps){var siteId=(0,_selectors.getSelectedSiteId)(state);var taxonomy=ownProps.taxonomy;var query=ownProps.query;return{loading:(0,_selectors2.isRequestingTermsForQueryIgnoringPage)(state,siteId,taxonomy,query),terms:(0,_selectors2.getTermsForQueryIgnoringPage)(state,siteId,taxonomy,query),lastPage:(0,_selectors2.getTermsLastPageForQuery)(state,siteId,taxonomy,query),siteId:siteId,query:query}})((0,_i18nCalypso.localize)(TermTreeSelectorList));module.exports=exports["default"]},1891:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _promise=__webpack_require__(51);var _promise2=_interopRequireDefault(_promise);exports.isInjectedNewPageItem=isInjectedNewPageItem;exports.default=MenuData;var _debug=__webpack_require__(4);var _debug2=_interopRequireDefault(_debug);var _assign=__webpack_require__(29);var _assign2=_interopRequireDefault(_assign);var _omit=__webpack_require__(18);var _omit2=_interopRequireDefault(_omit);var _without=__webpack_require__(190);var _without2=_interopRequireDefault(_without);var _includes=__webpack_require__(34);var _includes2=_interopRequireDefault(_includes);var _find=__webpack_require__(33);var _find2=_interopRequireDefault(_find);var _cloneDeep=__webpack_require__(160);var _cloneDeep2=_interopRequireDefault(_cloneDeep);var _cloneDeepWith=__webpack_require__(785);var _cloneDeepWith2=_interopRequireDefault(_cloneDeepWith);var _findIndex=__webpack_require__(351);var _findIndex2=_interopRequireDefault(_findIndex);var _iteratee=__webpack_require__(3188);var _iteratee2=_interopRequireDefault(_iteratee);var _i18nCalypso=__webpack_require__(13);var _i18nCalypso2=_interopRequireDefault(_i18nCalypso);var _wp=__webpack_require__(22);var _wp2=_interopRequireDefault(_wp);var _emitter=__webpack_require__(32);var _emitter2=_interopRequireDefault(_emitter);var _sitesList=__webpack_require__(55);var _sitesList2=_interopRequireDefault(_sitesList);var _untrailingslashit=__webpack_require__(266);var _untrailingslashit2=_interopRequireDefault(_untrailingslashit);var _trailingslashit=__webpack_require__(391);var _trailingslashit2=_interopRequireDefault(_trailingslashit);var _helpers=__webpack_require__(1815);var _treeTraverser=__webpack_require__(1620);var _treeTraverser2=_interopRequireDefault(_treeTraverser);var _treeConvert=__webpack_require__(1619);var _treeConvert2=_interopRequireDefault(_treeConvert);var _promises=__webpack_require__(2421);var _formatting=__webpack_require__(83);var _actions=__webpack_require__(1453);var _actions2=_interopRequireDefault(_actions);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:menu-data");var sites=(0,_sitesList2.default)();var treeConvert=new _treeConvert2.default;var DEFAULT_MENU_ID=0;var HOMEPAGE_MENU_ITEM_ID=-99;var NEWPAGE_MENU_ITEM_ID=-100;function isInjectedNewPageItem(content){return content.content_id===NEWPAGE_MENU_ITEM_ID}function MenuData(){this.data={};this.idCounter=1;this.hasContentsChanged=false;this.hasAssociationChanged=false;sites.on("change",this.updateInstance.bind(this));this.updateInstance()}(0,_emitter2.default)(MenuData.prototype);MenuData.prototype.generateHomePageMenuItem=function(pageNameSuffix){return{ID:HOMEPAGE_MENU_ITEM_ID,content_id:HOMEPAGE_MENU_ITEM_ID,url:(0,_trailingslashit2.default)(this.site.URL),name:_i18nCalypso2.default.translate("Home")+(pageNameSuffix?": "+pageNameSuffix:""),type:"page",type_family:"post_type",tags:[_i18nCalypso2.default.translate("site")],
status:"publish"}};MenuData.prototype.generateNewPageMenuItem=function(){return{ID:NEWPAGE_MENU_ITEM_ID,content_id:NEWPAGE_MENU_ITEM_ID,url:(0,_trailingslashit2.default)(this.site.URL),name:_i18nCalypso2.default.translate("Create a new page for this menu item"),type:"page",type_family:"post_type",tags:[],status:"publish"}};MenuData.prototype.updateInstance=function(){var site=sites.getSelectedSite();if(site&&site.ID!==this.siteID){debug("site changed, fetching data...");this.siteID=site.ID;this.site=site;this.data={};this.fetch()}};MenuData.prototype.get=function(){return{locations:this.data.locations,menus:this.data.menus,hasDefaultMenu:this.data.defaultMenu!==false,hasContentsChanged:this.hasContentsChanged,hasAssociationChanged:this.hasAssociationChanged,hasChanged:this.hasContentsChanged||this.hasAssociationChanged}};MenuData.prototype.fetch=function(){var _this=this;var requestedSiteID=this.siteID;_wp2.default.undocumented().menus(this.siteID,function(error,data){if(error){_this.emit("error",_i18nCalypso2.default.translate("There was a problem fetching your menu data."));debug("Error",error,data)}if(requestedSiteID!==_this.siteID){return}debug("Raw data:",data);_this.data=_this.parse(data);debug("Parsed data:",_this.data);_this.change({reset:true})})};MenuData.prototype.parse=function(data){if(!data.locations.length){this.emit("error",_i18nCalypso2.default.translate("There must be at least one location for a menu in your theme."))}return{locations:data.locations.map(this.decodeProperties.bind(this,["name","description"])),menus:data.menus.map(this.parseMenu,this)}};MenuData.prototype.parseMenu=function(menu){menu=this.allocateClientIDs(menu);menu=this.decodeProperties(["description"],menu);menu=_treeTraverser2.default.traverse(menu,[function(item){return this.decodeProperties(["name"],item)}.bind(this)]);menu=this.interceptLoadForHomepageLink(menu);return menu};MenuData.prototype.change=function(options){options=options||{};this.hasContentsChanged=!options.reset&&!options.associationOnly;this.hasAssociationChanged=options.associationOnly;this.lastChangedMenuID=options.menuID;this.emit("change")};MenuData.prototype.discard=function(){this.once("change",function(){this.emit("saved")},this);this.fetch()};MenuData.prototype.ensureContentsSaved=function(shouldDiscard,action){if(this.hasContentsChanged){if(shouldDiscard()){this.once("saved",action);this.discard()}}else{action()}};MenuData.prototype.restoreServerIDs=function(menu){if(!("items"in menu)||!Array.isArray(menu.items)){return}menu.items.forEach(function(it){_treeTraverser2.default.traverse(it,[function(node){if(node.server_id){node.id=node.server_id}else{delete node.id}return node}])})};MenuData.prototype.allocateClientIDs=function(menu){if(!("items"in menu)||!Array.isArray(menu.items)){return menu}menu.items.forEach(function(it){_treeTraverser2.default.traverse(it,[function(item){item.server_id=item.id;item.id=this.idCounter++;return item}.bind(this)])},this);return menu};MenuData.prototype.decodeProperties=function(properties,obj){return(0,_cloneDeepWith2.default)(obj,function(value,key){return(0,_includes2.default)(properties,key)?(0,_formatting.decodeEntities)(value):undefined})};MenuData.prototype.isValidMenu=function(menu){return menu&&this.find({id:menu.id},this.data.menus)};MenuData.prototype.getPrimaryLocation=function(){var primaryLocation;if(!this.data.locations||!this.data.locations[0]){return false}primaryLocation=(0,_find2.default)(this.data.locations,{name:"primary"});return(primaryLocation||this.data.locations[0]).name};MenuData.prototype.getMenu=function(locationName){var menu;if(!this.data.menus){return null}menu=(0,_find2.default)(this.data.menus,function(_menu){return(0,_includes2.default)(_menu.locations,locationName)});return menu||null};MenuData.prototype.interceptSaveForHomepageLink=function(menu){var site=this.site;menu.items.filter(function(item){return item.type==="page"&&item.content_id===HOMEPAGE_MENU_ITEM_ID}).forEach(function(item){item.type="custom";item.type_family="custom";item.url=(0,_trailingslashit2.default)(site.URL)});return menu};MenuData.prototype.interceptLoadForHomepageLink=function(menu){var site=this.site;menu.items.filter(function(item){return item.type==="custom"&&(0,_untrailingslashit2.default)(item.url)===(0,_untrailingslashit2.default)(site.URL)}).forEach(function(item){item.type="page";item.type_family="post_type";item.content_id=HOMEPAGE_MENU_ITEM_ID});return menu};MenuData.prototype.createNewPagePromise=function(menuItem,siteID){return new _promise2.default(function(resolve,reject){_actions2.default.startEditingNew(siteID);_actions2.default.saveEdited({title:menuItem.name,ID:"new",type:"page",status:"publish"},function(error,data){_actions2.default.stopEditing();if(!error&&data){menuItem.url=data.URL;menuItem.content_id=data.ID;resolve();return}reject(error)})})};MenuData.prototype.sendMenuToApi=function(menu,callback){var _this2=this;this.emit("saving");_wp2.default.undocumented().menusUpdate(this.siteID,menu.id,this.interceptSaveForHomepageLink(menu),function(error,data){if(error){_this2.emit("error",_i18nCalypso2.default.translate("There was a problem saving your menu."));debug("Error",error,data);return}var parsedMenu=_this2.parseMenu(data.menu);parsedMenu.lastSaveTime=Date.now();_this2.replaceMenu(parsedMenu);_this2.change({reset:true});_this2.emit("saved");callback&&callback(null,parsedMenu)})};MenuData.prototype.saveMenu=function(menu,callback){var _this3=this;if(!menu){menu=this.find({id:this.lastChangedMenuID})}if(!this.isValidMenu(menu)){callback&&callback(new Error("Invalid menu"));debug("saveMenu: fail");return}menu=(0,_cloneDeep2.default)(menu);if(menu.id===this.getDefaultMenuId()){return this.saveDefaultMenu()}this.restoreServerIDs(menu);debug("saveMenu",menu);var pendingPageItems=treeConvert.untreeify(menu.items).filter(isInjectedNewPageItem);var createdPages=(0,_promises.makePromiseSequence)(pendingPageItems,function(item){return _this3.createNewPagePromise(item,_this3.siteID)});createdPages.catch(function(error){_this3.emit("error",_i18nCalypso2.default.translate("There was a problem saving your menu."));debug("Error",error)}).then(this.sendMenuToApi.bind(this,menu,callback))};MenuData.prototype.deleteMenu=function(menu,callback){var _this4=this;var menuIndex,menusBackup;if(!this.isValidMenu(menu)){this.emit("error",_i18nCalypso2.default.translate("This menu is invalid and can't be deleted."));callback&&callback(new Error("Invalid menu"));return false}menusBackup=this.data.menus.slice();menuIndex=(0,_findIndex2.default)(this.data.menus,{id:menu.id});this.deletedMenu=this.data.menus.splice(menuIndex,1)[0];this.emit("change");this.emit("saving");_wp2.default.undocumented().menusDelete(this.siteID,menu.id,function(error,data){if(error||data&&!data.deleted){_this4.data.menus=menusBackup;_this4.emit("error",_i18nCalypso2.default.translate("Sorry, we couldn't delete this menu."));_this4.emit("change");callback&&callback(new Error("Error deleting menu"));return}else if(!_this4.lastChangedMenuID){_this4.change({reset:true})}callback&&callback(null,data);_this4.emit("saved")})};MenuData.prototype.restoreMenu=function(location,callback){var menu;if(this.deletedMenu===undefined){debug("No menu to restore");callback&&callback(new Error("No menu to restore"));return}menu=this.clearIDs(this.deletedMenu);this.allocateClientIDs(menu);delete this.deletedMenu;this.addMenu(menu.name,function(error,addedMenu){if(error){debug("restoreMenu: fail");callback&&callback(new Error("Failed to restore menu"));return}this.setMenuAtLocation(addedMenu.id,location,{associationOnly:false});this.saveMenu(addedMenu,callback)}.bind(this),menu)};MenuData.prototype.clearIDs=function(menu){return _treeTraverser2.default.traverse(menu,[function(item){return(0,_omit2.default)(item,["id","server_id"])}])};MenuData.prototype.setMenuName=function(menuId,name){var menu=(0,_find2.default)(this.data.menus,{id:menuId});if(menu&&name){menu.name=name;this.change()}else{this.emit("change")}};MenuData.prototype.setMenuAtLocation=function(menuId,locationName,changeOpts){var location=(0,_find2.default)(this.data.locations,{name:locationName}),previousMenu,previousMenuId,menu;if(!location){return false}previousMenu=(0,_find2.default)(this.data.menus,function(itemMenu){return(0,_includes2.default)(itemMenu.locations,locationName)});if(previousMenu){previousMenu.locations=(0,_without2.default)(previousMenu.locations,locationName)}menu=(0,_find2.default)(this.data.menus,{id:menuId});if(menu&&this.isValidMenu(menu)){menu.locations.push(locationName)}if(previousMenu){previousMenuId=previousMenu.id}this.change((0,_assign2.default)({associationOnly:true,menuID:this.lastChangedMenuID||previousMenuId},changeOpts))};MenuData.prototype.updateMenuItem=function(newItem){this.replaceItem({id:newItem.id},newItem);this.change()};MenuData.prototype.moveItem=function(sourceId,targetId,position){this.data.menus.some(function(menu,i){var source=this.find({id:sourceId},menu.items),target=this.find({id:targetId},menu.items);if(undefined!==source&&undefined!==target){if(this.isAncestor(source,target)){var parent=_treeTraverser2.default.parent(source,menu);this.moveItemsToParent(source.items,parent,{silent:true})}this.data.menus[i]=_treeTraverser2.default.traverse(menu,[_treeTraverser2.default.remover(source.id),_treeTraverser2.default.inserter(source,target.id,position)]);this.change();return true}},this)};MenuData.prototype.getParent=function(itemId){var parent;this.data.menus.some(function(menu){var node=this.find({id:itemId},[menu]);if(node){parent=_treeTraverser2.default.parent(node,menu);return!!(0,_findIndex2.default)(parent.items,{id:itemId})}},this);return parent};MenuData.prototype.getPreviousSibling=function(item,parent){var index=(0,_findIndex2.default)(parent.items,item);if(index){return parent.items[index-1]}};MenuData.prototype.hasSubsequentSiblings=function(item,parent){var index=(0,_findIndex2.default)(parent.items,item);return index>=0&&index<parent.items.length-1};MenuData.prototype.find=function(criterion,menus){var predicate=(0,_iteratee2.default)(criterion),i,result;menus=menus||this.data.menus;for(i=0;i<menus.length;i++){if(result=_treeTraverser2.default.find(menus[i],predicate)){return result}}};MenuData.prototype.findByName=function(name){return this.find({name:name})};MenuData.prototype.replaceItem=function(criterion,newItem,menus){var predicate=(0,_iteratee2.default)(criterion),i;menus=menus||this.data.menus;for(i=0;i<menus.length;i++){_treeTraverser2.default.replaceItem(menus[i],newItem,predicate)}};MenuData.prototype.moveItemsToParent=function(uiItems,parent,options){var hasChanged;options=options||{};if(!Array.isArray(uiItems)){uiItems=[uiItems]}uiItems.forEach(function(uiItem){this.data.menus.some(function(menu){var item=this.find({id:uiItem.id},menu.items);if(undefined!==item){var oldParent=_treeTraverser2.default.parent(uiItem,menu);oldParent.items=(0,_without2.default)(oldParent.items,item);if(!Array.isArray(parent.items)){parent.items=[item]}else{parent.items.push(item)}hasChanged=true;return true}},this)},this);if(hasChanged&&!options.silent){this.change()}};MenuData.prototype.deleteMenuItem=function(uiItem){this.data.menus.some(function(menu){var item=this.find({id:uiItem.id},menu.items);if(undefined!==item){var parent=_treeTraverser2.default.parent(uiItem,menu);if(uiItem.items){this.moveItemsToParent(uiItem.items,parent,{silent:true})}parent.items=(0,_without2.default)(parent.items,item);this.change();return true}},this)};MenuData.prototype.addItem=function(item,targetId,position,menuId){item.id=this.idCounter++;this.data.menus.some(function(menu,i){var target;if(menu.id!==menuId){return}target=this.find({id:targetId},[menu]);if(target){menu=_treeTraverser2.default.traverse(menu,[_treeTraverser2.default.inserter(item,target.id,position)])}else{menu.items=[item]}this.data.menus[i]=menu;this.change();return true},this)};MenuData.prototype.addNewMenu=function(selectedLocation){var _this5=this;this.addMenu(this._incrementMenuName(this.data.menus),function(error,menu){if(error){return}_this5.setMenuAtLocation(menu.id,selectedLocation)})};MenuData.prototype.addMenu=function(name,callback,attributes){var _this6=this;var newMenu=(0,_assign2.default)({name:name,items:[],locations:[]},attributes);_wp2.default.undocumented().menusUpdate(this.siteID,0,newMenu,function(error,data){if(!error&&data.id){newMenu.id=data.id;_this6.data.menus.push(newMenu);debug("new menu",newMenu);_this6.emit("change");callback&&callback(null,newMenu)}else{_this6.emit("error",_i18nCalypso2.default.translate("Sorry, we couldn't create this menu."));debug("error creating menu",error);callback&&callback(error)}})};MenuData.prototype._incrementMenuName=function(menus){var menuString=_i18nCalypso2.default.translate("Menu"),deletedMenus=this.deletedMenu?[this.deletedMenu]:[],menuNumbers=menus.concat(deletedMenus).map(function(menu){var matches;if(matches=menu.name.match(RegExp("^"+menuString+" (\\d+)$"))){return Number(matches[1])}return 0});menuNumbers.push(0);return menuString+" "+(Math.max.apply(Math,menuNumbers)+1)};MenuData.prototype.isAncestor=function(ancestor,descendent){if(ancestor.id===descendent.id){return false}return!!_treeTraverser2.default.find(ancestor,function(node){return node&&node.id===descendent.id})};MenuData.prototype.replaceMenu=function(newMenu){this.data.menus.some(function(menu,i){if(menu.id===newMenu.id){this.data.menus[i]=newMenu;debug("replaced menu",this.data.menus[i]);return true}},this)};MenuData.prototype.getDefaultMenuId=function(){return DEFAULT_MENU_ID};MenuData.prototype.hasDefaultMenu=function(){return this.data.defaultMenu&&this.data.defaultMenu.id===this.getDefaultMenuId()};MenuData.prototype.getDefaultMenu=function(){if(this.data.defaultMenu){return this.data.defaultMenu}!this.fetchingDefaultMenu&&this.fetchDefaultMenu()};MenuData.prototype.fetchDefaultMenu=function(){var _this7=this;var requestedSiteID=this.siteID,params={siteID:this.siteID,type:"page",search:"",parent_id:0,status:"publish",order:"ASC",order_by:"title"};if(!requestedSiteID||!this.data.menus){debug("Site or menu data not loaded yet, not fetching default menu");return}this.data.defaultMenu=false;this.fetchingDefaultMenu=true;_wp2.default.site(requestedSiteID).postsList(params,function(error,data){_this7.fetchingDefaultMenu=false;if(error){_this7.emit("error",_i18nCalypso2.default.translate("There was a problem loading the default menu."));debug("Error",error,data);return}if(requestedSiteID!==_this7.siteID){return}_this7.setDefaultMenu(data.posts)})};MenuData.prototype.setDefaultMenu=function(pages){var items=[],site=sites.getSelectedSite(),isDefaultMenuSet=!!this.data.defaultMenu;pages.forEach(function(page){var item={name:page.title,type:"page",type_family:"post_type",content_id:page.ID,items:[]};if((0,_helpers.isFrontPage)(page,site)){item.name=_i18nCalypso2.default.translate("Home");items.unshift(item)}else{items.push(item)}});this.data.defaultMenu=this.parseMenu({id:0,name:_i18nCalypso2.default.translate("Default Menu"),description:"",items:items,locations:[this.getPrimaryLocation()]});if(!isDefaultMenuSet){this.data.menus.unshift(this.data.defaultMenu)}this.emit("change")};MenuData.prototype.saveDefaultMenu=function(){var newMenu;if(!this.hasContentsChanged){if(this.lastChangedMenuID>0){this.saveMenu()}setTimeout(function(){this.emit("saved");this.change({reset:true})}.bind(this),500);return}newMenu=(0,_cloneDeep2.default)((0,_omit2.default)(this.data.defaultMenu,"id"));this.addMenu(newMenu.name,this.onDefaultMenuSaved.bind(this),newMenu)};MenuData.prototype.onDefaultMenuSaved=function(error,menu){if(menu&&menu.id){this.deleteDefaultMenu();if(menu.name===_i18nCalypso2.default.translate("Default Menu")){menu.name=this._incrementMenuName(this.data.menus)}menu.locations=[this.getPrimaryLocation()];this.saveMenu(menu)}else{debug("onDefaultMenuSaved: fail",error)}};MenuData.prototype.deleteDefaultMenu=function(){var index=this.data.menus.indexOf(this.data.defaultMenu);if(~index){this.data.menus.splice(index,1);delete this.data.defaultMenu}}},1897:function(module,exports,__webpack_require__){"use strict";var PostTypesList=__webpack_require__(1898),_postTypes;module.exports=function(){if(!_postTypes){_postTypes=new PostTypesList}return _postTypes}},1898:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(4)("calypso:post-types-list");var wpcom=__webpack_require__(22),Emitter=__webpack_require__(32);function PostTypesList(){if(!(this instanceof PostTypesList)){return new PostTypesList}}Emitter(PostTypesList.prototype);PostTypesList.prototype.get=function(siteId){if(!this.data||this.siteId!==siteId){this.fetch(siteId);return[]}return this.data};PostTypesList.prototype.fetch=function(siteId){if(!this.fetching||this.siteId!==siteId){this.fetching=true;this.siteId=siteId;debug("getting PostTypesList from api");wpcom.site(siteId).postTypesList(function(error,data){if(error){debug("error fetching PostTypesList from api",error);return}this.data=this.parse(data);this.emit("change");this.fetching=false}.bind(this))}};PostTypesList.prototype.parse=function(data){return data.post_types};PostTypesList.prototype.hasDataForSiteId=function(siteId){return this.data&&this.siteId===siteId};module.exports=PostTypesList},1929:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var analytics=__webpack_require__(16);var MenuPanelBackButton=React.createClass({displayName:"MenuPanelBackButton",onClick:function onClick(){analytics.ga.recordEvent("Menus","Clicked Mobile Menu Item Types Back");this.props.onClick()},render:function render(){return React.createElement("div",{className:"menu-item-back-button"},React.createElement("a",{onClick:this.onClick,className:"noticon noticon-previous"},this.props.label))}});module.exports=MenuPanelBackButton},1951:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _classnames=__webpack_require__(11);var _classnames2=_interopRequireDefault(_classnames);var _terms=__webpack_require__(1820);var _terms2=_interopRequireDefault(_terms);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"TermTreeSelector",propTypes:{multiple:_react.PropTypes.bool,className:_react.PropTypes.string,onChange:_react.PropTypes.func.isRequired,selected:_react.PropTypes.array,createLink:_react.PropTypes.string,analyticsPrefix:_react.PropTypes.string,taxonomy:_react.PropTypes.string},getDefaultProps:function getDefaultProps(){return{analyticsPrefix:"Category Selector",selected:[],taxonomy:"category",onChange:function onChange(){}}},getInitialState:function getInitialState(){return{search:""}},onSearch:function onSearch(searchTerm){if(searchTerm!==this.state.search){this.setState({search:searchTerm})}},render:function render(){var _props=this.props;var className=_props.className;var taxonomy=_props.taxonomy;var onChange=_props.onChange;var selected=_props.selected;var createLink=_props.createLink;var multiple=_props.multiple;var classes=(0,_classnames2.default)(className);var search=this.state.search;var query={};if(search&&search.length){query.search=search}return _react2.default.createElement("div",{className:classes,ref:"wrapper"},_react2.default.createElement(_terms2.default,{taxonomy:taxonomy,onSearch:this.onSearch,onChange:onChange,query:query,selected:selected,createLink:createLink,multiple:multiple}))}});module.exports=exports["default"]},1952:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _mixin=__webpack_require__(105);var _mixin2=_interopRequireDefault(_mixin);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"TermTreeSelectorNoResults",mixins:[_mixin2.default],propTypes:{createLink:_react.PropTypes.string},render:function render(){var createLink=this.props.createLink;var createMessage=void 0;if(createLink){createMessage=this.translate("You may want to {{a}}create a new item{{/a}}.",{context:"Term Selector: term search/listing results",comment:"This is used when no terms match the given search, or if there are no terms at all.",components:{a:_react2.default.createElement("a",{className:"create-link",href:createLink,target:"_blank"})}})}return _react2.default.createElement("span",{className:"is-empty-content"},this.translate("No results. Please try a different search."),"",createMessage)}});module.exports=exports["default"]},1953:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _gridicon=__webpack_require__(28);var _gridicon2=_interopRequireDefault(_gridicon);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}exports.default=_react2.default.createClass({displayName:"TermTreeSelectorSearch",propTypes:{searchTerm:_react.PropTypes.string,onSearch:_react.PropTypes.func.isRequired},render:function render(){return _react2.default.createElement("div",{className:"term-tree-selector__search"},_react2.default.createElement(_gridicon2.default,{icon:"search",size:18}),_react2.default.createElement("input",{type:"search",placeholder:this.translate("Search",{textOnly:true}),value:this.props.searchTerm,onChange:this.props.onSearch}))}});module.exports=exports["default"]},2156:function(module,exports,__webpack_require__){"use strict";var ReactDom=__webpack_require__(43),React=__webpack_require__(1),throttle=__webpack_require__(656),debounce=__webpack_require__(343),debug=__webpack_require__(4)("calypso:menus:option-list");var MenuPanelBackButton=__webpack_require__(1929),EmptyPlaceholder=__webpack_require__(2570),LoadingPlaceholder=__webpack_require__(2571),Gridicon=__webpack_require__(28);var SCROLL_THROTTLE_TIME_MS=400,SEARCH_DEBOUNCE_TIME_MS=500;var Search=React.createClass({displayName:"Search",propTypes:{itemType:React.PropTypes.string,searchTerm:React.PropTypes.string,onSearch:React.PropTypes.func.isRequired},render:function render(){return React.createElement("div",{className:"search-container"},React.createElement(Gridicon,{icon:"search",size:18}),React.createElement("input",{type:"search",className:"search-box",placeholder:this.translate("Search",{textOnly:true}),value:this.props.searchTerm,onChange:this.props.onSearch}))}});var OptionList=React.createClass({displayName:"OptionList",propTypes:{itemType:React.PropTypes.object.isRequired,onScroll:React.PropTypes.func.isRequired,onBackClick:React.PropTypes.func.isRequired,onSearch:React.PropTypes.func.isRequired,isEmpty:React.PropTypes.bool.isRequired,isLoading:React.PropTypes.bool.isRequired},getInitialState:function getInitialState(){return{searchTerm:null}},componentWillMount:function componentWillMount(){this.debouncedSearch=debounce(function(){this.props.onSearch(this.state.searchTerm)}.bind(this),SEARCH_DEBOUNCE_TIME_MS)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){if(nextProps.itemType.name!==this.props.itemType.name){this.setState({searchTerm:null});this.props.onSearch(null)}},checkScrollPosition:throttle(function(){var node=ReactDom.findDOMNode(this);if(node.scrollTop+node.clientHeight>=node.scrollHeight){this.props.onScroll()}},SCROLL_THROTTLE_TIME_MS),onSearch:function onSearch(event){this.setState({searchTerm:event.target.value});this.debouncedSearch()},render:function render(){return React.createElement("div",{className:"menu-item-options",onScroll:this.checkScrollPosition},React.createElement(MenuPanelBackButton,{label:this.props.itemType.label,onClick:this.props.onBackClick}),(!this.props.isEmpty&&!this.props.isLoading||this.state.searchTerm!==null)&&React.createElement(Search,{searchTerm:this.state.searchTerm,onSearch:this.onSearch}),React.createElement("form",null,this.props.children,this.props.isLoading&&React.createElement(LoadingPlaceholder,null),this.props.isEmpty&&this.props.itemType==="page"&&React.createElement(EmptyPlaceholder,{isSearch:!!(this.state.searchTerm&&this.state.searchTerm.length),createLink:this.props.itemType.createLink,typeName:this.props.itemType.name})))}});module.exports=OptionList},2157:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _menuUtils=__webpack_require__(2159);var _menuData=__webpack_require__(1891);var _classnames=__webpack_require__(11);var _classnames2=_interopRequireDefault(_classnames);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var Options=_react2.default.createClass({displayName:"Options",propTypes:{item:_react2.default.PropTypes.object.isRequired,options:_react2.default.PropTypes.array.isRequired,onChange:_react2.default.PropTypes.func.isRequired},renderItemTags:function renderItemTags(tags){var tagElements;if(tags&&tags.length){tagElements=tags.map(function(tag){return _react2.default.createElement("span",{className:"menu-item-tag",key:tag},tag)});return _react2.default.createElement("span",{className:"menu-item-tag-container"},tagElements)}},renderItem:function renderItem(item){var checked=item.ID===this.props.item.content_id&&this.props.itemType.name===this.props.item.type;var classes=(0,_classnames2.default)({"option-is-private":item.status&&item.status==="private","create-new-item":(0,_menuData.isInjectedNewPageItem)(item)});return _react2.default.createElement("li",{key:this.props.itemType.name+"-"+item.ID,className:classes},_react2.default.createElement("div",null,_react2.default.createElement("input",{id:"option-"+item.ID,type:"radio",name:"radios",value:item.ID,onChange:this.props.onChange.bind(null,item),checked:checked}),_react2.default.createElement("label",{htmlFor:"option-"+item.ID},(0,_menuUtils.getContentTitle)(item)),this.renderItemTags(item.tags)),item.items?this.renderHierarchy(item.items,true):null)},renderHierarchy:function renderHierarchy(items,isRecursive){var depth=isRecursive?"":"depth-0";return _react2.default.createElement("ul",{className:depth},items.map(this.renderItem,this))},render:function render(){return this.renderHierarchy(this.props.options)}});exports.default=Options;module.exports=exports["default"]},2158:function(module,exports,__webpack_require__){"use strict";var find=__webpack_require__(33),i18n=__webpack_require__(13);var sites=__webpack_require__(55)(),postTypes=__webpack_require__(1897)(),Emitter=__webpack_require__(32),TagsList=__webpack_require__(2443),debug=__webpack_require__(4)("calypso:menus:menu-item-types");var instance;function MenuItemTypes(){if(!(this instanceof MenuItemTypes)){return new MenuItemTypes}postTypes.on("change",this.parse.bind(this));sites.on("change",function(){var site=sites.getSelectedSite(),currentSiteID=this.site&&this.site.ID;if(site&&site.ID!==currentSiteID){debug("Site changed, clearing data");this.init(site)}}.bind(this));if(sites.fetched){this.init(sites.getSelectedSite())}}Emitter(MenuItemTypes.prototype);MenuItemTypes.prototype.init=function(site){this.data=[];if(!site){return}this.site=site;this.fetched=false;this.initializeDefaultTypes();this.fetch()};MenuItemTypes.prototype.initializeDefaultTypes=function(){this._defaultItemTypes=[{name:"page",family:"post_type",icon:"document",renderer:"renderPostOptions",show:true,label:i18n.translate("Page"),createLink:"//wordpress.com/page/"+this.site.ID+"/new",gaEventLabel:"Page"},{name:"custom",family:"custom",icon:"link",renderer:"renderLinkOptions",show:true,label:i18n.translate("Link"),gaEventLabel:"Link"},{name:"category",family:"taxonomy",icon:"category",renderer:"renderCategoryOptions",show:true,label:i18n.translate("Category"),createLink:this.site.options.admin_url+"edit-tags.php?taxonomy=category",gaEventLabel:"Category"},{name:"post_tag",family:"taxonomy",icon:"tag",contentsList:new TagsList(this.site.ID),renderer:"renderTaxonomyOptions",show:true,label:i18n.translate("Tag"),createLink:this.site.options.admin_url+"edit-tags.php?taxonomy=post_tag",gaEventLabel:"Tag"},{name:"post_format",family:"taxonomy",icon:"summary",renderer:"renderTaxonomyContents",show:false,label:i18n.translate("Post Format"),gaEventLabel:"Post Format"},{name:"post",family:"post_type",icon:"standard",renderer:"renderPostOptions",show:true,label:i18n.translate("Post"),createLink:"//wordpress.com/post/"+this.site.ID+"/new",gaEventLabel:"Post"}]};MenuItemTypes.prototype.get=function(){if(!this.site){return[]}return this._defaultItemTypes.concat(this.data)};MenuItemTypes.prototype.fetch=function(){var types;debug("Fetching post types");types=postTypes.get(this.site.ID);if(types.length>0){this.parse()}};MenuItemTypes.prototype.parse=function(){var newTypes,types=postTypes.get(this.site.ID);debug("Parsing post types",types);this.fetched=true;newTypes=types.filter(function(type){return find(this._defaultItemTypes,{name:type.name})===undefined&&type.api_queryable===true&&type.map_meta_cap===true},this);debug("Found some new types",newTypes);newTypes.forEach(function(type){this.data.push({name:type.name,family:"post_type",icon:"standard",renderer:"renderPostOptions",show:true,label:type.label,createLink:this.site.options.admin_url+"post-new.php?post_type="+type.name,gaEventLabel:type.label})},this);this.emit("change")};instance=new MenuItemTypes;module.exports=instance},2159:function(module,exports,__webpack_require__){"use strict";var i18n=__webpack_require__(13);var sites=__webpack_require__(55)(),decodeEntities=__webpack_require__(83).decodeEntities;module.exports={getNavMenusUrl:function getNavMenusUrl(){var site=sites.getSelectedSite();return site.options.admin_url+"nav-menus.php"},getContentTitle:function getContentTitle(content){return content.title||content.name&&decodeEntities(content.name)||i18n.translate("Untitled")}}},2160:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),classNames=__webpack_require__(11),debug=__webpack_require__(4)("calypso:menus:save-button");var analytics=__webpack_require__(16);var MenuSaveButton=React.createClass({displayName:"MenuSaveButton",componentWillMount:function componentWillMount(){this.props.menuData.on("saved",this.setSaved);this.props.menuData.on("error",this.setSaved)},componentWillUnmount:function componentWillUnmount(){this.props.menuData.off("saved",this.setSaved);this.props.menuData.off("error",this.setSaved)},getInitialState:function getInitialState(){return{saving:false}},setSaving:function setSaving(){this.setState({saving:true})},setSaved:function setSaved(){this.setState({saving:false})},save:function save(){analytics.ga.recordEvent("Menus","Clicked Save Menu Button");this.setSaving();return this.props.menuData.saveMenu(this.props.selectedMenu)},render:function render(){var hasChanged=this.props.menuData.get().hasChanged,classes=classNames({button:true,"is-primary":true,saving:this.state.saving});return React.createElement("button",{className:classes,disabled:!hasChanged,onClick:this.save},this.state.saving?this.translate("Saving"):this.translate("Save"))}});module.exports=MenuSaveButton},2412:function(module,exports){"use strict";function Pageable(prototype){prototype.fetchingNextPage=false;prototype.errors=[];prototype.page=0;prototype.lastPage=false;prototype.fetch=function(options,callback){throw new Error("You must implement this in your collection.")};prototype.parse=function(data,siteID){throw new Error("You must implement this in your collection.")};prototype.fetchNextPage=function(){var options={};if(this.fetchingNextPage||this.lastPage){return}options.number=this.perPage;options.page=this.page=this.page+1;if(this.search){
options.search=this.search}this.fetchingNextPage=true;this.fetch(options,this.fetchCallback.bind(this))};prototype.fetchCallback=function(error){this.fetchingNextPage=false;if(error){this.page--}};prototype.handleResponse=function(options,callback,error,data){var objects;this.found=data&&data.found&&parseInt(data.found,10);if(error){this.errors.push(error);if(callback){callback(error,data)}this.emit("change");return}objects=this.objectFactory(this.parse(data,this.siteID));if(options.page>1&&!objects.length){this.page--}else{if(objects.length){this.data=this.data.concat(objects)}else{this.page--}}if(this.isLastPage(objects)){this.lastPage=true}if(callback){callback(error,objects)}this.emit("change")};prototype.isLastPage=function(objects){return this.found===this.data.length};prototype.objectFactory=function(objects){return objects};prototype.setSearch=function(term){this.reset();this.search=term||null};prototype.reset=function(){this.data=[];this.errors=[];this.search=null;this.page=0;this.fetchingNextPage=false;this.lastPage=false}}module.exports=Pageable},2421:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.makePromiseSequence=undefined;var _promise=__webpack_require__(51);var _promise2=_interopRequireDefault(_promise);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var makePromiseSequence=exports.makePromiseSequence=function makePromiseSequence(list,fn){return list.reduce(function(acc,curr){return acc.then(fn.bind(null,curr))},_promise2.default.resolve())}},2443:function(module,exports,__webpack_require__){"use strict";var debug=__webpack_require__(4)("calypso:tags-list");var wpcom=__webpack_require__(22),Emitter=__webpack_require__(32),Pageable=__webpack_require__(2412);function TagsList(siteID){if(!(this instanceof TagsList)){return new TagsList(siteID)}this.siteID=siteID;this.data=[];this.perPage=100}Emitter(TagsList.prototype);Pageable(TagsList.prototype);TagsList.prototype.get=function(){return this.data};TagsList.prototype.fetch=function(options,callback){var query=options||{},normalizedSiteID=(""+this.siteID).replace(/::/g,"/");if(!this.siteID){debug("Endpoint needs a site id to fetch from");return}debug("Fetching tags for %s %o",this.siteID,query);wpcom.site(normalizedSiteID).tagsList(options,this.handleResponse.bind(this,options,callback))};TagsList.prototype.parse=function(data){return data.tags};module.exports=TagsList},2568:function(module,exports,__webpack_require__){"use strict";var _actions=__webpack_require__(648);var ReactDom=__webpack_require__(43),React=__webpack_require__(1),i18n=__webpack_require__(13),ReactRedux=__webpack_require__(21);var sites=__webpack_require__(55)(),route=__webpack_require__(122),analytics=__webpack_require__(16),MainComponent=__webpack_require__(147),JetpackManageErrorPage=__webpack_require__(670),itemTypes=__webpack_require__(2158),MenusComponent=__webpack_require__(2577),notices=__webpack_require__(71),siteMenus=__webpack_require__(1656);var controller={menus:function menus(context){var analyticsPageTitle="Menus",basePath=route.sectionify(context.path),site=sites.getSelectedSite(),baseAnalyticsPath;if(site&&site.capabilities&&!site.capabilities.edit_theme_options){notices.error(i18n.translate("You are not authorized to manage settings for this site."));return}context.store.dispatch((0,_actions.setDocumentHeadTitle)(i18n.translate("Menus",{textOnly:true})));function renderJetpackUpgradeMessage(){ReactDom.render(React.createElement(MainComponent,null,React.createElement(JetpackManageErrorPage,{template:"updateJetpack",site:site,version:"3.5",illustration:"/calypso/images/drake/drake-nomenus.svg",secondaryAction:i18n.translate("Open Classic Menu Editor"),secondaryActionURL:site.options.admin_url+"nav-menus.php",secondaryActionTarget:"_blank"})),document.getElementById("primary"))}if(site&&site.jetpack&&!site.hasJetpackMenus){renderJetpackUpgradeMessage();return}if(site){baseAnalyticsPath=basePath+"/:site"}else{baseAnalyticsPath=basePath}analytics.pageView.record(baseAnalyticsPath,analyticsPageTitle);ReactDom.render(React.createElement(ReactRedux.Provider,{store:context.store},React.createElement(MenusComponent,{siteMenus:siteMenus,itemTypes:itemTypes,key:siteMenus.siteID,site:site})),document.getElementById("primary"))}};module.exports=controller},2569:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),isEqual=__webpack_require__(92),debug=__webpack_require__(4)("calypso:menus:categories-options");var MenuPanelBackButton=__webpack_require__(1929),CategorySelector=__webpack_require__(1951);function categoryObjectFromItem(menuItem){var selectedCategory={};if(menuItem&&menuItem.content_id){selectedCategory={ID:menuItem.content_id}}return selectedCategory}module.exports=React.createClass({displayName:"MenusCategoriesOptions",propTypes:{siteId:React.PropTypes.number.isRequired,selected:React.PropTypes.object,itemType:React.PropTypes.object,onBackClick:React.PropTypes.func.isRequired,onChange:React.PropTypes.func.isRequired},getInitialState:function getInitialState(){var selected=[];if(this.props.selected){selected.push(categoryObjectFromItem(this.props.selected))}return{selected:selected}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){var nextSelection=categoryObjectFromItem(nextProps.selected),currentSelection=categoryObjectFromItem(this.props.selected);if(!isEqual(nextSelection,currentSelection)){this.setState({selected:[nextSelection]})}},onChange:function onChange(item){debug("setting selected",item);this.props.onChange(item);this.setState({selected:[item]})},getSelectedIds:function getSelectedIds(){return this.state.selected.map(function(item){if(!item.ID){return item}return item.ID})},render:function render(){debug("rendering",this.props);return React.createElement("div",{className:"menu-item-options menu-item-options__term-tree-selector"},React.createElement(MenuPanelBackButton,{label:this.props.itemType.label,onClick:this.props.onBackClick}),React.createElement(CategorySelector,{analyticsPrefix:"Menus",onChange:this.onChange,createLink:this.props.itemType.createLink,selected:this.getSelectedIds()}))}})},2570:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var EmptyPlaceholder=React.createClass({displayName:"EmptyPlaceholder",propTypes:{typeName:React.PropTypes.string.isRequired,createLink:React.PropTypes.string.isRequired,isSearch:React.PropTypes.bool},getDefaultProps:function getDefaultProps(){return{isSearch:false}},createOptionMessage:function createOptionMessage(){switch(this.props.typeName){case"category":return this.translate("You may want to {{a}}create a new category{{/a}}.",{context:"Menus: item search/listing results",comment:"This is used when no categories match the given search, or if there are no categories at all.",components:{a:React.createElement("a",{className:"create-link",href:this.props.createLink,target:"_blank"})}});case"post_tag":return this.translate("You may want to {{a}}create a new tag{{/a}}.",{context:"Menus: item search/listing results",comment:"This is used when no tags match the given search, or if there are no tags at all.",components:{a:React.createElement("a",{className:"create-link",href:this.props.createLink,target:"_blank"})}});case"post":return this.translate("You may want to {{a}}create a new post{{/a}}.",{context:"Menus: item search/listing results",comment:"This is used when no posts match the given search, or if there are no posts at all.",components:{a:React.createElement("a",{className:"create-link",href:this.props.createLink,target:"_blank"})}});case"page":return this.translate("You may want to {{a}}create a new page{{/a}}.",{context:"Menus: item search/listing results",comment:"This is used when no pages match the given search, or if there are no pages at all.",components:{a:React.createElement("a",{className:"create-link",href:this.props.createLink,target:"_blank"})}});default:return this.translate("You may want to {{a}}create a new one{{/a}}.",{context:"Menus: item search/listing results",comment:"This is used when no results are found for the given search, or if there are no results of the given item type at all.",components:{a:React.createElement("a",{className:"create-link",href:this.props.createLink,target:"_blank"})}})}},noOptionsMessage:function noOptionsMessage(){return this.translate("Nothing found.")},noSearchResultsMessage:function noSearchResultsMessage(){return this.translate("No results. Please try a different search.")},render:function render(){return React.createElement("span",{className:"is-empty-content"},this.props.isSearch?this.noSearchResultsMessage():this.noOptionsMessage(),"",this.createOptionMessage())}});module.exports=EmptyPlaceholder},2571:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var LoadingPlaceholder=React.createClass({displayName:"LoadingPlaceholder",render:function render(){return React.createElement("li",null,React.createElement("input",{className:"placeholder-text",type:"radio",name:"radios",disabled:true}),React.createElement("label",null,React.createElement("span",{className:"placeholder-text"},"Loading list of options...")))}});module.exports=LoadingPlaceholder},2572:function(module,exports,__webpack_require__){"use strict";var _extends2=__webpack_require__(19);var _extends3=_interopRequireDefault(_extends2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),PureRenderMixin=__webpack_require__(105),debug=__webpack_require__(4)("calypso:menus:post-list"),omit=__webpack_require__(18);var Posts=__webpack_require__(2573),PostListFetcher=__webpack_require__(1609);var PostList=React.createClass({displayName:"PostList",mixins:[PureRenderMixin],getInitialState:function getInitialState(){return{searchTerm:null}},onSearch:function onSearch(term){debug("onSearch ",term);this.setState({searchTerm:term})},render:function render(){return React.createElement(PostListFetcher,{type:this.props.type,siteID:this.props.siteID,search:this.state.searchTerm,status:"publish,private"},React.createElement(Posts,(0,_extends3.default)({},omit(this.props,"children"),{onSearch:this.onSearch})))}});module.exports=PostList},2573:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),find=__webpack_require__(33);var siteMenus=__webpack_require__(1656),helpers=__webpack_require__(1815),OptionList=__webpack_require__(2156),Options=__webpack_require__(2157),actions=__webpack_require__(1453);var Posts=React.createClass({displayName:"Posts",propTypes:{posts:React.PropTypes.array,loading:React.PropTypes.bool,itemType:React.PropTypes.object,back:React.PropTypes.func,onSearch:React.PropTypes.func,isLastPage:React.PropTypes.bool,item:React.PropTypes.object,onChange:React.PropTypes.func},getDefaultProps:function getDefaultProps(){return{posts:[],loading:true}},getHomePageTitle:function getHomePageTitle(){var site=this.props.site,homePagePost=find(this.props.posts,function(post){return helpers.isFrontPage(post,site)});return homePagePost&&homePagePost.title},maybeInjectPosts:function maybeInjectPosts(){var posts=this.props.posts.slice();if(this.props.type==="page"){posts.unshift(siteMenus.generateHomePageMenuItem(this.getHomePageTitle()));posts.push(siteMenus.generateNewPageMenuItem())}return posts},render:function render(){return React.createElement(OptionList,{itemType:this.props.itemType,onScroll:actions.fetchNextPage,onBackClick:this.props.back,onSearch:this.props.onSearch,isEmpty:this.props.posts.length===0&&!this.props.loading,isLoading:this.props.loading&&!this.props.isLastPage},React.createElement(Options,{item:this.props.item,itemType:this.props.itemType,options:this.maybeInjectPosts(this.props.posts),onChange:this.props.onChange}))}});module.exports=Posts},2574:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),debug=__webpack_require__(4)("calypso:menus:taxonomy-list");var siteMenus=__webpack_require__(1656),OptionList=__webpack_require__(2156),Options=__webpack_require__(2157),observe=__webpack_require__(146),analytics=__webpack_require__(16);var TaxonomyList=React.createClass({displayName:"TaxonomyList",mixins:[observe("contents")],getInitialState:function getInitialState(){return{loading:!!this.props.contents.fetchingNextPage,hasNeverFetched:true}},reportCategoriesListFetching:function reportCategoriesListFetching(){var categories=this.props.contents;if("CategoriesList"===categories.constructor.name&&this.state.hasNeverFetched){this.state.hasNeverFetched=false;analytics.ga.recordEvent("Menus","Fetched More Categories","totalFound",categories.found)}},nextPage:function nextPage(){if(!this.props.contents.fetchNextPage){return}debug("fetchingNextPage");this.props.contents.once("change",this.reportCategoriesListFetching);this.props.contents.fetchNextPage();this.setState({loading:this.props.contents.fetchingNextPage})},onSearch:function onSearch(term){this.props.contents.setSearch(term);this.props.contents.fetchNextPage()},render:function render(){var options=this.props.contents.get(siteMenus.siteID);return React.createElement(OptionList,{itemType:this.props.itemType,onScroll:this.nextPage,onBackClick:this.props.back,onSearch:this.onSearch,isEmpty:options.length===0&&!this.props.contents.fetchingNextPage,isLoading:this.props.contents.fetchingNextPage&&!this.props.contents.lastPage},React.createElement(Options,{item:this.props.item,itemType:this.props.itemType,options:options,onChange:this.props.onChange}))}});module.exports=TaxonomyList},2575:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var SidebarNavigation=__webpack_require__(1465),MenuPlaceholder=__webpack_require__(2584);var LoadingPlaceholder=React.createClass({displayName:"LoadingPlaceholder",render:function render(){return React.createElement("div",{className:"main main-column manage-menus",role:"main"},React.createElement(SidebarNavigation,null),React.createElement("div",{className:"menus__pickers"},React.createElement("div",{className:"menus__picker is-location"},React.createElement("label",null,React.createElement("span",{className:"placeholder-text"},"Counting menu areas...")),React.createElement("div",{className:"menus__picker-select-placeholder"},React.createElement("span",{className:"placeholder-text"},"Loading menu areas..."))),React.createElement("p",{className:"menus__pickers-conjunction"},this.translate("uses")),React.createElement("div",{className:"menus__picker is-menu"},React.createElement("label",null,React.createElement("span",{className:"placeholder-text"},"Counting menus...")),React.createElement("div",{className:"menus__picker-select-placeholder"},React.createElement("span",{className:"placeholder-text"},"Loading menus...")))),React.createElement(MenuPlaceholder,null))}});module.exports=LoadingPlaceholder},2576:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),debug=__webpack_require__(4)("calypso:menus:location-picker");var analytics=__webpack_require__(16);var LocationPicker=React.createClass({displayName:"LocationPicker",selectLocation:function selectLocation(event){var locationName=event.target.value;analytics.ga.recordEvent("Menus","Selected Menu Area","Area",locationName);this.props.selectHandler(locationName)},recordClick:function recordClick(){analytics.ga.recordEvent("Menus","Clicked Menu Area Dropdown")},render:function render(){var locations,title;locations=this.props.locations.map(function(location){return React.createElement("option",{key:location.name,value:location.name},location.description)});title=this.translate("%(numberOfLocations)s menu area on this site","%(numberOfLocations)s menu areas on this site",{count:locations.length,args:{numberOfLocations:locations.length}});return React.createElement("div",{className:"menus__picker is-location"},React.createElement("label",{htmlFor:"location-picker-select"},title),React.createElement("select",{onChange:this.selectLocation,onClick:this.recordClick,value:this.props.selectedLocation,id:"location-picker-select"},locations))}});module.exports=LocationPicker},2577:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),find=__webpack_require__(33),debug=__webpack_require__(4)("calypso:menus:index");var protectForm=__webpack_require__(650),observe=__webpack_require__(146),notices=__webpack_require__(71),LocationPicker=__webpack_require__(2576),MenuPicker=__webpack_require__(2583),SidebarNavigation=__webpack_require__(1465),Main=__webpack_require__(147),Menu=__webpack_require__(2585),MenuSaveButton=__webpack_require__(2160),EmptyContent=__webpack_require__(185),LoadingPlaceholder=__webpack_require__(2575),analytics=__webpack_require__(16),EmailVerificationGate=__webpack_require__(1698),JetpackManageErrorPage=__webpack_require__(670);var Menus=React.createClass({displayName:"Menus",mixins:[protectForm.mixin,observe("site","siteMenus","itemTypes")],componentWillMount:function componentWillMount(){this.props.siteMenus.on("change",this.maybeMarkChanged);this.props.siteMenus.on("saved",this.markSaved);this.props.siteMenus.on("error",this.displayError);window.addEventListener("unload",this.recordUnloadEvent);this.props.itemTypes.get()},componentWillUnmount:function componentWillUnmount(){if(this.props.siteMenus.get().hasChanged){analytics.ga.recordEvent("Menus","Navigate Away with Unsaved Changes")}this.props.siteMenus.off("change",this.maybeMarkChanged);this.props.siteMenus.off("saved",this.markSaved);this.props.siteMenus.off("error",this.displayError);window.removeEventListener("unload",this.recordUnloadEvent)},getInitialState:function getInitialState(){return{selectedLocation:null,isBusy:false}},maybeMarkChanged:function maybeMarkChanged(){if(this.props.siteMenus.get().hasChanged){this.markChanged()}},displayError:function displayError(error){notices.error(error)},confirmDiscard:function confirmDiscard(switchAction){var data=this.props.siteMenus.get(),menu=this.getSelectedMenu(),associationChanged=this.props.siteMenus.get().hasAssociationChanged,location,leaveText,result,gaEvent;gaEvent={menu:"Switch Menu with Unsaved Changes",location:"Switch Menu Area with Unsaved Changes"};if(associationChanged){location=find(data.locations,{name:this.getSelectedLocation()})}leaveText=this.getConfirmationString(switchAction,associationChanged,menu,location);result=window.confirm(leaveText);if(result){analytics.ga.recordEvent("Menus",gaEvent[switchAction])}return result},getConfirmationString:function getConfirmationString(switchAction,associationChanged,menu,location){var i18nStrings={menuChanged:{menu:this.translate("You have unsaved menu changes. Switching to a different menu will discard your changes. Continue?",{textOnly:true}),location:this.translate("You have unsaved menu changes. Switching to a different menu area will discard your changes. Continue?",{textOnly:true})},associationChanged:{menu:function(mainMenu,mainLocation){return this.translate('You have selected menu "%(menu)s" for area "%(location)s", but you have not manually saved this change. Switching to a different menu area will discard your changes. Continue?',{args:{menu:mainMenu.name,location:mainLocation.description},textOnly:true})}.bind(this),noMenu:function(mainLocation){return this.translate('You have removed the menu from area "%s", but you have not manually saved this change. Switching to a different menu area will discard your changes. Continue?',{args:[mainLocation.description],textOnly:true})}.bind(this)}};if(associationChanged){return menu?i18nStrings.associationChanged.menu(menu,location):i18nStrings.associationChanged.noMenu(location)}return i18nStrings.menuChanged[switchAction]},recordUnloadEvent:function recordUnloadEvent(){if(this.props.siteMenus.get().hasChanged){analytics.ga.recordEvent("Menus","Navigate Away with Unsaved Changes")}},selectLocation:function selectLocation(locationName){if(this.props.siteMenus.get().hasChanged){if(!this.confirmDiscard("location")){return}this.props.siteMenus.discard()}this.setState({selectedLocation:locationName})},getSelectedLocation:function getSelectedLocation(){return this.state.selectedLocation||this.props.siteMenus.getPrimaryLocation()},getSelectedMenu:function getSelectedMenu(){var defaultMenuId=this.props.siteMenus.getDefaultMenuId(),selectedMenu=this.props.siteMenus.getMenu(this.getSelectedLocation()),isDefaultMenu=selectedMenu&&selectedMenu.id===defaultMenuId;if(isDefaultMenu||!selectedMenu){return this.isPrimaryLocationSelected()?this.getDefaultMenu():null}return selectedMenu},getDefaultMenu:function getDefaultMenu(){return this.props.siteMenus.getDefaultMenu()},isPrimaryLocationSelected:function isPrimaryLocationSelected(){return this.getSelectedLocation()===this.props.siteMenus.getPrimaryLocation()},setBusy:function setBusy(busy){this.setState({isBusy:busy})},renderEmptyContent:function renderEmptyContent(){var title;var illustration="/calypso/images/drake/drake-nomenus.svg";if(this.isPrimaryLocationSelected()){title=this.translate("Theme Default Menu")}else{title=this.translate("No Menu Selected")}return React.createElement("div",null,React.createElement("div",{className:"menus__menu-header"},React.createElement("div",{className:"menus__menu-actions"},React.createElement(MenuSaveButton,{menuData:this.props.siteMenus}))),React.createElement(EmptyContent,{title:title,illustration:illustration}))},renderJetpackManageDisabledMessage:function renderJetpackManageDisabledMessage(site){var data=this.props.siteMenus.get();var featureExample=void 0;if(data.menus&&data.locations&&data.hasDefaultMenu&&this.props.itemTypes.fetched){featureExample=this.renderMenus()}return React.createElement(Main,{className:"manage-menus"},React.createElement(SidebarNavigation,null),React.createElement(JetpackManageErrorPage,{template:"optInManage",title:this.translate("Looking to manage this site's menus?"),site:site,section:"menus",secondaryAction:this.translate("Open Classic Menu Editor"),secondaryActionURL:site.options.admin_url+"nav-menus.php",secondaryActionTarget:"_blank",featureExample:featureExample}))},renderMenus:function renderMenus(){var selectedLocation=this.getSelectedLocation(),selectedMenu=this.getSelectedMenu(),data=this.props.siteMenus.get(),menu;if(!data.menus||!data.locations||!data.hasDefaultMenu||!this.props.itemTypes.fetched||this.state.isBusy){return React.createElement(LoadingPlaceholder,null)}if(selectedMenu){menu=React.createElement(Menu,{key:selectedMenu.id+" "+(selectedMenu.lastSaveTime||0),selectedMenu:selectedMenu,selectedLocation:selectedLocation,siteMenus:this.props.siteMenus,setBusy:this.setBusy,confirmDiscard:this.confirmDiscard.bind(null,"menu")})}return React.createElement("div",null,React.createElement("div",{className:"menus__pickers"},React.createElement(LocationPicker,{locations:data.locations,selectedLocation:selectedLocation,selectHandler:this.selectLocation}),React.createElement("p",{className:"menus__pickers-conjunction"},this.translate("uses")),React.createElement(MenuPicker,{menuData:this.props.siteMenus,menus:data.menus,selectedMenu:selectedMenu,selectedLocation:selectedLocation,isPrimaryLocation:this.isPrimaryLocationSelected(),confirmDiscard:this.confirmDiscard.bind(null,"menu")})),selectedMenu?menu:this.renderEmptyContent())},render:function render(){var site=this.props.site;if(site&&site.jetpack&&!site.canManage()){return this.renderJetpackManageDisabledMessage(site)}return React.createElement(Main,{className:"manage-menus"},React.createElement(SidebarNavigation,null),React.createElement(EmailVerificationGate,null,this.renderMenus()))}});module.exports=Menus},2578:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),debug=__webpack_require__(4)("calypso:menus:delete-button");var siteMenus=__webpack_require__(1656),analytics=__webpack_require__(16),notices=__webpack_require__(71);var MenuDeleteButton=React.createClass({displayName:"MenuDeleteButton",delete:function _delete(){analytics.ga.recordEvent("Menus","Trashed Menu");this.setBusyState();siteMenus.deleteMenu(this.props.selectedMenu,this.onDeletedMenu)},onDeletedMenu:function onDeletedMenu(err){this.clearBusyState();if(!err){this.showUndoNotice()}},undo:function undo(event,close){siteMenus.ensureContentsSaved(this.props.confirmDiscard,function(){close();this.setBusyState();siteMenus.restoreMenu(this.props.selectedLocation,this.clearBusyState)}.bind(this))},setBusyState:function setBusyState(){debug("setBusyState");this.props.setBusy(true)},clearBusyState:function clearBusyState(){debug("clearBusyState");this.props.setBusy(false)},showUndoNotice:function showUndoNotice(){notices.info(this.getUndoNoticeText(),{button:this.getUndoButtonLabel(),onClick:this.undo})},getUndoNoticeText:function getUndoNoticeText(){return this.translate('"%s" deleted.',{args:[this.props.selectedMenu.name],context:'Top notice to confirm menu deletion. Has an "Undo" button on the side.'})},getUndoButtonLabel:function getUndoButtonLabel(){return this.translate("Undo?",{context:"Ask whether user wants to undo a deletion"})},render:function render(){var classes="button noticon noticon-trash";return this.props.selectedMenu.id!==0?React.createElement("button",{className:classes,onClick:this.delete}):null}});module.exports=MenuDeleteButton},2579:function(module,exports,__webpack_require__){"use strict";var _menuData=__webpack_require__(1891);var _has=__webpack_require__(361);var _has2=_interopRequireDefault(_has);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),update=__webpack_require__(96),cloneDeep=__webpack_require__(160),find=__webpack_require__(33),debug=__webpack_require__(4)("calypso:menus:editable-item");var siteMenus=__webpack_require__(1656),MenuUtils=__webpack_require__(2159),observe=__webpack_require__(146),TaxonomyList=__webpack_require__(2574),CategoryOptions=__webpack_require__(2569),PostList=__webpack_require__(2572),MenuPanelBackButton=__webpack_require__(1929),analytics=__webpack_require__(16),Gridicon=__webpack_require__(28);var Button=React.createClass({displayName:"Button",render:function render(){var className=(this.props.className||"")+" button";var gridiconButton="";if(this.props.icon){gridiconButton=React.createElement(Gridicon,{icon:this.props.icon})}return React.createElement("button",{className:className,onClick:this.props.onClick},gridiconButton,this.props.label||"")}});var MenuEditableItem=React.createClass({displayName:"MenuEditableItem",mixins:[observe("itemTypes")],componentWillMount:function componentWillMount(){this.initializeItemType()},getInitialState:function getInitialState(){var item,newItem={name:this.translate("New item",{textOnly:true}),type:"page",type_family:"post_type",status:"publish"};item=this.isNew()?newItem:cloneDeep(this.props.initialItem);return{item:item,userChangedName:false,placeholderText:this.translate("Enter menu label",{textOnly:true}),panelInView:this.isNew()?"left":"right"}},initializeItemType:function initializeItemType(){this.setState({itemType:find(this.props.itemTypes.get(),{name:this.state.item.type})})},isNew:function isNew(){return!this.props.initialItem},save:function save(){if(this.isNew()){analytics.ga.recordEvent("Menus","Clicked Add Menu Item Button");siteMenus.addItem(this.state.item,this.props.targetId,this.props.position,this.props.menu)}else{analytics.ga.recordEvent("Menus","Clicked OK Menu Item Button");siteMenus.updateMenuItem(this.state.item)}this.props.close()},remove:function remove(){analytics.ga.recordEvent("Menus","Clicked Trash Menu Item Button");this.props.markForDeletion();this.props.close()},updateNameValue:function updateNameValue(event){if(!this.state.firedTitleChangeGAEvent){analytics.ga.recordEvent("Menus","Typed in Menu Item Title Field");this.setState({firedTitleChangeGAEvent:true})}this.setState(update(this.state,{item:{name:{$set:event.target.value}},userChangedName:{$set:true}}))},updateUrlValue:function updateUrlValue(event){if(!this.state.firedUrlChangeGAEvent){analytics.ga.recordEvent("Menus","Typed in Link Address");this.setState({firedUrlChangeGAEvent:true})}this.setState(update(this.state,{item:{url:{$set:event.target.value},type:{$set:this.state.itemType.name},type_family:{$set:this.state.itemType.family}}}))},toggleUrlTarget:function toggleUrlTarget(){analytics.ga.recordEvent("Menus","Set link target");this.setState(update(this.state,{item:{link_target:{$set:!this.state.item.link_target?"_blank":""}}}))},changeItemType:function changeItemType(itemType){analytics.ga.recordEvent("Menus","Clicked "+itemType.gaEventLabel+" Menu");this.setState({itemType:itemType,panelInView:"right"})},getItemName:function getItemName(content,currentValue){if(this.state.userChangedName||!this.isNew()){return currentValue}else if((0,_menuData.isInjectedNewPageItem)(content)){return""}else{return MenuUtils.getContentTitle(content)}},setItemContent:function setItemContent(content){analytics.ga.recordEvent("Menus","Selected Menu Item");this.setState(update(this.state,{item:{content_id:{$set:content.ID},name:{$apply:this.getItemName.bind(null,content)},type:{$set:this.state.itemType.name},type_family:{$set:this.state.itemType.family}}}));if(!this.state.userChangedName&&this.isNew()&&this.isMounted()&&(0,_has2.default)(this,"refs.menuLabel")){if((0,_menuData.isInjectedNewPageItem)(content)){this.refs.menuLabel.focus();this.setState({placeholderText:this.translate("Enter page name",{textOnly:true})})}else{this.setState({placeholderText:this.translate("Enter menu label",{textOnly:true})})}}},showLeftPanel:function showLeftPanel(){this.setState({panelInView:"left"})},renderItemOptions:function renderItemOptions(){return this.state.itemType&&this[this.state.itemType.renderer](this.state.itemType)},renderLinkOptions:function renderLinkOptions(itemType){return React.createElement("div",{className:"menu-item-options menu-item-url"},React.createElement(MenuPanelBackButton,{label:itemType.label,onClick:this.showLeftPanel}),React.createElement("label",{className:"menu-item-form-label"},this.translate("Link address (URL)")),React.createElement("input",{className:"menu-item-form-address",type:"text",value:this.state.item.url,onChange:this.updateUrlValue}),React.createElement("input",{id:"menu-flag-open-in-new-window",type:"checkbox",defaultChecked:this.state.item.link_target,onChange:this.toggleUrlTarget}),React.createElement("label",{htmlFor:"menu-flag-open-in-new-window"},this.translate("Open link in new window/tab")))},renderPostOptions:function renderPostOptions(itemType){return React.createElement(PostList,{siteID:siteMenus.siteID,site:siteMenus.site,type:itemType.name,item:this.state.item,back:this.showLeftPanel,onChange:this.setItemContent,itemType:itemType})},renderTaxonomyOptions:function renderTaxonomyOptions(itemType){var contentsList=itemType.contentsList;if(contentsList.page===0){contentsList.fetchNextPage()}return React.createElement(TaxonomyList,{contents:contentsList,item:this.state.item,back:this.showLeftPanel,onChange:this.setItemContent,itemType:itemType})},renderCategoryOptions:function renderCategoryOptions(itemType){return React.createElement(CategoryOptions,{siteId:siteMenus.siteID,selected:this.state.item,onBackClick:this.showLeftPanel,itemType:itemType,onChange:this.setItemContent})},renderItemTypes:function renderItemTypes(){return React.createElement("ul",{className:"menus__menu-item-form-types"},this.props.itemTypes.get().map(function(itemType){var isSelected;if(!itemType.show){return null}isSelected=itemType.name===this.state.itemType.name?"is-selected":"";return React.createElement("li",{key:itemType.name,className:isSelected,onClick:this.changeItemType.bind(null,itemType)},React.createElement("label",{className:"noticon noticon-"+(itemType.icon||"cog")},itemType.label));
},this))},renderUnsupportedNotice:function renderUnsupportedNotice(){var title,body,errorInfo;title=this.isItemInvalid()?this.translate("Sorry, this menu item is invalid and I can't edit it."):this.translate("Sorry, this menu item is unsupported and I can't edit it.");body=this.translate("You can manage this item as usual, but you cannot edit it here. {{br/}} Check the {{wpAdminLink}}WP Admin{{/wpAdminLink}} and see if you can edit it from there.",{components:{br:React.createElement("br",null),wpAdminLink:React.createElement("a",{href:MenuUtils.getNavMenusUrl(),target:"_blank"})}});errorInfo=["[type: ",this.state.item.type||"none",", type_family: ",this.state.item.type_family||"none","]"].join("");return React.createElement("div",{className:"unsupported-notice"},React.createElement("h1",null,title),React.createElement("p",null," ",body," "),React.createElement("small",null,errorInfo))},isSupportedItemType:function isSupportedItemType(){if(!this.state.itemType){return false}var itemType=find(this.props.itemTypes.get(),{name:this.state.item.type});return itemType&&itemType.show},isItemInvalid:function isItemInvalid(){return!this.state.item.type||!this.state.item.type_family},getItemIcon:function getItemIcon(){if(!this.isSupportedItemType()||this.isItemInvalid()){return"standard"}return this.state.itemType.icon},renderButtons:function renderButtons(){return[{key:"remove",className:"is-scary",showIfNew:false,icon:"trash",onClick:this.remove},{key:"move",label:this.translate("Move",{textOnly:true}),showIfNew:false,onClick:this.onMoveButtonClick},{key:"cancel",label:this.translate("Cancel",{textOnly:true}),showIfNew:true,onClick:this.onCancelButtonClick},{key:"ok",className:"is-primary",label:this.isNew()?this.translate("Add Item",{textOnly:true}):this.translate("OK",{textOnly:true}),showIfNew:true,onClick:this.save}].map(function(button){return this.isNew()&&button.showIfNew||!this.isNew()?React.createElement(Button,button):null},this)},onMoveButtonClick:function onMoveButtonClick(){analytics.ga.recordEvent("Menus","Clicked Move Menu Item Button");this.props.startMoveItem()},onCancelButtonClick:function onCancelButtonClick(){analytics.ga.recordEvent("Menus","Clicked Cancel Menu Item Button");this.props.close()},onTitleClick:function onTitleClick(){analytics.ga.recordEvent("Menus","Clicked Menu Item Title Field")},renderItem:function renderItem(){return React.createElement("a",{className:"menus__menu-item is-selected depth-"+this.props.depth},React.createElement("span",{className:"noticon noticon-"+this.getItemIcon()}),React.createElement("input",{id:"menu-item-name-value",placeholder:this.state.placeholderText,ref:"menuLabel",value:this.state.item.name,onChange:this.updateNameValue,onClick:this.onTitleClick}))},renderSupportedTypes:function renderSupportedTypes(){return this.isSupportedItemType()&&!this.isItemInvalid()?this.renderItemTypes():this.renderUnsupportedNotice()},render:function render(){return React.createElement("div",{className:"menus__menu-item-open-container is-panel-"+this.state.panelInView},this.renderItem(),React.createElement("div",{className:"menus__menu-item-open depth-"+this.props.depth},React.createElement("div",{className:"editable-item-content"},React.createElement("div",{className:"menus__types-and-options-container"},this.renderSupportedTypes(),this.isSupportedItemType()&&this.renderItemOptions()),React.createElement("div",{className:"menus__menu-item-actions"},this.renderButtons()))))}});module.exports=MenuEditableItem},2580:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var analytics=__webpack_require__(16);var MenuItemDropTarget=React.createClass({displayName:"MenuItemDropTarget",onClick:function onClick(){var positionText={before:"above",after:"below",child:"to children"},actionText="Clicked "+this.props.operation+" menu item "+positionText[this.props.position];analytics.ga.recordEvent("Menus",actionText);this.props.action()},render:function render(){var label={move:{before:this.translate("Move item above"),after:this.translate("Move item below"),child:this.translate("Move item to children")},add:{before:this.translate("Add menu item above"),after:this.translate("Add menu item below"),child:this.translate("Add menu item to children")}}[this.props.operation][this.props.position];return React.createElement("a",{key:this.props.operation+"-"+this.props.position,onClick:this.onClick,className:"menus__menu-item is-lander depth-"+this.props.depth+" "+this.props.className},React.createElement("span",{className:"noticon noticon-plus"},label))}});module.exports=MenuItemDropTarget},2581:function(module,exports,__webpack_require__){"use strict";var _freeze=__webpack_require__(247);var _freeze2=_interopRequireDefault(_freeze);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var React=__webpack_require__(1),ReactCSSTransitionGroup=__webpack_require__(672),find=__webpack_require__(33),debug=__webpack_require__(4)("calypso:menus:menu-items-list");var MenuEditableItem=__webpack_require__(2579),siteMenus=__webpack_require__(1656),itemTypes=__webpack_require__(2158),MenuItemDropTarget=__webpack_require__(2580),analytics=__webpack_require__(16);var MenuItemList=React.createClass({displayName:"MenuItemList",getDefaultProps:function getDefaultProps(){return{depth:0}},renderEmptyMenu:function renderEmptyMenu(){if(0===this.props.depth){return React.createElement(EmptyMenu,{doAddItem:this.props.doAddItem,depth:this.props.depth+1,addState:this.props.addState})}return null},render:function render(){if(0===this.props.items.length){return this.renderEmptyMenu()}return React.createElement("ul",{className:"menus__items"},this.props.items.map(function(menuItem){return React.createElement(MenuItem,{key:menuItem.id,item:menuItem,items:menuItem.items,depth:this.props.depth+1,getEditItem:this.props.getEditItem,setEditItem:this.props.setEditItem,moveState:this.props.moveState,doMoveItem:this.props.doMoveItem,addState:this.props.addState,doAddItem:this.props.doAddItem,confirmDeleteItem:this.props.confirmDeleteItem,setConfirmDeleteItem:this.props.setConfirmDeleteItem,dragDrop:this.props.dragDrop})},this))}});var MenuItem=React.createClass({displayName:"MenuItem",onDragStart:function onDragStart(e){e.dataTransfer.effectAllowed="move";e.dataTransfer.setData("text","dummy");this.props.dragDrop("start",e.clientX,e.clientY,this.props.item);window.addEventListener("mousemove",this.onDragEnd)},onDragOver:function onDragOver(e){e.preventDefault();this.props.dragDrop("over",e.clientX,e.clientY,this.props.item)},onDragEnd:function onDragEnd(e){e.preventDefault();window.removeEventListener("mousemove",this.onDragEnd);this.props.dragDrop("end")},getDefaultProps:function getDefaultProps(){return{items:(0,_freeze2.default)([]),depth:0}},edit:function edit(){this.props.setEditItem(this.props.item.id)},cancelCurrentOperation:function cancelCurrentOperation(){this.props.setEditItem(null);this.props.doMoveItem("cancel");this.props.doAddItem("cancel")},startMoveItem:function startMoveItem(){this.props.setEditItem(null);this.props.doMoveItem("setSource",this.props.item.id)},selectMoveItem:function selectMoveItem(){analytics.ga.recordEvent("Menus","Clicked Move Here Link");this.props.doMoveItem("setTarget",this.props.item.id)},cancelDelete:function cancelDelete(){analytics.ga.recordEvent("Menus","Clicked Back / Cancel Trash Item Button");this.props.setConfirmDeleteItem(null);this.edit()},confirmDelete:function confirmDelete(){analytics.ga.recordEvent("Menus","Clicked Delete Item Confirmation Button");this.props.setConfirmDeleteItem(null);siteMenus.deleteMenuItem(this.props.item)},markForDeletion:function markForDeletion(){this.props.setConfirmDeleteItem(this.props.item.id)},isEditing:function isEditing(){return this.props.getEditItem()===this.props.item.id},addNewItemInProgress:function addNewItemInProgress(){return!!this.props.addState.targetId},canEdit:function canEdit(){return!this.props.getEditItem()&&!this.props.moveState.moving&&!this.addNewItemInProgress()&&!this.props.confirmDeleteItem},isAddItemTarget:function isAddItemTarget(){return this.props.addState.targetId===this.props.item.id&&!this.props.addState.position},isAddItemPosition:function isAddItemPosition(position){return this.props.addState.targetId===this.props.item.id&&position===this.props.addState.position},isMoveItemTarget:function isMoveItemTarget(){return this.props.moveState.targetId===this.props.item.id},isMoveItemSource:function isMoveItemSource(){return this.props.moveState.sourceId===this.props.item.id},isBeingDragged:function isBeingDragged(){var draggedItem=this.props.dragDrop("getDraggedItem");return draggedItem&&(draggedItem.id===this.props.item.id||siteMenus.isAncestor(draggedItem,this.props.item))},isCorrupt:function isCorrupt(){return this.props.item.type===""||this.props.item.type_family===""},renderLabel:function renderLabel(){var itemType=find(itemTypes.get(),{name:this.props.item.type})||{};return React.createElement("span",{className:"menu-item-name noticon noticon-"+(itemType.icon||"standard")},this.props.item.name)},renderDropButton:function renderDropButton(){if(this.props.moveState.moving&&this.props.moveState.sourceId!==this.props.item.id){return React.createElement("span",{onClick:this.selectMoveItem,className:"menu-item-action move"},this.translate("Move here"))}},onClickCancelButton:function onClickCancelButton(){if(this.isMoveItemSource()){analytics.ga.recordEvent("Menus","Clicked Cancel Move Item Button")}else if(this.isAddItemTarget()){analytics.ga.recordEvent("Menus","Clicked Cancel Add Item Button")}this.cancelCurrentOperation()},renderCancelButton:function renderCancelButton(){if(this.isMoveItemSource()||this.isAddItemTarget()){return React.createElement("button",{onClick:this.onClickCancelButton,className:"button"},this.translate("Cancel"))}},onEditButtonClick:function onEditButtonClick(){analytics.ga.recordEvent("Menus","Clicked Edit Item Icon");this.edit()},renderEditButton:function renderEditButton(){if(this.canEdit()){return React.createElement("span",{onClick:this.onEditButtonClick,className:"menu-item-action edit"},this.translate("Edit"))}},onAddButtonClick:function onAddButtonClick(){analytics.ga.recordEvent("Menus","Clicked Add New Menu Item Icon");this.props.doAddItem("add",this.props.item.id)},renderAddButton:function renderAddButton(){if(this.canEdit()){return React.createElement("span",{onClick:this.onAddButtonClick,className:"menu-item-action add"},this.translate("Add"))}},renderItem:function renderItem(){if(this.props.confirmDeleteItem===this.props.item.id){return this.renderDeletedItem()}var className=["menus__menu-item","depth-"+this.props.depth,this.isCorrupt()?"is-corrupt":"",this.isBeingDragged()?"is-dragdrop-target":""].join(" ");return React.createElement("div",{className:className,draggable:"true",onDragStart:this.onDragStart,onDragOver:this.onDragOver,onDragEnd:this.onDragEnd,onDrop:this.onDragEnd},this.renderLabel(),React.createElement("div",{className:"action-tray"},this.renderDropButton(),this.renderEditButton(),this.renderAddButton(),this.renderCancelButton()))},renderDeletedItem:function renderDeletedItem(){return React.createElement("a",{className:"menus__menu-item is-deleted depth-"+this.props.depth},this.renderLabel(),React.createElement("div",{className:"action-tray"},React.createElement("button",{onClick:this.cancelDelete,className:"button"},this.translate("Back")),React.createElement("button",{onClick:this.confirmDelete,className:"button is-primary"},this.translate("Delete Item"))))},renderDropTarget:function renderDropTarget(position){var operation,action;if(!this.isMoveItemTarget()&&!this.isAddItemTarget()){return}operation=this.isMoveItemTarget()?"move":"add";action=this.isMoveItemTarget()?this.props.doMoveItem:this.props.doAddItem;return React.createElement(MenuItemDropTarget,{position:position,operation:operation,depth:position==="child"?this.props.depth+1:this.props.depth,action:action.bind(null,"position",position),className:"is-position-"+position})},renderNewItem:function renderNewItem(position){var depth=position==="child"?this.props.depth+1:this.props.depth;if(this.isAddItemPosition(position)){return React.createElement(MenuEditableItem,{targetId:this.props.addState.targetId,menu:this.props.addState.menu,position:position,depth:depth,itemTypes:itemTypes,close:this.cancelCurrentOperation})}},render:function render(){var item;if(this.isEditing()){item=React.createElement(MenuEditableItem,{initialItem:this.props.item,depth:this.props.depth,close:this.cancelCurrentOperation,markForDeletion:this.markForDeletion,moveState:this.props.moveState,itemTypes:itemTypes,startMoveItem:this.startMoveItem})}else{item=this.renderItem()}return React.createElement("div",null,React.createElement(ReactCSSTransitionGroup,{transitionName:"menus__droptarget-slidevertical",transitionEnterTimeout:200,transitionLeaveTimeout:200},this.renderDropTarget("before")),this.renderNewItem("before"),item,this.renderNewItem("after"),this.renderNewItem("child"),React.createElement(ReactCSSTransitionGroup,{transitionName:"menus__droptarget-slidevertical",transitionEnterTimeout:200,transitionLeaveTimeout:200},this.renderDropTarget("after")),React.createElement(ReactCSSTransitionGroup,{transitionName:"menus__droptarget-slidevertical",transitionEnterTimeout:200,transitionLeaveTimeout:200},this.renderDropTarget("child")),React.createElement(MenuItemList,{depth:this.props.depth,menuData:this.props.menuData,items:this.props.items,setEditItem:this.props.setEditItem,getEditItem:this.props.getEditItem,moveState:this.props.moveState,doMoveItem:this.props.doMoveItem,addState:this.props.addState,doAddItem:this.props.doAddItem,confirmDeleteItem:this.props.confirmDeleteItem,setConfirmDeleteItem:this.props.setConfirmDeleteItem,dragDrop:this.props.dragDrop}))}});var EmptyMenu=React.createClass({displayName:"EmptyMenu",renderLabel:function renderLabel(){return React.createElement("span",{className:"menu-item-name"})},addNewItem:function addNewItem(){analytics.ga.recordEvent("Menus","Clicked Add First Menu Item Link");this.props.doAddItem("position","first")},render:function render(){var addFirstItemButton=React.createElement("ul",{className:"menus__items"},React.createElement("a",{className:"menus__menu-item is-empty"},this.renderLabel(),React.createElement("div",{className:"action-tray"},React.createElement("span",{className:"menu-item-action add",onClick:this.addNewItem},this.translate("Add"))))),newItem=React.createElement(MenuEditableItem,{targetId:this.props.addState.targetId,menu:this.props.addState.menu,position:this.props.addState.position,depth:this.props.depth,itemTypes:itemTypes,close:this.props.doAddItem.bind(null,"cancel")});return React.createElement("div",{className:"menus__items"},this.props.addState.position?newItem:addFirstItemButton)}});module.exports=MenuItemList},2582:function(module,exports,__webpack_require__){"use strict";var ReactDom=__webpack_require__(43),React=__webpack_require__(1),debug=__webpack_require__(4)("calypso:menus:menu");var analytics=__webpack_require__(16);var MenuName=React.createClass({displayName:"MenuName",getInitialState:function getInitialState(){return{editing:false,value:this.props.value}},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.setState({value:nextProps.value})},toggleEdit:function toggleEdit(){var editing=this.state.editing;if(!editing){analytics.ga.recordEvent("Menus","Clicked Edit Menu Title")}var newEditingState=!editing;this.setState({editing:newEditingState});if(this.props.onTitleEdit){this.props.onTitleEdit(newEditingState)}},updateName:function updateName(newValue){this.setState({value:newValue,editing:false});if(this.props.onChange){this.props.onChange(newValue)}if(this.props.onTitleEdit){this.props.onTitleEdit(false)}},render:function render(){var menuEditable;if(this.state.editing){menuEditable=React.createElement(TemporaryInput,{value:this.state.value,className:this.props.className,onEdited:this.updateName})}else{menuEditable=React.createElement("span",{className:this.props.className,onTouchTap:this.toggleEdit},React.createElement("span",null,this.state.value),React.createElement("a",{className:"edit"}))}return menuEditable}});var TemporaryInput=React.createClass({displayName:"TemporaryInput",getInitialState:function getInitialState(){return{value:this.props.value}},componentDidMount:function componentDidMount(){var node=ReactDom.findDOMNode(this.refs.input);node.focus();try{node.setSelectionRange(0,999)}catch(e){debug("setSelectionRange failed")}},updateValue:function updateValue(event){this.setState({value:event.target.value})},maybeFinishEditing:function maybeFinishEditing(event){if(13===event.which){this.finishEditing()}},finishEditing:function finishEditing(){this.props.onEdited(this.state.value)},render:function render(){return React.createElement("input",{ref:"input",type:"text",className:this.props.className,onChange:this.updateValue,onKeyPress:this.maybeFinishEditing,onBlur:this.finishEditing,value:this.state.value})}});module.exports=MenuName},2583:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),debug=__webpack_require__(4)("calypso:menus:menu-picker");var analytics=__webpack_require__(16);var MenuPicker=React.createClass({displayName:"MenuPicker",selectMenu:function selectMenu(event){var menuId=event.target.value;this.props.menuData.ensureContentsSaved(this.props.confirmDiscard,this.selectMenuWhenClean.bind(this,menuId))},selectMenuWhenClean:function selectMenuWhenClean(menuId){if("add-menu"===menuId){analytics.ga.recordEvent("Menus","Created New Menu");this.props.menuData.addNewMenu(this.props.selectedLocation);return}menuId=Number(menuId);analytics.ga.recordEvent("Menus","Selected Menu");this.props.menuData.setMenuAtLocation(menuId,this.props.selectedLocation)},getMenuCount:function getMenuCount(){var defaultMenuId=this.props.menuData.getDefaultMenuId(),realMenusCount=this.props.menus.filter(function(menu){return menu.id!==defaultMenuId}).length;return realMenusCount+(this.props.isPrimaryLocation?1:0)},recordClick:function recordClick(){analytics.ga.recordEvent("Menus","Clicked Menu Dropdown")},renderEmptyOption:function renderEmptyOption(){if(!this.props.menuData.hasDefaultMenu()&&this.props.isPrimaryLocation||!this.props.isPrimaryLocation){return React.createElement("option",{key:"default",value:""},this.props.isPrimaryLocation?this.translate("Default Menu",{textOnly:true}):this.translate("No Menu",{textOnly:true}))}},render:function render(){var menus,title,defaultMenuId=this.props.menuData.getDefaultMenuId();menus=this.props.menus.map(function(menu){return menu.id!==defaultMenuId||this.props.isPrimaryLocation?React.createElement("option",{key:menu.id,value:menu.id},menu.name):null}.bind(this));title=this.translate("%(numberOfMenus)s menu available","%(numberOfMenus)s menus available",{count:this.getMenuCount(),args:{numberOfMenus:this.getMenuCount()}});return React.createElement("div",{className:"menus__picker is-menu"},React.createElement("label",{htmlFor:"menu-picker-select"},title),React.createElement("select",{onChange:this.selectMenu,id:"menu-picker-select",onClick:this.recordClick,value:this.props.selectedMenu?this.props.selectedMenu.id:""},this.renderEmptyOption(),menus,React.createElement("option",{key:"noop",value:"disabled",disabled:true}," "),React.createElement("option",{key:"add-menu",value:"add-menu"},"+ ",this.translate("Add new menu",{textOnly:true}))))}});module.exports=MenuPicker},2584:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1);var MenuPlaceholder=React.createClass({displayName:"MenuPlaceholder",render:function render(){return React.createElement("div",null,React.createElement("div",{className:"menus__menu-header"},React.createElement("h2",{className:"menus__menu-name"},React.createElement("span",{className:"placeholder-text",disabled:true},"Loading active menu..."))),React.createElement("ul",{className:"menus__items"},React.createElement("div",null,React.createElement("a",{className:"menus__menu-item depth-1"},React.createElement("label",{className:"menu-item-name noticon noticon-standard noticon-placeholder"},React.createElement("span",{className:"placeholder-text"},"Loading menu items..."))))))}});module.exports=MenuPlaceholder},2585:function(module,exports,__webpack_require__){"use strict";var React=__webpack_require__(1),debug=__webpack_require__(4)("calypso:menus:menu");var protectForm=__webpack_require__(650),assign=__webpack_require__(29),classNames=__webpack_require__(11),MenuName=__webpack_require__(2582),MenuItemList=__webpack_require__(2581),MenuDeleteButton=__webpack_require__(2578),MenuSaveButton=__webpack_require__(2160),MenuRevertButton=__webpack_require__(2586),analytics=__webpack_require__(16);var Menu=React.createClass({displayName:"Menu",mixins:[protectForm.mixin],MOUSE_DRAG_STEP_PIXELS:16,getInitialState:function getInitialState(){return{moveState:{},addState:{},confirmDeleteItem:null,editItemId:null,editingTitle:false}},dragDrop:function dragDrop(action,x,y,item){if("start"===action){this.dragStart(x,y,item)}else if("over"===action){this.dragOver(x,y,item)}else if("getDraggedItem"===action){return this.state.draggedItem}else if("end"===action){this.draggedItem=null;if(this.state.draggedItem){this.setState({draggedItem:null});analytics.ga.recordEvent("Menus","Item drag drop")}}},dragStart:function dragStart(x,y,item){this.draggedItem=item;this.draggedItemParent=this.props.siteMenus.getParent(item.id);this.dragOrigin={x:x,y:y};this.previousOp={target:0,position:""}},dragOver:function dragOver(x,y,item){var menuData=this.props.siteMenus,moveOp;if(!this.draggedItem){return}moveOp=this.getMoveOperation(x,y,item);if(moveOp&&!this.operationsEqual(moveOp,this.previousOp)){if(menuData.isAncestor(this.draggedItem,item)){return}this.setState({draggedItem:this.draggedItem});menuData.moveItem(this.draggedItem.id,moveOp.target,moveOp.position);this.previousOp=moveOp;this.dragOrigin={x:x,y:y};this.draggedItemParent=menuData.getParent(this.draggedItem.id)}},getMoveOperation:function getMoveOperation(x,y,item){var menuData=this.props.siteMenus,parent=menuData.getParent(item.id),previousSibling;if(this.draggedItem!==item){return{target:item.id,position:this.mouseMovedDown(y)?"after":"before"}}else if(this.mouseMovedRight(x)){previousSibling=menuData.getPreviousSibling(this.draggedItem,parent);if(previousSibling){return{target:previousSibling.id,position:"child"}}}else if(this.mouseMovedLeft(x)&&this.draggedItemParent){if(menuData.hasSubsequentSiblings(this.draggedItem,this.draggedItemParent)){return}return{target:this.draggedItemParent.id,position:"after"}}},mouseMovedDown:function mouseMovedDown(y){return y-this.dragOrigin.y>0},mouseMovedLeft:function mouseMovedLeft(x){return this.dragOrigin.x-this.MOUSE_DRAG_STEP_PIXELS>x},mouseMovedRight:function mouseMovedRight(x){return x-this.dragOrigin.x>this.MOUSE_DRAG_STEP_PIXELS},operationsEqual:function operationsEqual(op1,op2){return op1.target===op2.target&&op1.position===op2.position},setMenuName:function setMenuName(name){if(name&&name!==this.props.selectedMenu.name){analytics.ga.recordEvent("Menus","Updated Menu Title")}this.props.siteMenus.setMenuName(this.props.selectedMenu.id,name)},doAddItem:function doAddItem(action,id){var oldState=this.state.addState,newState={};if("add"===action){newState.targetId=id}else if("position"===action){assign(newState,oldState);newState.position=id;newState.menu=this.props.selectedMenu.id}this.setState({addState:newState})},doMoveItem:function doMoveItem(action,data){var oldState=this.state.moveState,newState={};if("setSource"===action){newState.moving=true;newState.sourceId=data}else if("setTarget"===action){assign(newState,oldState);newState.targetId=data}else if("position"===action){this.props.siteMenus.moveItem(oldState.sourceId,oldState.targetId,data)}this.setState({moveState:newState})},setConfirmDeleteItem:function setConfirmDeleteItem(id){this.setState({confirmDeleteItem:id})},setEditItem:function setEditItem(itemId){this.setState({editItemId:itemId})},getEditItem:function getEditItem(){return this.state.editItemId},renderAddTip:function renderAddTip(){return!this.getEditItem()?React.createElement("div",{className:"menus__add-item-footer-label"},this.translate("Add new item")):null},updateTitleEditing:function updateTitleEditing(editing){this.setState({editingTitle:editing})},render:function render(){var menuName,menuItemList;if(this.props.selectedMenu){menuName=React.createElement("h2",{className:"menus__menu-name"},React.createElement(MenuName,{className:"is-editable",value:this.props.selectedMenu.name,onTitleEdit:this.updateTitleEditing,onChange:this.setMenuName}));menuItemList=React.createElement(MenuItemList,{items:this.props.selectedMenu.items,setEditItem:this.setEditItem,getEditItem:this.getEditItem,moveState:this.state.moveState,doMoveItem:this.doMoveItem,addState:this.state.addState,doAddItem:this.doAddItem,confirmDeleteItem:this.state.confirmDeleteItem,setConfirmDeleteItem:this.setConfirmDeleteItem,dragDrop:this.dragDrop})}var classes=classNames({"menus__menu-header":true,"is-editing-title":this.state.editingTitle});return React.createElement("div",null,React.createElement("div",{className:classes},menuName,React.createElement("div",{className:"menus__menu-actions"},React.createElement(MenuDeleteButton,{selectedMenu:this.props.selectedMenu,selectedLocation:this.props.selectedLocation,setBusy:this.props.setBusy,confirmDiscard:this.props.confirmDiscard}),React.createElement(MenuRevertButton,{menuData:this.props.siteMenus}),React.createElement(MenuSaveButton,{menuData:this.props.siteMenus,selectedMenu:this.props.selectedMenu}))),menuItemList,this.renderAddTip())}});module.exports=Menu},2586:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(1);var _react2=_interopRequireDefault(_react);var _debug=__webpack_require__(4);var _debug2=_interopRequireDefault(_debug);var _button=__webpack_require__(68);var _button2=_interopRequireDefault(_button);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var debug=(0,_debug2.default)("calypso:menus:revert-button");var MenuRevertButton=_react2.default.createClass({displayName:"MenuRevertButton",componentWillMount:function componentWillMount(){this.props.menuData.on("saved",this.endReverting);this.props.menuData.on("error",this.endReverting);this.props.menuData.on("saving",this.disable)},componentWillUnmount:function componentWillUnmount(){this.props.menuData.off("saved",this.endReverting);this.props.menuData.off("error",this.endReverting);this.props.menuData.off("saving",this.disable)},getInitialState:function getInitialState(){return{reverting:false,disabled:false}},startReverting:function startReverting(){this.setState({reverting:true,disabled:true})},endReverting:function endReverting(){this.setState({reverting:false,disabled:false})},disable:function disable(){this.setState({disabled:true})},revert:function revert(){this.startReverting();return this.props.menuData.discard()},render:function render(){var _props$menuData$get=this.props.menuData.get();var hasChanged=_props$menuData$get.hasChanged;var disabled=this.state.disabled||!hasChanged;return _react2.default.createElement(_button2.default,{disabled:disabled,onClick:this.revert},this.state.reverting?this.translate("Canceling"):this.translate("Cancel"))}});exports.default=MenuRevertButton;module.exports=exports["default"]},3188:function(module,exports,__webpack_require__){var baseClone=__webpack_require__(126),baseIteratee=__webpack_require__(39);function iteratee(func){return baseIteratee(typeof func=="function"?func:baseClone(func,true))}module.exports=iteratee}});